<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Trip Generation | Urban Transportation Planning</title>
  <meta name="description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Trip Generation | Urban Transportation Planning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Trip Generation | Urban Transportation Planning" />
  
  <meta name="twitter:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

<meta name="author" content="Gregory Macfarlane, PhD, PE" />


<meta name="date" content="2020-08-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chap-blocks.html"/>
<link rel="next" href="chap-distribution.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Transportation Planning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Foreword</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-blocks.html"><a href="chap-blocks.html"><i class="fa fa-check"></i><b>1</b> Building Blocks</a><ul>
<li class="chapter" data-level="1.1" data-path="chap-blocks.html"><a href="chap-blocks.html#planning-for-human-systems"><i class="fa fa-check"></i><b>1.1</b> Planning for Human Systems</a></li>
<li class="chapter" data-level="1.2" data-path="chap-blocks.html"><a href="chap-blocks.html#the-four-step-process"><i class="fa fa-check"></i><b>1.2</b> The Four-Step Process</a></li>
<li class="chapter" data-level="1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-model-building-blocks"><i class="fa fa-check"></i><b>1.3</b> Travel Model Building Blocks</a><ul>
<li class="chapter" data-level="1.3.1" data-path="chap-blocks.html"><a href="chap-blocks.html#household-travel-surveys"><i class="fa fa-check"></i><b>1.3.1</b> Household Travel Surveys</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-analysis-zones"><i class="fa fa-check"></i><b>1.3.2</b> Travel Analysis Zones</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-blocks.html"><a href="chap-blocks.html#highway-networks"><i class="fa fa-check"></i><b>1.3.3</b> Highway Networks</a></li>
<li class="chapter" data-level="1.3.4" data-path="chap-blocks.html"><a href="chap-blocks.html#matrices"><i class="fa fa-check"></i><b>1.3.4</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-blocks.html"><a href="chap-blocks.html#statistical-and-mathematical-techniques"><i class="fa fa-check"></i><b>1.4</b> Statistical and Mathematical Techniques</a><ul>
<li class="chapter" data-level="1.4.1" data-path="chap-blocks.html"><a href="chap-blocks.html#continuous-and-discrete-distributions"><i class="fa fa-check"></i><b>1.4.1</b> Continuous and Discrete Distributions</a></li>
<li class="chapter" data-level="1.4.2" data-path="chap-blocks.html"><a href="chap-blocks.html#iterative-proportional-fitting"><i class="fa fa-check"></i><b>1.4.2</b> Iterative Proportional Fitting</a></li>
<li class="chapter" data-level="1.4.3" data-path="chap-blocks.html"><a href="chap-blocks.html#regression-analysis"><i class="fa fa-check"></i><b>1.4.3</b> Regression Analysis</a></li>
<li class="chapter" data-level="1.4.4" data-path="chap-blocks.html"><a href="chap-blocks.html#numerical-optimization"><i class="fa fa-check"></i><b>1.4.4</b> Numerical Optimization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#hw-blocks"><i class="fa fa-check"></i>Homework</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-tripgen.html"><a href="chap-tripgen.html"><i class="fa fa-check"></i><b>2</b> Trip Generation</a><ul>
<li class="chapter" data-level="2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production"><i class="fa fa-check"></i><b>2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction"><i class="fa fa-check"></i><b>2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.3" data-path="chap-tripgen.html"><a href="chap-tripgen.html#homework"><i class="fa fa-check"></i><b>2.3</b> Homework</a></li>
<li class="chapter" data-level="2.4" data-path="chap-tripgen.html"><a href="chap-tripgen.html#lab"><i class="fa fa-check"></i><b>2.4</b> Lab</a><ul>
<li class="chapter" data-level="2.4.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production-1"><i class="fa fa-check"></i><b>2.4.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.4.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction-1"><i class="fa fa-check"></i><b>2.4.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.4.3" data-path="chap-tripgen.html"><a href="chap-tripgen.html#report"><i class="fa fa-check"></i><b>2.4.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-distribution.html"><a href="chap-distribution.html"><i class="fa fa-check"></i><b>3</b> Trip Distribution</a></li>
<li class="chapter" data-level="4" data-path="chap-modechoice.html"><a href="chap-modechoice.html"><i class="fa fa-check"></i><b>4</b> Mode and Destination Choice</a><ul>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#hw-modechoice"><i class="fa fa-check"></i>Homework</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-assignment.html"><a href="chap-assignment.html"><i class="fa fa-check"></i><b>5</b> Network Assignment and Validation</a></li>
<li class="chapter" data-level="6" data-path="chap-process.html"><a href="chap-process.html"><i class="fa fa-check"></i><b>6</b> The Planning Process</a></li>
<li class="appendix"><span><b>Appendix</b></span><ul>
<li class="chapter" data-level="1" data-path="chap-process.html"><a href="chap-process.html#running-the-model"><i class="fa fa-check"></i><b>1</b> Running the Model</a></li>
<li class="chapter" data-level="2" data-path="chap-process.html"><a href="chap-process.html#files-and-reports"><i class="fa fa-check"></i><b>2</b> Files and Reports</a></li>
<li class="chapter" data-level="3" data-path="chap-process.html"><a href="chap-process.html#cube-tips-and-tricks"><i class="fa fa-check"></i><b>3</b> Cube Tips and Tricks</a><ul>
<li class="chapter" data-level="3.1" data-path="chap-process.html"><a href="chap-process.html#shortest-paths"><i class="fa fa-check"></i><b>3.1</b> Shortest Paths</a></li>
<li class="chapter" data-level="3.2" data-path="chap-process.html"><a href="chap-process.html#working-with-matrices"><i class="fa fa-check"></i><b>3.2</b> Working with Matrices</a></li>
<li class="chapter" data-level="3.3" data-path="chap-process.html"><a href="chap-process.html#writing-custom-scripts"><i class="fa fa-check"></i><b>3.3</b> Writing Custom Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="A" data-path="app-rstudio.html"><a href="app-rstudio.html"><i class="fa fa-check"></i><b>A</b> R and RStudio Help</a><ul>
<li class="chapter" data-level="A.1" data-path="app-rstudio.html"><a href="app-rstudio.html#installing"><i class="fa fa-check"></i><b>A.1</b> Installing</a></li>
<li class="chapter" data-level="A.2" data-path="app-rstudio.html"><a href="app-rstudio.html#rstudio-orientation"><i class="fa fa-check"></i><b>A.2</b> RStudio Orientation</a></li>
<li class="chapter" data-level="A.3" data-path="app-rstudio.html"><a href="app-rstudio.html#r-packages"><i class="fa fa-check"></i><b>A.3</b> R Packages</a></li>
<li class="chapter" data-level="A.4" data-path="app-rstudio.html"><a href="app-rstudio.html#working-with-tables"><i class="fa fa-check"></i><b>A.4</b> Working with Tables</a><ul>
<li class="chapter" data-level="A.4.1" data-path="app-rstudio.html"><a href="app-rstudio.html#reading-data"><i class="fa fa-check"></i><b>A.4.1</b> Reading Data</a></li>
<li class="chapter" data-level="A.4.2" data-path="app-rstudio.html"><a href="app-rstudio.html#modifying-and-summarizing-tables"><i class="fa fa-check"></i><b>A.4.2</b> Modifying and Summarizing Tables</a></li>
<li class="chapter" data-level="A.4.3" data-path="app-rstudio.html"><a href="app-rstudio.html#app-mutate"><i class="fa fa-check"></i><b>A.4.3</b> Mutate, Summarize, and Group</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="app-rstudio.html"><a href="app-rstudio.html#graphics-with-ggplot2"><i class="fa fa-check"></i><b>A.5</b> Graphics with <code>ggplot2</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Transportation Planning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap-tripgen" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Trip Generation</h1>
<p>The details of the Trip Generation models are given in section 4.4 of <em>NCHRP 716</em>
and in the course notes. In this unit we will use data from both the NHTS
and from the Puget Sound Regional Council (PSRC).</p>
<div id="trip-production" class="section level2">
<h2><span class="header-section-number">2.1</span> Trip Production</h2>
<p>The trip production model is a cross-classification model. What this means
is that we will classify households into different bins based on their
household size, income, vehicle ownership, etc. We will then calculate the
average number of trips made by households in each group.</p>
<p>We will need to get the data for households and trips. Use the records for
households in MSA size <code>02</code>, that completed the survey on a weekday, and then
filter the trips to include only those records. We can also select only the data
columns that have the information we will use to classify the model. We might
need to create some or modify variables that we need to use to cross-classify;
for instance we should cap the household size category at 4 people and the
vehicles at 3.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chap-tripgen.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="chap-tripgen.html#cb1-2"></a><span class="kw">library</span>(nhts2017)</span>
<span id="cb1-3"><a href="chap-tripgen.html#cb1-3"></a></span>
<span id="cb1-4"><a href="chap-tripgen.html#cb1-4"></a>hh &lt;-<span class="st"> </span>nhts_households <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-5"><a href="chap-tripgen.html#cb1-5"></a><span class="st">  </span><span class="co"># filter to MSA size 2, travel on weekday</span></span>
<span id="cb1-6"><a href="chap-tripgen.html#cb1-6"></a><span class="st">  </span><span class="kw">filter</span>(msasize <span class="op">==</span><span class="st"> &quot;02&quot;</span>, <span class="op">!</span>travday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;01&quot;</span>, <span class="st">&quot;07&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-7"><a href="chap-tripgen.html#cb1-7"></a><span class="st">  </span><span class="co"># select the columns we care about.</span></span>
<span id="cb1-8"><a href="chap-tripgen.html#cb1-8"></a><span class="st">  </span><span class="kw">select</span>(houseid, wthhfin, hhsize, hhvehcnt, numadlt, hhfaminc, wrkcount) <span class="op">%&gt;%</span></span>
<span id="cb1-9"><a href="chap-tripgen.html#cb1-9"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1-10"><a href="chap-tripgen.html#cb1-10"></a>    <span class="dt">hhsize =</span> <span class="kw">ifelse</span>(hhsize <span class="op">&gt;</span><span class="st"> </span><span class="dv">4</span>, <span class="dv">4</span>, hhsize),</span>
<span id="cb1-11"><a href="chap-tripgen.html#cb1-11"></a>    <span class="dt">hhvehcnt =</span> <span class="kw">ifelse</span>(hhvehcnt <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>, <span class="dv">3</span>, hhvehcnt)</span>
<span id="cb1-12"><a href="chap-tripgen.html#cb1-12"></a>  )</span>
<span id="cb1-13"><a href="chap-tripgen.html#cb1-13"></a>hh</span></code></pre></div>
<pre><code>## # A tibble: 10,381 x 7
##    houseid  wthhfin hhsize hhvehcnt numadlt hhfaminc                  wrkcount
##    &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr+lbl&gt;                    &lt;dbl&gt;
##  1 30000019   279.       2        2       2 03 [$15,000 to $24,999]          0
##  2 30000288   103.       1        2       1 05 [$35,000 to $49,999]          0
##  3 30000289   244.       3        3       2 07 [$75,000 to $99,999]          1
##  4 30000463   348.       2        2       2 06 [$50,000 to $74,999]          2
##  5 30000465   133.       4        2       2 08 [$100,000 to $124,999]        2
##  6 30000478   120.       2        0       2 03 [$15,000 to $24,999]          0
##  7 30000545    35.7      2        3       2 06 [$50,000 to $74,999]          2
##  8 30000770   130.       1        1       1 06 [$50,000 to $74,999]          1
##  9 30000983   147.       4        3       4 09 [$125,000 to $149,999]        1
## 10 30001177   304.       2        0       2 04 [$25,000 to $34,999]          2
## # … with 10,371 more rows</code></pre>
<p>The next step is we need to calculate how many trips the members of each
household in the data took. To do this, we can use <code>summarise</code> to count the number of
trip rows for each household. Then, we can <code>pivot_wider</code> to spread the trips
out by purpose.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chap-tripgen.html#cb3-1"></a>trips &lt;-<span class="st"> </span>nhts_trips <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-2"><a href="chap-tripgen.html#cb3-2"></a><span class="st">  </span><span class="co"># filter to households in the data</span></span>
<span id="cb3-3"><a href="chap-tripgen.html#cb3-3"></a><span class="st">  </span><span class="kw">filter</span>(houseid <span class="op">%in%</span><span class="st"> </span>hh<span class="op">$</span>houseid) <span class="op">%&gt;%</span></span>
<span id="cb3-4"><a href="chap-tripgen.html#cb3-4"></a><span class="st">  </span><span class="kw">group_by</span>(houseid, trippurp) <span class="op">%&gt;%</span></span>
<span id="cb3-5"><a href="chap-tripgen.html#cb3-5"></a><span class="st">  </span><span class="co"># count up how many trips each household took</span></span>
<span id="cb3-6"><a href="chap-tripgen.html#cb3-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">trips =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb3-7"><a href="chap-tripgen.html#cb3-7"></a><span class="st">  </span><span class="co"># &quot;spread&quot; the data, filling zero if no trips were taken</span></span>
<span id="cb3-8"><a href="chap-tripgen.html#cb3-8"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">id_cols =</span> houseid, <span class="dt">names_from =</span> trippurp, </span>
<span id="cb3-9"><a href="chap-tripgen.html#cb3-9"></a>              <span class="dt">values_from =</span> trips, <span class="dt">values_fill =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;houseid&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chap-tripgen.html#cb5-1"></a>trips</span></code></pre></div>
<pre><code>## Warning: `...` is not empty.
## 
## We detected these problematic arguments:
## * `needs_dots`
## 
## These dots only exist to allow future extensions and should be empty.
## Did you misspecify an argument?</code></pre>
<pre><code>## # A tibble: 9,518 x 7
## # Groups:   houseid [9,518]
##    houseid    HBO HBSHOP   NHB HBSOCREC   HBW  `-9`
##    &lt;chr&gt;    &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 30000019     4      0     0        0     0     0
##  2 30000288     1      1     4        0     0     0
##  3 30000289     2      4     3        1     1     0
##  4 30000463     7      2     6        0     0     0
##  5 30000465     8      2     9        0     1     0
##  6 30000478     2      0     0        0     0     0
##  7 30000545     0      2     2        4     2     0
##  8 30000770     0      3     1        0     1     0
##  9 30000983     4      0     2        1     2     0
## 10 30001177     3      2     0        2     2     0
## # … with 9,508 more rows</code></pre>
<p>Now, we will <code>join</code> the trips data frame to the households data frame so that
everything is in one place. Note that when we do this, there will be some households
that never made any trips; we need to change their trip counts from <code>NA</code> to <code>0</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chap-tripgen.html#cb8-1"></a><span class="co"># function to change NA to 0</span></span>
<span id="cb8-2"><a href="chap-tripgen.html#cb8-2"></a>nato0 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {<span class="kw">ifelse</span>(<span class="kw">is.na</span>(x), <span class="dv">0</span>, x)}</span>
<span id="cb8-3"><a href="chap-tripgen.html#cb8-3"></a></span>
<span id="cb8-4"><a href="chap-tripgen.html#cb8-4"></a>tripprod &lt;-<span class="st"> </span>hh <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-5"><a href="chap-tripgen.html#cb8-5"></a><span class="st">  </span><span class="co"># join tables by id field</span></span>
<span id="cb8-6"><a href="chap-tripgen.html#cb8-6"></a><span class="st">  </span><span class="kw">left_join</span>(trips, <span class="dt">by =</span> <span class="st">&quot;houseid&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-7"><a href="chap-tripgen.html#cb8-7"></a><span class="st">  </span><span class="co"># change all NA values in columns from the trips data to 0.a</span></span>
<span id="cb8-8"><a href="chap-tripgen.html#cb8-8"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">names</span>(trips)), nato0)</span>
<span id="cb8-9"><a href="chap-tripgen.html#cb8-9"></a>tripprod</span></code></pre></div>
<pre><code>## Warning: `...` is not empty.
## 
## We detected these problematic arguments:
## * `needs_dots`
## 
## These dots only exist to allow future extensions and should be empty.
## Did you misspecify an argument?</code></pre>
<pre><code>## # A tibble: 10,381 x 13
##    houseid wthhfin hhsize hhvehcnt numadlt hhfaminc wrkcount   HBO HBSHOP   NHB
##    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr+lb&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 300000…   279.       2        2       2 03 [$15…        0     4      0     0
##  2 300002…   103.       1        2       1 05 [$35…        0     1      1     4
##  3 300002…   244.       3        3       2 07 [$75…        1     2      4     3
##  4 300004…   348.       2        2       2 06 [$50…        2     7      2     6
##  5 300004…   133.       4        2       2 08 [$10…        2     8      2     9
##  6 300004…   120.       2        0       2 03 [$15…        0     2      0     0
##  7 300005…    35.7      2        3       2 06 [$50…        2     0      2     2
##  8 300007…   130.       1        1       1 06 [$50…        1     0      3     1
##  9 300009…   147.       4        3       4 09 [$12…        1     4      0     2
## 10 300011…   304.       2        0       2 04 [$25…        2     3      2     0
## # … with 10,371 more rows, and 3 more variables: HBSOCREC &lt;dbl&gt;, HBW &lt;dbl&gt;,
## #   `-9` &lt;dbl&gt;</code></pre>
<p>Now we can count up the number of trips by grouping the variables we care
about and taking the average. For instance, we can get the average HBO trip rate
for households by size and vehicle count. Remember to weight!</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chap-tripgen.html#cb11-1"></a>hbo_tripprod &lt;-<span class="st"> </span>tripprod <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="chap-tripgen.html#cb11-2"></a><span class="st">  </span><span class="kw">group_by</span>(hhsize, hhvehcnt) <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="chap-tripgen.html#cb11-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb11-4"><a href="chap-tripgen.html#cb11-4"></a>    <span class="dt">n =</span> <span class="kw">n</span>(), <span class="co"># number of households in category</span></span>
<span id="cb11-5"><a href="chap-tripgen.html#cb11-5"></a>    <span class="dt">HBO =</span> <span class="kw">weighted.mean</span>(HBO, wthhfin), <span class="co"># average HBO trips per hh</span></span>
<span id="cb11-6"><a href="chap-tripgen.html#cb11-6"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;hhsize&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chap-tripgen.html#cb13-1"></a>hbo_tripprod</span></code></pre></div>
<pre><code>## Warning: `...` is not empty.
## 
## We detected these problematic arguments:
## * `needs_dots`
## 
## These dots only exist to allow future extensions and should be empty.
## Did you misspecify an argument?</code></pre>
<pre><code>## # A tibble: 16 x 4
## # Groups:   hhsize [4]
##    hhsize hhvehcnt     n   HBO
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
##  1      1        0   345 0.414
##  2      1        1  2263 0.558
##  3      1        2   541 0.540
##  4      1        3   207 0.339
##  5      2        0    55 0.420
##  6      2        1   782 1.55 
##  7      2        2  2472 1.15 
##  8      2        3  1282 1.12 
##  9      3        0    25 3.98 
## 10      3        1   161 1.90 
## 11      3        2   422 2.04 
## 12      3        3   561 1.93 
## 13      4        0    12 3.32 
## 14      4        1   120 5.28 
## 15      4        2   556 4.31 
## 16      4        3   577 4.19</code></pre>
</div>
<div id="trip-attraction" class="section level2">
<h2><span class="header-section-number">2.2</span> Trip Attraction</h2>
</div>
<div id="homework" class="section level2">
<h2><span class="header-section-number">2.3</span> Homework</h2>
<ol style="list-style-type: decimal">
<li><p>Calculate the trip rates for each purpose by household size, and by income
group. Do the rates make sense? Why or why not?</p></li>
<li><p>Calculate the trip rates by the number of household workers and the
vehicle availability. Do the rates make sense? Why or why not?</p></li>
<li><p>Calculate the <em>variance</em> or <em>standard deviation</em> in work trip rates by
household size / vehicles and by number of workers / vehicles. Which
classification should be used for work trips?</p></li>
<li><p>Calculate the number of households in each classification (size /
vehicles), (workers / vehicles). What information does this give you about the
estimated trip rates?</p></li>
<li><p>Estimate trip rate attraction models for all the trip purposes.
Present models with only significant or influential factors (try a few different
specifications until you are satisfied with your models’ performance)</p></li>
<li><p>Explain your attraction rate models; do the rates make sense? Which
models have the best fit in terms of <span class="math inline">\(R^2\)</span> value? Why?</p></li>
<li><p>Remove the intercept from your model estimations. In R, you can do
this by adding a <code>-1</code> to the formula, as in <code>lm(y ~ x - 1)</code>. Do the rates
change? By how much? Should you keep the intercept in or remove it?</p></li>
</ol>
</div>
<div id="lab" class="section level2">
<h2><span class="header-section-number">2.4</span> Lab</h2>
<p>In this lab you will implement and calibrate trip generation rates for the RVTPO
model.</p>
<div id="trip-production-1" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Trip Production</h3>
<p>The trip production rates are stored in the <code>params/trip_prod/</code> folder, with a
dbf file for each trip purpose in the model. We are going to calibrate the
following trip purposes:</p>
<ul>
<li><code>HBW</code>: cross-classification model of workers and vehicles available</li>
<li><code>HBO</code>: cross-classification model of household persons and vehicles available</li>
<li><code>HBShop</code>: cross-classification model of household persons and vehicles available</li>
</ul>
<p>The household travel survey for the RVTPO region reported the following total
weighted trips in these trip purposes:</p>
<table>
<thead>
<tr class="header">
<th align="left">Purpose</th>
<th align="right">Weighted Survey Trips</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">HBW</td>
<td align="right">118,653</td>
</tr>
<tr class="even">
<td align="left">HBO</td>
<td align="right">267,987</td>
</tr>
<tr class="odd">
<td align="left">HBShop</td>
<td align="right">129,614</td>
</tr>
</tbody>
</table>
<p>Begin by running the RVTPO model through the Trip Generation
submodel. The trip productions for each trip purpose are recorded in
<code>Base/outputs/HH_PROD.dbf</code>. Using this file, run a create a report that
sums the trips produced in each of these three purposes. Compare the totals
in the bare model with the weighted survey targets.</p>
<p>Replace the bare model rates with rates you estimated from the PSRC travel survey
during your homework assignment. Run your tabulation report again, and compare
the total productions to the regional targets.</p>
<p>Adjust the trip rates so that they replicate the regional survey targets within
an acceptable margin of error. Ensure that the comparative relationship between
the trip rates is maintained (i.e. households with more workers must make more
work trips).</p>
</div>
<div id="trip-attraction-1" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Trip Attraction</h3>
<p>The trip attraction rates enter into the destination choice model, but it is
helpful to compare the total forecasted attractions using the rates you
estimated. Apply the rates to the zonal socioeconomic data file and calculate
the total number of attracted trips for each of the three purposes. Adjust the
rates so that the total attractions for your three estimated purposes match the
regional totals.</p>
</div>
<div id="report" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Report</h3>
<p>Prepare a technical report describing the process by which you estimated
household trip production and attraction rates, and calibrated the trip rates to
reproduce regional totals. Calculate the margin of error for <em>all</em> purposes (not
just the purposes you calibrated). Discuss how well the calibrated trip
generation models replicates the survey targets, and justify your residual
error. Use formatted tables to display results instead of screenshots of output.</p>
<p>You will be graded on the overall readability, flow, formatting and grammar in
addition to how clearly you articulate the process of your work.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chap-blocks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-distribution.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ceen565.pdf", "ceen565.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
