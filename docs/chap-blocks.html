<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Building Blocks | Urban Transportation Planning</title>
  <meta name="description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Building Blocks | Urban Transportation Planning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Building Blocks | Urban Transportation Planning" />
  
  <meta name="twitter:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

<meta name="author" content="Gregory Macfarlane, PhD, PE" />


<meta name="date" content="2020-09-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="chap-tripgen.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Transportation Planning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Foreword</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-blocks.html"><a href="chap-blocks.html"><i class="fa fa-check"></i><b>1</b> Building Blocks</a><ul>
<li class="chapter" data-level="1.1" data-path="chap-blocks.html"><a href="chap-blocks.html#planning-for-human-systems"><i class="fa fa-check"></i><b>1.1</b> Planning for Human Systems</a></li>
<li class="chapter" data-level="1.2" data-path="chap-blocks.html"><a href="chap-blocks.html#the-four-step-transportation-planning-process"><i class="fa fa-check"></i><b>1.2</b> The Four-Step Transportation Planning Process</a></li>
<li class="chapter" data-level="1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-model-building-blocks"><i class="fa fa-check"></i><b>1.3</b> Travel Model Building Blocks</a><ul>
<li class="chapter" data-level="1.3.1" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-analysis-zones-and-se-data"><i class="fa fa-check"></i><b>1.3.1</b> Travel Analysis Zones and SE Data</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-blocks.html"><a href="chap-blocks.html#transportation-networks"><i class="fa fa-check"></i><b>1.3.2</b> Transportation Networks</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-blocks.html"><a href="chap-blocks.html#matrices"><i class="fa fa-check"></i><b>1.3.3</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-blocks.html"><a href="chap-blocks.html#data-inputs"><i class="fa fa-check"></i><b>1.4</b> Data Inputs</a><ul>
<li class="chapter" data-level="1.4.1" data-path="chap-blocks.html"><a href="chap-blocks.html#household-travel-surveys"><i class="fa fa-check"></i><b>1.4.1</b> Household Travel Surveys</a></li>
<li class="chapter" data-level="1.4.2" data-path="chap-blocks.html"><a href="chap-blocks.html#us-census-bureau"><i class="fa fa-check"></i><b>1.4.2</b> US Census Bureau</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="chap-blocks.html"><a href="chap-blocks.html#statistical-and-mathematical-techniques"><i class="fa fa-check"></i><b>1.5</b> Statistical and Mathematical Techniques</a><ul>
<li class="chapter" data-level="1.5.1" data-path="chap-blocks.html"><a href="chap-blocks.html#continuous-and-discrete-distributions"><i class="fa fa-check"></i><b>1.5.1</b> Continuous and Discrete Distributions</a></li>
<li class="chapter" data-level="1.5.2" data-path="chap-blocks.html"><a href="chap-blocks.html#ipf"><i class="fa fa-check"></i><b>1.5.2</b> Iterative Proportional Fitting</a></li>
<li class="chapter" data-level="1.5.3" data-path="chap-blocks.html"><a href="chap-blocks.html#regression-analysis"><i class="fa fa-check"></i><b>1.5.3</b> Regression Analysis</a></li>
<li class="chapter" data-level="1.5.4" data-path="chap-blocks.html"><a href="chap-blocks.html#numerical-optimization"><i class="fa fa-check"></i><b>1.5.4</b> Numerical Optimization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#hw-blocks"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#lab-blocks"><i class="fa fa-check"></i>Lab</a><ul>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#marginal-distributions"><i class="fa fa-check"></i>Marginal Distributions</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#joint-distribution"><i class="fa fa-check"></i>Joint Distribution</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i>Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-tripgen.html"><a href="chap-tripgen.html"><i class="fa fa-check"></i><b>2</b> Trip Generation</a><ul>
<li class="chapter" data-level="2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production"><i class="fa fa-check"></i><b>2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction"><i class="fa fa-check"></i><b>2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="" data-path="chap-tripgen.html"><a href="chap-tripgen.html#hw-generation"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-tripgen.html"><a href="chap-tripgen.html#lab-generation"><i class="fa fa-check"></i>Lab</a><ul>
<li class="chapter" data-level="2.2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production-1"><i class="fa fa-check"></i><b>2.2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction-1"><i class="fa fa-check"></i><b>2.2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.2.3" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i><b>2.2.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-distribution.html"><a href="chap-distribution.html"><i class="fa fa-check"></i><b>3</b> Trip Distribution</a><ul>
<li class="chapter" data-level="" data-path="chap-distribution.html"><a href="chap-distribution.html#hw-distribution"><i class="fa fa-check"></i>Homework</a><ul>
<li class="chapter" data-level="3.0.1" data-path="chap-distribution.html"><a href="chap-distribution.html#first-problem-gravity-model-development"><i class="fa fa-check"></i><b>3.0.1</b> First Problem: Gravity Model Development</a></li>
<li class="chapter" data-level="3.0.2" data-path="chap-distribution.html"><a href="chap-distribution.html#second-problem-model-application"><i class="fa fa-check"></i><b>3.0.2</b> Second Problem: Model Application</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-modechoice.html"><a href="chap-modechoice.html"><i class="fa fa-check"></i><b>4</b> Mode and Destination Choice</a><ul>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#hw-modechoice"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="4.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#lab"><i class="fa fa-check"></i><b>4.1</b> Lab</a><ul>
<li class="chapter" data-level="4.1.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#mode-choice-calibration"><i class="fa fa-check"></i><b>4.1.1</b> Mode Choice Calibration</a></li>
<li class="chapter" data-level="4.1.2" data-path="chap-modechoice.html"><a href="chap-modechoice.html#destination-choice-calibration"><i class="fa fa-check"></i><b>4.1.2</b> Destination Choice Calibration</a></li>
<li class="chapter" data-level="4.1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i><b>4.1.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-assignment.html"><a href="chap-assignment.html"><i class="fa fa-check"></i><b>5</b> Network Assignment and Validation</a><ul>
<li class="chapter" data-level="" data-path="chap-assignment.html"><a href="chap-assignment.html#hw-assignment"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="5.1" data-path="chap-assignment.html"><a href="chap-assignment.html#laboratory-assignment"><i class="fa fa-check"></i><b>5.1</b> Laboratory Assignment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-process.html"><a href="chap-process.html"><i class="fa fa-check"></i><b>6</b> The Planning Process</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="app-demomodel.html"><a href="app-demomodel.html"><i class="fa fa-check"></i><b>A</b> Demonstration Model</a><ul>
<li class="chapter" data-level="A.1" data-path="app-demomodel.html"><a href="app-demomodel.html#running-the-model"><i class="fa fa-check"></i><b>A.1</b> Running the Model</a></li>
<li class="chapter" data-level="A.2" data-path="app-demomodel.html"><a href="app-demomodel.html#files-and-reports"><i class="fa fa-check"></i><b>A.2</b> Files and Reports</a></li>
<li class="chapter" data-level="A.3" data-path="app-demomodel.html"><a href="app-demomodel.html#network-and-zone-maps"><i class="fa fa-check"></i><b>A.3</b> Network and Zone Maps</a><ul>
<li class="chapter" data-level="A.3.1" data-path="app-demomodel.html"><a href="app-demomodel.html#shortest-paths"><i class="fa fa-check"></i><b>A.3.1</b> Shortest Paths</a></li>
<li class="chapter" data-level="A.3.2" data-path="app-demomodel.html"><a href="app-demomodel.html#working-with-matrices"><i class="fa fa-check"></i><b>A.3.2</b> Working with Matrices</a></li>
<li class="chapter" data-level="A.3.3" data-path="app-demomodel.html"><a href="app-demomodel.html#writing-custom-scripts"><i class="fa fa-check"></i><b>A.3.3</b> Writing Custom Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="app-rstudio.html"><a href="app-rstudio.html"><i class="fa fa-check"></i><b>B</b> R and RStudio Help</a><ul>
<li class="chapter" data-level="B.1" data-path="app-rstudio.html"><a href="app-rstudio.html#installing"><i class="fa fa-check"></i><b>B.1</b> Installing</a></li>
<li class="chapter" data-level="B.2" data-path="app-rstudio.html"><a href="app-rstudio.html#rstudio-orientation"><i class="fa fa-check"></i><b>B.2</b> RStudio Orientation</a></li>
<li class="chapter" data-level="B.3" data-path="app-rstudio.html"><a href="app-rstudio.html#r-packages"><i class="fa fa-check"></i><b>B.3</b> R Packages</a></li>
<li class="chapter" data-level="B.4" data-path="app-rstudio.html"><a href="app-rstudio.html#working-with-tables"><i class="fa fa-check"></i><b>B.4</b> Working with Tables</a><ul>
<li class="chapter" data-level="B.4.1" data-path="app-rstudio.html"><a href="app-rstudio.html#reading-data"><i class="fa fa-check"></i><b>B.4.1</b> Reading Data</a></li>
<li class="chapter" data-level="B.4.2" data-path="app-rstudio.html"><a href="app-rstudio.html#modifying-and-summarizing-tables"><i class="fa fa-check"></i><b>B.4.2</b> Modifying and Summarizing Tables</a></li>
<li class="chapter" data-level="B.4.3" data-path="app-rstudio.html"><a href="app-rstudio.html#app-mutate"><i class="fa fa-check"></i><b>B.4.3</b> Mutate, Summarize, and Group</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="app-rstudio.html"><a href="app-rstudio.html#graphics-with-ggplot2"><i class="fa fa-check"></i><b>B.5</b> Graphics with <code>ggplot2</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Transportation Planning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap-blocks" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Building Blocks</h1>
<p>This chapter contains concepts, definitions, and mathematical techniques that will
be used throughout the semester. Critical terms to understand are given in <strong>bold</strong>.</p>
<div id="planning-for-human-systems" class="section level2">
<h2><span class="header-section-number">1.1</span> Planning for Human Systems</h2>
<p>If you look out on any sufficiently busy road, you will see a steady stream of
vehicles passing by. Each vehicle is largely indistinguishable from the others,
and it is easy as an engineer responsible for that road to see the cars driving
by as little more than an input to a problem. But the <em>people</em> inside the cars
should not be indistinguishable from each other. Each person who is driving or
riding in each of those cars has their own reasons to be driving on that road.
One person might be driving to work; one person might be trying to get home to
his or her family. Another car might hold a family going on vacation, or a group
of friends heading to a movie.</p>
<p>If you don’t recognize that each person who travels is different, with different
needs and purposes, then it is easy to look only at the <strong>supply</strong> of transportation
infrastructure. Is the road wide enough? Is the traffic signal timed appropriately?
But as with anything in the economy transportation is a function of both supply
and <strong>demand</strong>. Why are so many people trying to get down this one road <em>right now</em>?
Why didn’t more people take transit? Why didn’t some people choose a different
destination? Or why didn’t some people just stay home in the first place?</p>
<p>Transportation planning therefore must be concerned with both the supply of
infrastructure and the demand for travel. For the most part, economists consider
travel a <strong>derived demand</strong>, which means people only go to the hassle of
traveling somewhere if they have some other reason to be there. No one
typically just drives around (with the possible exception of teenagers on a
weekend night); they are going to work, or school, or a social engagement, or
<em>something</em>.</p>
<p>Travel demand has not been stable over time. The availability of inexpensive
automobiles in the 20th Century created demand for inter-city and intra-urban
roads that did not exist before. Rising labor force participation rates for
women radically changed the number and types of trips the average household
makes in an average day. Technological developments like teleconferencing and
smartphone-enabled ridehailing could generate different trends. At the same
time, populations in most regions continue to grow. <strong>Planning</strong> for future
transportation infrastructure is difficult because of the uncertainty of the
future, but it is necessary to keep economies rolling and preserve or improve
quality of life.</p>
<p>In the United States and most societies with some democratic process,
<strong>decisions</strong> about what transportation facilities to build, which policies to
implement, and how to build a city generally fall to <strong>decision makers</strong>. These
decision makers consist of mayors, city councils, planning commissions,
state legislatures, Congress, state and federal agencies, and innumerable others
who are elected by the public, or who are accountable to others who have been.
In making decisions about how to spend public money on civil infrastructure or
enact tax or other policies, decision makers consult <strong>plans</strong> developed by
professional engineers and planners.</p>
<p>As engineers and planners, we are rarely in a position to <em>make</em> decisions, but
we have a responsibility to provide accurate data and technical analysis to
support decision makers. There is a misconception that transportation planners
must accurately predict the future to be relevant. The purpose of transportation
planning is not to perfectly envision what will happen under every scenario,
it is to provide information that will help make good decisions now so that
the future is at least as pleasant as the present. We all have hopes for what
our lives and community will look like ten or twenty years from now; it may not
be possible for anyone to provide analysis entirely free of all personal bias.
But as you conduct your work as an engineer and planner, you owe the public your
integrity and competence as you provide information to their representatives.</p>
</div>
<div id="the-four-step-transportation-planning-process" class="section level2">
<h2><span class="header-section-number">1.2</span> The Four-Step Transportation Planning Process</h2>
<p>How can you know what might happen in the future? And how might that change based
on decisions that you make today? This basic question is at the heart of
transportation planning:</p>
<ul>
<li>What might traffic look like if we build nothing and population still grows?</li>
<li>Can we build less if we change land development patterns?</li>
<li>How many people will use this new transit line?</li>
</ul>
<p>In many fields — including politics, meteorology, economics, etc. —
professionals who seek answers to questions like this do so with the help of a
<strong>model</strong>. A model is a mathematical representation of a real-world system.
In any model, there are things that need to vary (called inputs), things that
can be estimated or calibrated (called parameters), and results (called outputs).
There are also things that are held fixed. The specific mathematical structure
of the model, and which things get included and which things are excluded or
abstracted away, determine what the model should and should not be used for.</p>
<p>For example, we might try to predict something with a linear model,
<span class="math display" id="eq:basic-model">\[\begin{equation}
  y = \alpha + \beta x + \varepsilon
  \tag{1.1}
\end{equation}\]</span>
In this case <span class="math inline">\(y\)</span> is the output, <span class="math inline">\(x\)</span> is the input, the
<span class="math inline">\(\beta\)</span> parameter defines how the input influences the outcomes, <span class="math inline">\(\alpha\)</span> is a
fixed value, and <span class="math inline">\(\varepsilon\)</span> accounts for the random influence of all the
factors we did not include. We could add more <span class="math inline">\(\beta\)</span> and <span class="math inline">\(x\)</span> terms to
include more factors in the model. We could also change the mathematical format
of the model to represent different types of outcomes, or chain several smaller
models together to represent more complex relationships. If we wanted to see what
might happen if <span class="math inline">\(x\)</span> changed, we could put in a new value into this equation
and the output result <span class="math inline">\(y\)</span> might be a plausible prediction. The plausibility of
the output is a function of how well the mathematical model actually represents
the reality of the system.</p>
<p>In this class you will learn the details of the <em>travel demand modeling process</em>,
which is a chain of many models, each with different inputs and outputs. A
travel demand model on the whole has two basic inputs:</p>
<ul>
<li>Socioeconomic data representing where people live and work and go to school and
do other things.</li>
<li>Transportation network data representing the roads and transit services and
other methods people use to get between their activities.</li>
</ul>
<p>The basic outputs of a travel demand model are transportation volumes and levels
of service. There are many ways to design and build travel demand models, but
the traditional way most regions in the United States approach travel demand models
is through a <strong>four step</strong>, trip-based<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> process. The four steps are:</p>
<ol style="list-style-type: decimal">
<li>Trip Generation</li>
<li>Trip Distribution</li>
<li>Mode Choice</li>
<li>Route Assignment</li>
</ol>
<p>A <em>trip generation</em> model determines how many trips are produced in each <em>zone</em>
(neighborhood), and how many trips are attracted to each zone. The inputs to
this model is the socioeconomic data in each zone. Mathematically, trip generation
can be represented as
<span class="math display" id="eq:tripgen">\[\begin{equation}
  P_i = f(SE_i), A_j = f(SE_j)
  \tag{1.2}
\end{equation}\]</span>
where <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are the production and destination zone indexes.</p>
<p>A <em>trip distribution</em> model seeks to pair the productions and attractions in the
zones based on the travel costs <span class="math inline">\(c\)</span> between the two zones. Mathematically, trip
distribution can be represented as
<span class="math display" id="eq:tripdist">\[\begin{equation}
  T_{ij} = f(P_i, A_j, c_{ij})
  \tag{1.3}
\end{equation}\]</span></p>
<p>A <em>mode choice</em> model estimates how many of the trips from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> will happen
on each available mode <span class="math inline">\(k\)</span>, based on the travel time by each mode and other
attributes of the origin and destination zones. Mathematically,
<span class="math display" id="eq:modechoice">\[\begin{equation}
  T_{ijk} = f(T_{ij}, c_{ijk}, SE_{i,j}) 
  \tag{1.4}
\end{equation}\]</span></p>
<p>A <em>route assignment</em> model determines the specific routes that the trips going
between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> take. This allows us to estimate the volume of level of
service on each highway link and transit system <span class="math inline">\(l\)</span>. Mathematically,
<span class="math display" id="eq:modechoice">\[\begin{equation}
  LOS_l, V_l = f(T_{ijk}, c_{ijk})
  \tag{1.4}
\end{equation}\]</span></p>
<p>On the whole, the travel demand model can be represented mathematically as a
single function where the output transportation volumes and levels of service
are a function of the input socioeconomic information and travel costs.</p>
<p><span class="math display" id="eq:tdm">\[\begin{equation}
  LOS_l, V_l = \mathcal{F}(SE_{i,j}, c_{ij})
  \tag{1.5}
\end{equation}\]</span></p>
<p>The details of each of these models will be the topic for the next several
chapters.</p>
</div>
<div id="travel-model-building-blocks" class="section level2">
<h2><span class="header-section-number">1.3</span> Travel Model Building Blocks</h2>
<p>In this section, we present some of the terms used in transportation planning
and modeling, as well as some of the data objects used in constructing travel
demand models.</p>
<div id="travel-analysis-zones-and-se-data" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Travel Analysis Zones and SE Data</h3>
<p>The “people” in a model conduct <em>activities</em>: work, school, recreation, and
other activities. Because travel is a derived demand, the purpose of travel is to
move between these activities. So a travel model needs a way to represent where
the households, persons, jobs, and activities are located in space.</p>
<p>Activities in travel demand models happen in <strong>Travel Analysis Zones</strong> (TAZs).
The model tries to represent trips between the TAZs. Because trips inside a
TAZ — called intrazonal trips — are not included in the travel model, each
TAZ should be sufficiently small such that these trips do not affect the models’
ability to forecast travel on roadways. The following rules are helpful when
drawing TAZ’s:</p>
<ul>
<li>The TAZ should not stretch across major roadways</li>
<li>The TAZ should contain principally one land use, though in some areas this
is not possible.</li>
<li>In areas with more dense population, the TAZ should be smaller.</li>
</ul>
<p>Each TAZ is associated with <strong>socioeconomic</strong> (SE) data, or information about
the people, businesses, and other activities that are located in the TAZ.
<strong>Households</strong> are a basic unit of analysis in many economic and statistical
analyses. A household typically consists of one or more <strong>persons</strong> who reside
in the same dwelling. Individuals living in the same dwelling can make up a
family or other group of individuals; that is, a group of roommates is
considered a household. Not everyone lives in households, however; some people
live in what are called group quarters: military barracks, college dormitories,
monasteries, prisons, etc. Travel models need to handle these people as well, but
in this class we will focus on people who live in households.</p>
<p>Households in travel models are often grouped into a classification scheme
based on the number of people in the household, the number of children, the number
of vehicles, etc. Households of different classifications will have different
behavior in the rest of the model.</p>
<div class="rmdthink">
<p>Your lab activity for this unit will walk you through specifying a
household classification model.</p>
</div>
<p><strong>Firms</strong> are another basic unit of analysis in many economic and statistical
analyses. A firm is a profit-seeking person or entity that provides goods or
services in exchange for monetary transactions. A firm can provide raw resources,
manufactured resources, other services, or be a place of employment. In some
cases, a firm may be another household. Each firm will have an <em>industry</em> type.
Examples of industry types include office, service, manufacturing, retail, etc.
In many SE data files, firms are simply represented as the total number of
jobs in a TAZ belonging to each industry. Other <strong>Institutions</strong> including
academic, government, and non-profit entities will also be represented in the SE
data in terms of their jobs.</p>
<p>It is important to be precise in our definitions when put all of these different
items into an analysis. A typical socioeconomic data table for a small region is
given in Table <a href="chap-blocks.html#tab:setable">1.1</a>. Note the following relationships:</p>
<ul>
<li>Persons live in Households</li>
<li>Workers are Persons who have a Job</li>
<li>Firms have employees who work at a Jobs</li>
</ul>
<div class="figure"><span id="fig:RoanokeTAZ"></span>
<img src="images/RoanokeTAZ.png" alt="Travel Analysis Zones in Central Roanoke." width="100%" />
<p class="caption">
Figure 1.1: Travel Analysis Zones in Central Roanoke.
</p>
</div>
<p>When we talk about “how many jobs” are in a TAZ, we mean “How many people do
the firms located in that TAZ employ,” and not “how many people who live
in that TAZ are workers.”</p>
<table>
<caption><span id="tab:setable">Table 1.1: </span>Example SE Table</caption>
<thead>
<tr class="header">
<th align="right">taz</th>
<th align="right">persons</th>
<th align="right">hh</th>
<th align="right">workers</th>
<th align="right">retail</th>
<th align="right">office</th>
<th align="right">manufacturing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">44</td>
<td align="right">25</td>
<td align="right">22</td>
<td align="right">129</td>
<td align="right">96</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">45</td>
<td align="right">47</td>
<td align="right">21</td>
<td align="right">121</td>
<td align="right">81</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">32</td>
<td align="right">35</td>
<td align="right">17</td>
<td align="right">148</td>
<td align="right">89</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="rmdexample">
<p>Alice lives with her husband in zone <span class="math inline">\(A\)</span> and works as an accountant in zone <span class="math inline">\(B\)</span>.
Her husband does not currently work.
Fill out the SE table from Table <a href="chap-blocks.html#tab:setable">1.1</a> with <em>just</em> this
household’s information.</p>
<p>Two persons live in one household with one worker in zone A. The firm Alice works at
has an office job for her in Zone B.</p>
<table>
<thead>
<tr class="header">
<th>taz</th>
<th>persons</th>
<th>hh</th>
<th>workers</th>
<th>retail</th>
<th>office</th>
<th>manufacturing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>B</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="transportation-networks" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Transportation Networks</h3>
<p>The purpose of a travel model is to understand how people are likely to use
transportation infrastructure, so there has to be a way to represent
roadway and transit systems. We do this with a
<em>network</em><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. A network consists of
two basic data structures: <strong>Nodes</strong> and <strong>Links</strong></p>
<p>Nodes are points in space. In a highway network, almost all nodes represent
intersections between different roads. Some important nodes represent the
<strong>TAZ Centroids</strong>, or the points where the households and jobs in the travel
model are located.</p>
<p>Links connect nodes, and represent roads. Links have many different attributes
describing the characteristics of the roadway they represent. The two most
important link attributes are the link’s <em>speed</em> and <em>capacity</em>, because they
provide the travel costs (<span class="math inline">\(c_{ij}\)</span> above) to the various steps of the model. But
these attributes might not always be known at the outset, so instead we use
attributes of the roadway that influence capacity and speed, and then calculate
these other values.</p>
<p><strong>Functional Type</strong> or <strong>Functional Class</strong> describes the relative
role each road plays in the transportation system <span class="citation">(<em>A Policy on Geometric Design of Highways and Streets, 7th Edition,</em> <a href="#ref-2018aashto" role="doc-biblioref">2018</a>)</span>. Every street
fills a role on a spectrum from mobility on one end to accessibility on the other:
roads that are good at moving high volumes of vehicles are usually not good at
providing access to homes and businesses. Common functional types include:</p>
<ul>
<li><em>Freeways</em> are provided almost exclusively to enhance mobility for through traffic.
Access to freeways is provided only at specific grade-separated interchanges,
with no direct access to the freeway from adjacent land except by way of those
interchanges.</li>
<li>The primary function of major and minor <em>arterials</em> is to provide mobility of through
traffic. However, arterials also connect to both collectors and local roads and
streets and many arterials provide direct access to adjacent development.</li>
<li>Major and minor <em>collectors</em> connect arterials to local roads and provide access
to adjacent development. Mobility for through traffic is less important.</li>
<li><em>Local streets</em> exist primarily to serve adjacent development. Mobility for
through traffic is not important, or even desired.</li>
</ul>
<p>Figure <a href="chap-blocks.html#fig:udot-classes">1.2</a> shows roads in Provo and Orem classified by this
scheme. Streets of a functional class below collector are almost never included
in travel models, unless they provide essential connectivity between other
roads. Entire neighborhoods of local streets may be represented by just a
handful of special links called <em>centroid connectors</em>.</p>
<div class="figure"><span id="fig:udot-classes"></span>
<img src="images/UDOT_Functional_Classes.png" alt="UDOT Functional Classes." width="100%" />
<p class="caption">
Figure 1.2: UDOT Functional Classes.
</p>
</div>
<div class="rmdthink">
<p>Why are local roads not included in travel models?</p>
</div>
<p><strong>Free-flow speed</strong> is the speed vehicles travel when the road is empty.
Historically, travel modelers would use formulas in the Highway Capacity Manual
to estimate the free-flow speed for roadways, or assert a basic calculation like
5 miles per hour over the speed limit. More recently, modelers use the speeds
reported from GPS devices in the middle of the night to establish free-flow
speeds.</p>
<p>The number of <strong>lanes</strong> on a road is fairly self-explanatory, but it plays a
major role in the road’s capacity.</p>
<p>Roads located in different <strong>area types</strong> – urban, suburban, and rural –
operate differently from each other. Sometimes travel models will assert this
value, but more recent models will calculate the area type for each link
based on the density of the surrounding TAZs.</p>
<p>Link <strong>capacity</strong> is the maximum number of vehicles a can optimally transport
between two nodes. The capacity is a function of functional type, lanes,
free-flow speed, area type, etc. Usually travel models will calculate the
capacity based on the given values for other roadway characteristics, but
sometimes there are ways to override this feature, i.e., if engineers have
developed specific capacity estimates for a new project.</p>
<p><strong>Centroid connectors</strong> are special links that connect centroids to a network.
These are different from other links in that they usually don’t have a capacity
or a speed (they don’t represent real roads).</p>
</div>
<div id="matrices" class="section level3">
<h3><span class="header-section-number">1.3.3</span> Matrices</h3>
<p>Travel models need to represent travel times, costs, and flows between zones.
Models store this data in <strong>matrices</strong>, special data structures developed for
this purpose. Each matrix is a square table where the rows <span class="math inline">\(i\)</span> represent origin
zones and the columns <span class="math inline">\(j\)</span> represent the destination zones. Each cell represents
something about the relationship between the two zones.</p>
<p>There are two kinds of information we typically
represent with matrices:</p>
<ul>
<li><p><strong>Cost matrices</strong>, or skims, are matrices where the cells contain estimates of
travel time or cost. They are called <em>skims</em> because they are the results of
<em>skimming</em> a network to find the shortest path between each pair of TAZ
centroids.</p></li>
<li><p><strong>Flow matrices</strong>, represent flows of people or vehicles from each origin to
each destination. The number in the corresponding cell <span class="math inline">\(T_{ij}\)</span> is the total
number of trips made, and represents the demand between two zones in a network.</p></li>
</ul>
</div>
</div>
<div id="data-inputs" class="section level2">
<h2><span class="header-section-number">1.4</span> Data Inputs</h2>
<p>In the last section we discussed data <em>structures</em> like highway networks and
socioeconomic data files. In this section, we are going to talk about the data
<em>inputs</em> that can be used for developing travel models. Besides highway networks
— which usually have to be supplied by the transportation agency — modelers
frequently gather data from household travel surveys and the US Census Bureau.</p>
<div class="rmdthink">
<p>Obtaining an accurate highway network is one of the most difficult tasks in
travel modeling. It’s not conceptually or intellectually difficult, but it is
very difficult to map model networks onto the linear referencing systems or
GIS files used by other agency departments. This is made even more
difficult by model networks needing to be <em>routeable</em>: common GIS formats
like shapefiles have no way of representing routability.</p>
</div>
<div id="household-travel-surveys" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Household Travel Surveys</h3>
<p>Travel demand models try to represent individual behavior. How many trips
does the average household make per day? How do people respond to changes in
transit fare? And how can a modeler know if the model accurately reflects
total traffic?</p>
<p>Household travel surveys are a critical component of much travel modeling
practice and research, and are a primary way to answer some of these questions.
In a travel survey, a regional planning
agency<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> will recruit households
to participate in the survey. Often there is some kind of reward to encourage
participation, like a gift card or raffle. Once recruited, household members
fill out a diary of their activities on an assigned day; Figure
<a href="chap-blocks.html#fig:travel-diary">1.3</a> shows an example of one activity from a survey diary.
From the example, you can see the kinds of data that are available: where the
person traveled, which travel mode they used, and what was their reason for
making the trip.</p>
<div class="figure"><span id="fig:travel-diary"></span>
<img src="images/travel_diary.png" alt="Example travel survey diary entry." width="70%" />
<p class="caption">
Figure 1.3: Example travel survey diary entry.
</p>
</div>
<p>Not all travel surveys are filled in on forms; nowadays telephone interviews or
mobile applications are more common (more on that below). But for decades, paper
travel surveys were the basis of almost all transportation behavior science.</p>
<p>Once the surveys are collected, the data is usually processed into several tables
stored in different files or a database.</p>
<ul>
<li>A <strong>Households</strong> table has one row for each household in the dataset, including
information about the number of people in the household, the number of vehicles,
and the household income.</li>
<li>A <strong>Persons</strong> table has one row for each person in the dataset — including
which household they are a part of (to link with the households table) — and
personal attributes like age, student or worker status.</li>
<li>A <strong>Vehicles</strong> table has one row for each vehicle owned by the households in
in the dataset, including attributes like model year, vehicle class, and fuel
efficiency.</li>
<li>A <strong>Trips</strong> table has one row for each trip taken by each person in the dataset.
This table can be linked against the other tables if necessary, and contains
information like the trip purpose and many other elements collected with the form
in Figure <a href="chap-blocks.html#fig:travel-diary">1.3</a>.</li>
</ul>
<p>Tables <a href="chap-blocks.html#tab:show-nhts-hh">1.2</a> through <a href="chap-blocks.html#tab:show-nhts-trips">1.5</a> show
data collected from one household in the 2017 National Household Travel Survey.
The household contains four people, two of whom are working adults in their late
thirties. (the other two are children, and the NHTS did not collect their trip
data). The household has two vehicles, and on the survey travel day person 2
appeared to make a few very long trips. It’s impossible to know if this
is a typical day for this person or not, but that’s the data that was collected.</p>
<table>
<caption><span id="tab:show-nhts-hh">Table 1.2: </span>NHTS Households File</caption>
<thead>
<tr class="header">
<th align="left">houseid</th>
<th align="right">hhsize</th>
<th align="right">numadlt</th>
<th align="right">wrkcount</th>
<th align="right">hhvehcnt</th>
<th align="left">hhfaminc</th>
<th align="right">wthhfin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">30000082</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">$100,000 to $124,999</td>
<td align="right">1148.809</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:show-nhts-persons">Table 1.3: </span>NHTS Persons File</caption>
<thead>
<tr class="header">
<th align="left">houseid</th>
<th align="left">personid</th>
<th align="right">r_age</th>
<th align="left">educ</th>
<th align="left">r_sex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="right">39</td>
<td align="left">Graduate degree or professional degree</td>
<td align="left">Female</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="right">38</td>
<td align="left">Bachelor’s degree</td>
<td align="left">Male</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:show-nhts-vehicles">Table 1.4: </span>NHTS Vehicles File</caption>
<thead>
<tr class="header">
<th align="left">houseid</th>
<th align="left">vehid</th>
<th align="right">vehyear</th>
<th align="left">make</th>
<th align="left">model</th>
<th align="left">fueltype</th>
<th align="right">od_read</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="right">2011</td>
<td align="left">Mazda</td>
<td align="left">Mazda3</td>
<td align="left">Gas</td>
<td align="right">83644</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="right">2007</td>
<td align="left">Toyota</td>
<td align="left">Yaris</td>
<td align="left">Gas</td>
<td align="right">120615</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:show-nhts-trips">Table 1.5: </span>NHTS Trips File</caption>
<thead>
<tr class="header">
<th align="left">houseid</th>
<th align="left">personid</th>
<th align="left">strttime</th>
<th align="left">endtime</th>
<th align="right">trpmiles</th>
<th align="left">trptrans</th>
<th align="left">trippurp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="left">2017-10-10 07:45:00</td>
<td align="left">2017-10-10 07:52:00</td>
<td align="right">2.710</td>
<td align="left">Car</td>
<td align="left">Home-based trip (other)</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="left">2017-10-10 08:09:00</td>
<td align="left">2017-10-10 08:13:00</td>
<td align="right">1.432</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="left">2017-10-10 08:24:00</td>
<td align="left">2017-10-10 08:28:00</td>
<td align="right">0.777</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="left">2017-10-10 16:53:00</td>
<td align="left">2017-10-10 16:57:00</td>
<td align="right">1.075</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">01</td>
<td align="left">2017-10-10 17:18:00</td>
<td align="left">2017-10-10 17:26:00</td>
<td align="right">2.727</td>
<td align="left">Car</td>
<td align="left">Home-based trip (other)</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 07:30:00</td>
<td align="left">2017-10-10 07:33:00</td>
<td align="right">2.136</td>
<td align="left">Car</td>
<td align="left">Home-based trip (shopping)</td>
</tr>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 07:38:00</td>
<td align="left">2017-10-10 08:50:00</td>
<td align="right">88.581</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 08:58:00</td>
<td align="left">2017-10-10 09:49:00</td>
<td align="right">45.341</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 10:51:00</td>
<td align="left">2017-10-10 12:24:00</td>
<td align="right">28.208</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 17:00:00</td>
<td align="left">2017-10-10 17:05:00</td>
<td align="right">0.239</td>
<td align="left">Walk</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="odd">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 19:15:00</td>
<td align="left">2017-10-10 19:26:00</td>
<td align="right">0.267</td>
<td align="left">Walk</td>
<td align="left">Not a home-based trip</td>
</tr>
<tr class="even">
<td align="left">30000082</td>
<td align="left">02</td>
<td align="left">2017-10-10 19:30:00</td>
<td align="left">2017-10-10 20:43:00</td>
<td align="right">29.293</td>
<td align="left">Car</td>
<td align="left">Not a home-based trip</td>
</tr>
</tbody>
</table>
<p>Note that that the households data in Table <a href="chap-blocks.html#tab:show-nhts-hh">1.2</a> contains a
numeric column called <code>wthhfin</code>. This is a survey <em>weight</em>. Because it is impossible
to sample everyone in a population, there needs to be a way to <em>expand</em> the survey
to the population. What this number means is that the selected household carries
the same <em>weight</em> in this survey as approximately 1100 households in the general
population. Also note that not every household’s weight will be equal; because
some population groups have different survey response weights, some households
will need to be weighted more heavily so that the survey reflects the general
population. Most software packages have functions that allow you to
calculate statistics or estimate models including weighted values. The code
chunk below shows how to calculate the average number of workers per household
with and without weights in R; as you can see, omitting the weights leads
to a substantial change in the survey analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chap-blocks.html#cb1-1"></a><span class="co"># Average workers per household with no weights</span></span>
<span id="cb1-2"><a href="chap-blocks.html#cb1-2"></a><span class="kw">mean</span>(nhts_households<span class="op">$</span>wrkcount)</span></code></pre></div>
<pre><code>## [1] 0.9891438</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chap-blocks.html#cb3-1"></a><span class="co"># Average workers per household, weighted</span></span>
<span id="cb3-2"><a href="chap-blocks.html#cb3-2"></a><span class="kw">weighted.mean</span>(nhts_households<span class="op">$</span>wrkcount, nhts_households<span class="op">$</span>wthhfin)</span></code></pre></div>
<pre><code>## [1] 1.173206</code></pre>
<p>Travel survey methodology is changing rapidly as a result of mobile devices with
location capabilities. First, most travel surveys are now administered through a
mobile application: respondents are invited to install an app on their smartphone
that tracks the respondent’s position and occasionally asks questions about
trip purpose or mode. This makes collecting and cleaning data considerably easier
than traditional paper surveys, and it also lowers the response burden for the
survey participants. Another change that mobile data has brought to travel surveys
is the introduction of large datasets of location information that planners can
purchase directly from cellular providers or third-party providers. Though these
data do not have all the information on demographics and preferences a survey
would provide, they provide a considerably larger and more detailed sample
on things like overall trip flows. As a result, it may be possible to collect
surveys less frequently, or to reduce survey sample sizes.</p>
</div>
<div id="us-census-bureau" class="section level3">
<h3><span class="header-section-number">1.4.2</span> US Census Bureau</h3>
<p>The primary statistical agency of the United States is the U.S. Census Bureau,
called Census. The need to collect statistics is established in the Constitution,</p>
<blockquote>
<p>Representatives and direct Taxes shall be apportioned among the several States which
may be included within this Union, according to their respective Numbers…
The actual Enumeration shall be made within three Years after the first Meeting
of the Congress of the United States, and within every subsequent Term of ten Years, in
such Manner as they shall by Law direct.</p>
</blockquote>
<p>Since the first census in 1790, Census has collected more data than simply the
number of people in each state. Current programs that are especially important
for travel modeling and other related demographic research include:</p>
<ul>
<li>The <em>Decennial Census of Population and Housing</em> is the thing most people
think of when they think of Census. Every ten years (most recently in 2020),
Census attempts to collect the number, age, and other key population attributes
for every dwelling unit in the United States.</li>
<li>The <em>American Community Survey</em> (ACS) is an annual 1% sample of the US population.
This survey is considerably more detailed than the decennial census, and asks
questions regarding the education and income of household members, how each
worker traveled to work, whether people own or rent their home, etc.</li>
</ul>
<p>The ACS is a particularly useful data set, especially because the decennial
census can become outdated as ten years go by between collections. To protect
the individual identity of ACS respondents, Census engages in a number of
different schemes.</p>
<p>The simplest scheme is data aggregation. ACS data is usually obtained as tables
representing the number of individuals or households in a geographic area that
match a certain category. The data is aggregated in two ways: First, large geographic
areas are aggregated each year, meaning that up-to-date numbers are always
available; Second, smaller geographic areas contain groups of records collected
over the last five years. In this way there is a tradeoff between temporal and
spatial precision that the researcher needs to consider.</p>
<p>Another basic scheme is <strong>top-coding</strong>, where numeric variables are capped at a common
value. The ACS will report how many people in a neighborhood have an income
over $250,000, but not how many have an income over
$1 million. Census will also <strong>suppress</strong> small counts in a category; they will
not reveal how many households have 8, 9, or 10 people, instead collapsing all
of these households into a “seven or more” group. If too few individuals or
households match that category, Census does not provide a count. For example, if
only one household in a neighborhood makes more than $250,000, the ACS table for
that cell will contain no information. That could mean there are zero, one,
four, or some other small number of households
in that category.</p>
<p>Besides tables, the Census releases the ACS Public Use Micro-Sample (PUMS)
containing ACS responses as disaggregate <em>microdata</em>. These data are
geographically located to much larger areas than other ACS records, and Census
does imputation and data swapping on the records to ensure that private
information cannot be disclosed. But studies conducted on ACS PUMS records
reach the same statistical conclusions as studies conducted on the unmodeled and
raw data, making PUMS a useful tool in studying populations.</p>
<div id="geographies" class="section level4">
<h4><span class="header-section-number">1.4.2.1</span> Geographies</h4>
<p>Census data are given in a geographical heirarchy:</p>
<ul>
<li>State</li>
<li>County</li>
<li>Tract</li>
<li>Block Group</li>
<li>Block</li>
</ul>
<p>The bottom three layers are shown in Figure <a href="chap-blocks.html#fig:censusgeos">1.4</a>. Each layer
nests completely within the layer above it. More detailed data is available
at less spatially detailed geographies.</p>
<div class="figure"><span id="fig:censusgeos"></span>
<img src="01-intro_files/figure-html/censusgeos-1.png" alt="US Census Geographies in Central Provo." width="672" />
<p class="caption">
Figure 1.4: US Census Geographies in Central Provo.
</p>
</div>
</div>
</div>
</div>
<div id="statistical-and-mathematical-techniques" class="section level2">
<h2><span class="header-section-number">1.5</span> Statistical and Mathematical Techniques</h2>
<p>Many elements of travel modeling and forecasting require complex numerical and
quantitative techniques. In this section we will present some of these techniques.
Many of the data tables are in the <code>nhts2017</code> package. To install this package,
follow the directions in the <a href="app-rstudio.html#app-rstudio">Appendix</a>.</p>
<div id="continuous-and-discrete-distributions" class="section level3">
<h3><span class="header-section-number">1.5.1</span> Continuous and Discrete Distributions</h3>
<p>In general, statistical variables can fall into one of two categories:</p>
<ul>
<li><em>Continuous</em> variables can take any numeric value along some range</li>
<li><em>Discrete</em> variables can take some limited set of predetermined values</li>
</ul>
<p>A simplistic definition would be to say that continuous variables are numeric and
discrete variables are non-numeric. A continuous variable has statistics such as
a <em>mean</em>, but these statistics do not make sense on discrete variables. In the
NHTS trips dataset, we can compute a mean trip miles, but we cannot compute
a mean trip purpose. Or we can’t compute a mean that makes sense.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chap-blocks.html#cb5-1"></a><span class="co"># mean of continuous variable: trip length</span></span>
<span id="cb5-2"><a href="chap-blocks.html#cb5-2"></a><span class="kw">weighted.mean</span>(nhts_trips<span class="op">$</span>trpmiles, nhts_trips<span class="op">$</span>wttrdfin)</span></code></pre></div>
<pre><code>## [1] 10.69119</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chap-blocks.html#cb7-1"></a><span class="co"># mean of categorical variable: trip purpose</span></span>
<span id="cb7-2"><a href="chap-blocks.html#cb7-2"></a><span class="kw">weighted.mean</span>(nhts_trips<span class="op">$</span>trippurp, nhts_trips<span class="op">$</span>wttrdfin)</span></code></pre></div>
<pre><code>## Error in x * w: non-numeric argument to binary operator</code></pre>
<p>What we can do, however, is we can print a summary table showing the number
of observations that fit in each trip purpose category. Note that sometimes there
will be a category devoted to data that is missing or otherwise invalid.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chap-blocks.html#cb9-1"></a><span class="kw">table</span>(nhts_trips<span class="op">$</span>trippurp)</span></code></pre></div>
<pre><code>## 
##       -9      HBO   HBSHOP HBSOCREC      HBW      NHB 
##       32   190022   195188   110235   117368   310727</code></pre>
<p>Sometimes it is handy to split a continuous variable into categories so that you
can treat it as a discrete variable.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chap-blocks.html#cb11-1"></a>nhts_trips<span class="op">$</span>miles_cat &lt;-<span class="st"> </span><span class="kw">cut</span>(nhts_trips<span class="op">$</span>trpmiles, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="ot">Inf</span>))</span>
<span id="cb11-2"><a href="chap-blocks.html#cb11-2"></a><span class="kw">table</span>(nhts_trips<span class="op">$</span>miles_cat)</span></code></pre></div>
<pre><code>## 
##    (0,10]   (10,20]   (20,30]   (30,50]  (50,100] (100,Inf] 
##    719812    113383     38724     25064     14388     11060</code></pre>
<p>When we visualize the distribution of a continuous variable, we might
use a histogram or density plot, but with a discrete variable we would use
a bar chart.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chap-blocks.html#cb13-1"></a><span class="kw">ggplot</span>(nhts_trips, <span class="kw">aes</span>(<span class="dt">x =</span> trpmiles, <span class="dt">weight =</span> wttrdfin)) <span class="op">+</span></span>
<span id="cb13-2"><a href="chap-blocks.html#cb13-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Trip Distance [Miles]&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Weighted Trips&quot;</span>) <span class="op">+</span></span>
<span id="cb13-3"><a href="chap-blocks.html#cb13-3"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="figure"><span id="fig:dc-histogram"></span>
<img src="01-intro_files/figure-html/dc-histogram-1.png" alt="Visualizing a continuous distribution with a histogram." width="672" />
<p class="caption">
Figure 1.5: Visualizing a continuous distribution with a histogram.
</p>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chap-blocks.html#cb15-1"></a><span class="kw">ggplot</span>(nhts_trips, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as_factor</span>(trippurp, <span class="dt">levels =</span> <span class="st">&quot;labels&quot;</span>), </span>
<span id="cb15-2"><a href="chap-blocks.html#cb15-2"></a>                       <span class="dt">weight =</span> wttrdfin)) <span class="op">+</span></span>
<span id="cb15-3"><a href="chap-blocks.html#cb15-3"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Trip Purpose&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Weighted Trips&quot;</span>) </span></code></pre></div>
<div class="figure"><span id="fig:dc-barchart"></span>
<img src="01-intro_files/figure-html/dc-barchart-1.png" alt="Visualizing a discrete distribution with a bar chart." width="672" />
<p class="caption">
Figure 1.6: Visualizing a discrete distribution with a bar chart.
</p>
</div>
<p>To this point we’ve only looked at the distribution of one variable at a time.
There are lots of cases where someone might want to consider the <em>joint</em>
distribution of two variables. This joint distribution tells you what is happening
with one variable while the other variable changes. In a table like the one below,
the margins of the table (the row and column sums) contain the single variable
distribution. So sometimes we call these the <em>marginal</em> distributions.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="chap-blocks.html#cb16-1"></a><span class="kw">table</span>(nhts_trips<span class="op">$</span>miles_cat, nhts_trips<span class="op">$</span>trippurp)</span></code></pre></div>
<pre><code>##            
##                 -9    HBO HBSHOP HBSOCREC    HBW    NHB
##   (0,10]        23 156315 162602    84980  67162 248730
##   (10,20]        6  20856  19881    13054  28018  31568
##   (20,30]        1   5635   5469     4361  12087  11171
##   (30,50]        0   3592   3427     3267   7117   7661
##   (50,100]       2   1943   2150     2504   2332   5457
##   (100,Inf]      0   1231   1634     1844    597   5754</code></pre>
<p>We can visualize joint distributions as well, and sometimes the results are
quite nice.</p>
<p><img src="01-intro_files/figure-html/dc-joint-hist-1.png" width="672" /></p>
</div>
<div id="ipf" class="section level3">
<h3><span class="header-section-number">1.5.2</span> Iterative Proportional Fitting</h3>
<p>There are times when we know two marginal distributions but do not know the
joint distribution. This can happen for a number of reasons:</p>
<ul>
<li>We know how many households of different sizes and workers, but not how
many large households have multiple workers.</li>
<li>We have a forecast of truck volumes at external roads, but do not know
how many trucks go between the roads.</li>
</ul>
<p>In these situations, a convenient technique is <em>iterative proportional fitting</em>.
This technique updates a joint distribution to match two or more marginal
distributions within a particular tolerance. IPF is complicated to explain but
easy to demonstrate, so let’s go straight into an example.</p>
<p>Let’s say we have a forecast for AADT at three external stations in the future.
We can assume that the two-way AADT is roughly even in each direction, so the
inbound volume at each station is half the AADT. Let’s also say we have an
estimate of where the trips coming at those stations <em>today</em> go today. This
matrix is called a <strong>seed</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="chap-blocks.html#cb18-1"></a><span class="co"># AADT projections</span></span>
<span id="cb18-2"><a href="chap-blocks.html#cb18-2"></a>volumes &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb18-3"><a href="chap-blocks.html#cb18-3"></a>  <span class="dt">Station =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>],</span>
<span id="cb18-4"><a href="chap-blocks.html#cb18-4"></a>  <span class="dt">Volume =</span> <span class="kw">c</span>(<span class="dv">20000</span>, <span class="dv">30000</span>, <span class="dv">35000</span>),</span>
<span id="cb18-5"><a href="chap-blocks.html#cb18-5"></a>  <span class="dt">AADT =</span> Volume <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb18-6"><a href="chap-blocks.html#cb18-6"></a>)</span>
<span id="cb18-7"><a href="chap-blocks.html#cb18-7"></a>volumes</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   Station Volume  AADT
##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 A        20000 40000
## 2 B        30000 60000
## 3 C        35000 70000</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="chap-blocks.html#cb20-1"></a><span class="co"># observed distribution for a seed</span></span>
<span id="cb20-2"><a href="chap-blocks.html#cb20-2"></a>seed &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>( <span class="dv">0</span>,	<span class="dv">7501</span>	,<span class="dv">12500</span>, <span class="dv">8956</span>,	<span class="dv">0</span>, <span class="dv">11879</span>, <span class="dv">9146</span>,	<span class="dv">21044</span>,	<span class="dv">4687</span>),</span>
<span id="cb20-3"><a href="chap-blocks.html#cb20-3"></a>               <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb20-4"><a href="chap-blocks.html#cb20-4"></a><span class="kw">rownames</span>(seed) &lt;-<span class="st"> </span><span class="kw">colnames</span>(seed) &lt;-<span class="st"> </span>volumes<span class="op">$</span>Station</span>
<span id="cb20-5"><a href="chap-blocks.html#cb20-5"></a>seed</span></code></pre></div>
<pre><code>##      A     B     C
## A    0  7501 12500
## B 8956     0 11879
## C 9146 21044  4687</code></pre>
<p>Note that the row and column sums of the matrix do not match the forecast.
But we can multiply each row in the matrix by the new volume estimate and the
proportion of the seed matrix row that is in that cell. This gives us a new
estimate of the cell’s value. Mathematically,</p>
<p><span class="math display" id="eq:ipf">\[\begin{equation}
  S_{n+1, ij} = \frac{m_i * S_{n, ij} }{\sum_{i}S_{ij}}
  \tag{1.6}
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(S\)</span> is the seed matrix and <span class="math inline">\(m\)</span> is the marginal vector. We then repeat with
the other marginal,</p>
<p><span class="math display" id="eq:ipf2">\[\begin{equation}
  S_{n+2, ij} = \frac{m_j * S_{n, ij} }{\sum_{j}S_{ij}}
  \tag{1.7}
\end{equation}\]</span></p>
<p>In this example case, the first row is</p>
<p><span class="math display">\[\begin{align*}
  S_{1, 1 1} &amp;= 20000 * 0 / 20001  &amp;= 0\\
  S_{1, 1 2} &amp;= 20000 * 7501 / 20001  &amp;= 7500.62\\
  S_{1, 1 2} &amp;= 20000 * 12500/ 20001  &amp;= 12499.38\\
\end{align*}\]</span></p>
<p>And the whole row iteration is</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chap-blocks.html#cb22-1"></a><span class="co"># get factor to multiply each row by</span></span>
<span id="cb22-2"><a href="chap-blocks.html#cb22-2"></a>row_factor &lt;-<span class="st"> </span>volumes<span class="op">$</span>Volume <span class="op">/</span><span class="st"> </span><span class="kw">rowSums</span>(seed)</span>
<span id="cb22-3"><a href="chap-blocks.html#cb22-3"></a><span class="co"># multiply across rows, see ?sweep()</span></span>
<span id="cb22-4"><a href="chap-blocks.html#cb22-4"></a><span class="kw">sweep</span>(seed, <span class="dv">1</span>, row_factor, <span class="st">&quot;*&quot;</span>)</span></code></pre></div>
<pre><code>##           A         B        C
## A     0.000  7500.625 12499.38
## B 12895.608     0.000 17104.39
## C  9178.255 21118.215  4703.53</code></pre>
<p>We can write a function that does a complete round of row, then column fitting.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="chap-blocks.html#cb24-1"></a>ipf_round &lt;-<span class="st"> </span><span class="cf">function</span>(marginal1, marginal2, seed) {</span>
<span id="cb24-2"><a href="chap-blocks.html#cb24-2"></a>  <span class="co"># multiply the first marginal through the rows (MARGIN = 1)</span></span>
<span id="cb24-3"><a href="chap-blocks.html#cb24-3"></a>  seed_rows &lt;-<span class="st"> </span><span class="kw">sweep</span>(seed, <span class="dt">MARGIN =</span> <span class="dv">1</span>, marginal1 <span class="op">/</span><span class="st"> </span><span class="kw">rowSums</span>(seed), <span class="st">&quot;*&quot;</span>)</span>
<span id="cb24-4"><a href="chap-blocks.html#cb24-4"></a>  <span class="co"># multiply the second marginal through the columns (MARGIN = 2)</span></span>
<span id="cb24-5"><a href="chap-blocks.html#cb24-5"></a>  seed_cols &lt;-<span class="st"> </span><span class="kw">sweep</span>(seed_rows, <span class="dt">MARGIN =</span> <span class="dv">2</span>, marginal2 <span class="op">/</span><span class="st"> </span><span class="kw">colSums</span>(seed_rows), <span class="st">&quot;*&quot;</span>)</span>
<span id="cb24-6"><a href="chap-blocks.html#cb24-6"></a>  <span class="co"># return</span></span>
<span id="cb24-7"><a href="chap-blocks.html#cb24-7"></a>  seed_cols</span>
<span id="cb24-8"><a href="chap-blocks.html#cb24-8"></a>}</span>
<span id="cb24-9"><a href="chap-blocks.html#cb24-9"></a></span>
<span id="cb24-10"><a href="chap-blocks.html#cb24-10"></a><span class="kw">ipf_round</span>(volumes<span class="op">$</span>Volume, volumes<span class="op">$</span>Volume, seed)</span></code></pre></div>
<pre><code>##           A         B         C
## A     0.000  7862.609 12751.752
## B 11684.052     0.000 17449.749
## C  8315.948 22137.391  4798.499</code></pre>
<p>If we repeat this process for several iterations, we can see that the change
between successive values shrinks. We can use this change to set a tolerance
for when we want the process to stop.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chap-blocks.html#cb26-1"></a>change &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>)</span>
<span id="cb26-2"><a href="chap-blocks.html#cb26-2"></a>joint &lt;-<span class="st"> </span>seed</span>
<span id="cb26-3"><a href="chap-blocks.html#cb26-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</span>
<span id="cb26-4"><a href="chap-blocks.html#cb26-4"></a>  <span class="co"># update joint table</span></span>
<span id="cb26-5"><a href="chap-blocks.html#cb26-5"></a>  new_joint &lt;-<span class="st"> </span><span class="kw">ipf_round</span>(volumes<span class="op">$</span>Volume, volumes<span class="op">$</span>Volume, joint)</span>
<span id="cb26-6"><a href="chap-blocks.html#cb26-6"></a>  <span class="co"># calculate absolute error at this iteration</span></span>
<span id="cb26-7"><a href="chap-blocks.html#cb26-7"></a>  <span class="kw">print</span>(<span class="kw">sum</span>(<span class="kw">abs</span>(new_joint <span class="op">-</span><span class="st"> </span>joint)))</span>
<span id="cb26-8"><a href="chap-blocks.html#cb26-8"></a>  <span class="co"># update joint</span></span>
<span id="cb26-9"><a href="chap-blocks.html#cb26-9"></a>  joint &lt;-<span class="st"> </span>new_joint</span>
<span id="cb26-10"><a href="chap-blocks.html#cb26-10"></a>}</span></code></pre></div>
<pre><code>## [1] 10947.1
## [1] 1550.274
## [1] 325.7515
## [1] 109.2708
## [1] 37.10879</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="chap-blocks.html#cb28-1"></a><span class="co"># final estimate</span></span>
<span id="cb28-2"><a href="chap-blocks.html#cb28-2"></a>new_joint</span></code></pre></div>
<pre><code>##           A         B         C
## A     0.000  7748.922 12251.164
## B 11945.229     0.000 18047.050
## C  8054.771 22251.078  4701.787</code></pre>
<p>A few notes:</p>
<ul>
<li>IPF is not guaranteed to progressively converge. Meaning, it is possible to get
stuck in a loop where the successive change between iterations does not get
smaller. It is important to set a maximum number of iterations.</li>
<li>IPF can work in any number of dimensions. A two-dimensional matrix is easy to
visualize and works as a good example, but that’s by no means an upper limit.
Just keep repeating.</li>
<li>If a cell in a seed matrix has a zero value, all successive iterations will
have zero. If the seed table has a structural zero, keep it in. Otherwise, you
might want to consider overriding the value with a small number.</li>
<li>The process is not consistent: A different seed matrix will lead to a different
outcome. If you are uncertain about your seed matrix, you could consider
taking the average of multiple potential seed matrices.</li>
</ul>
</div>
<div id="regression-analysis" class="section level3">
<h3><span class="header-section-number">1.5.3</span> Regression Analysis</h3>
<p>Consider the basic model in <a href="chap-blocks.html#eq:basic-model">(1.1)</a>. This is a linear model, meaning
that it creates a line that minimizes the error between the points. Figure
<a href="chap-blocks.html#fig:lm-mpg">1.7</a> shows the linear relationship between engine displacement (in
cubic centimeters) and engine miles per gallon in a sample of cars.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="chap-blocks.html#cb30-1"></a><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">y =</span> mpg, <span class="dt">x =</span> disp)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-2"><a href="chap-blocks.html#cb30-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure"><span id="fig:lm-mpg"></span>
<img src="01-intro_files/figure-html/lm-mpg-1.png" alt="Relationship between engine displacement and miles per gallon." width="672" />
<p class="caption">
Figure 1.7: Relationship between engine displacement and miles per gallon.
</p>
</div>
<p>How do we calculate this line? In R, the function to compute a basic linear
regression is <code>lm()</code>. So to regress the <code>mpg</code> variable on the <code>disp</code> variable,</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="chap-blocks.html#cb32-1"></a><span class="co"># y ~ x + x1 + others, from data</span></span>
<span id="cb32-2"><a href="chap-blocks.html#cb32-2"></a>lm1 &lt;-<span class="st">  </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>disp, <span class="dt">data =</span> mtcars)</span>
<span id="cb32-3"><a href="chap-blocks.html#cb32-3"></a><span class="co"># print summary</span></span>
<span id="cb32-4"><a href="chap-blocks.html#cb32-4"></a><span class="kw">summary</span>(lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ disp, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.8922 -2.2022 -0.9631  1.6272  7.2305 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 29.599855   1.229720  24.070  &lt; 2e-16 ***
## disp        -0.041215   0.004712  -8.747 9.38e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.251 on 30 degrees of freedom
## Multiple R-squared:  0.7183,	Adjusted R-squared:  0.709 
## F-statistic: 76.51 on 1 and 30 DF,  p-value: 9.38e-10</code></pre>
<p>What this suggests is that for every additional cc of displacement, the engine
miles per gallon changes by -0.0412151 miles per gallon.
But how does R calculate this?</p>
<p>Assume <span class="math inline">\(y = X\beta + \epsilon\)</span>, we want the estimate <span class="math inline">\(\hat{\beta}\)</span> that minimizes
the total error <span class="math inline">\(\epsilon = y - X\hat(beta)\)</span>. We can measure this total error as
the “sum of squared residuals”
<span class="math display" id="eq:ssr">\[\begin{equation}
  SSR(\hat{\beta}) = \sum(y - X\hat{\beta})^2
  \tag{1.8}
\end{equation}\]</span></p>
<p>If we take derivative of this with respect to <span class="math inline">\(\hat(\beta)\)</span>, set to zero, and solve
for <span class="math inline">\(\hat{\beta}\)</span>, we obtain the following estimate:</p>
<p><span class="math display" id="eq:betahat">\[\begin{equation}
  \hat{\beta} = (X&#39;X)^{-1}X&#39;y
  \tag{1.9}
\end{equation}\]</span></p>
<p>We can calculate this manually in R, and verify that it matches the estimates
obtained through <code>lm()</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="chap-blocks.html#cb34-1"></a>y &lt;-<span class="st"> </span>mtcars<span class="op">$</span>mpg</span>
<span id="cb34-2"><a href="chap-blocks.html#cb34-2"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(mpg <span class="op">~</span><span class="st"> </span>disp, <span class="dt">data =</span> mtcars)</span>
<span id="cb34-3"><a href="chap-blocks.html#cb34-3"></a>(XTX1 &lt;-<span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(X) <span class="op">%*%</span><span class="st"> </span>X))</span></code></pre></div>
<pre><code>##               (Intercept)          disp
## (Intercept)  0.1430397593 -4.845217e-04
## disp        -0.0004845217  2.100025e-06</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="chap-blocks.html#cb36-1"></a>(beta &lt;-<span class="st"> </span>XTX1 <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(X) <span class="op">%*%</span><span class="st"> </span>y)</span></code></pre></div>
<pre><code>##                    [,1]
## (Intercept) 29.59985476
## disp        -0.04121512</code></pre>
<div id="variance-and-confidence-tests" class="section level4">
<h4><span class="header-section-number">1.5.3.1</span> Variance and Confidence Tests</h4>
<p>Because <span class="math inline">\(\hat{\beta}\)</span> is an estimate rather than a population statistic, we have
to consider that the estimate might be erroneous. That is, we need to construct
a hypothesis test,</p>
<p><span class="math display">\[\begin{align*}
  h_0:&amp; \beta = 0\\
  h_a:&amp; \beta \neq 0\\
\end{align*}\]</span></p>
<p>Let’s look at the variance of our least-squares estimates:</p>
<p><span class="math display">\[\begin{align*}
  \hat{\beta} &amp;= (X&#39;X)^{-1}X&#39;(X\beta + \epsilon)\\
  \hat{\beta} &amp;= \beta + (X&#39;X)^{-1}X&#39;\epsilon\\
  Var(\hat{\beta}) &amp;= 0 + (X&#39;X)^{-1}X&#39;\Sigma_{\epsilon} X(X&#39;X)^{-1}\\
\end{align*}\]</span></p>
<p>If we assume that <span class="math inline">\(\epsilon\)</span> is <em>independently and identically distributed</em> (IID)
with mean 0 and variance <span class="math inline">\(\sigma^2\)</span>,</p>
<p><span class="math display">\[\begin{align*}
  \Sigma_\epsilon &amp;= \sigma^2I\\
  Var(\hat{\beta}) &amp;= 0 + (X&#39;X)^{-1}X\sigma^2X(X&#39;X)^{-1}\\
  &amp;= \sigma^2(X&#39;X)^{-1}X&#39;X(X&#39;X)^{-1}\\
  &amp; = \sigma^2(X&#39;X)^{-1}
\end{align*}\]</span></p>
<p>What does IID mean? It means that the distribution of <span class="math inline">\(\epsilon\)</span> does not depend
on the values of <span class="math inline">\(X\)</span>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="chap-blocks.html#cb38-1"></a>e &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>beta</span>
<span id="cb38-2"><a href="chap-blocks.html#cb38-2"></a>s &lt;-<span class="st"> </span><span class="kw">sum</span>(e<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(<span class="kw">nrow</span>(X) <span class="op">-</span><span class="st"> </span><span class="kw">ncol</span>(X))) <span class="co">## SSR / degrees of freedom</span></span>
<span id="cb38-3"><a href="chap-blocks.html#cb38-3"></a>(se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">diag</span>(s <span class="op">*</span><span class="st"> </span>XTX1)))</span></code></pre></div>
<pre><code>## (Intercept)        disp 
## 1.229719515 0.004711833</code></pre>
<p>So, let’s talk about confidence tests using our new measure of the distribution
of <span class="math inline">\(\hat{\beta}\)</span>. What is the probability of observing an estimate
<em>at least this extreme</em> given the null hypothesis that the true value is 0?
The <span class="math inline">\(t\)</span>-statistic is the quotient of <span class="math inline">\(\beta\)</span> and its standard error, with
the <span class="math inline">\(p\)</span>-value determined based on the degrees of freedom of the model.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="chap-blocks.html#cb40-1"></a>(<span class="dt">t =</span> beta <span class="op">/</span><span class="st"> </span>se)</span></code></pre></div>
<pre><code>##                  [,1]
## (Intercept) 24.070411
## disp        -8.747152</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="chap-blocks.html#cb42-1"></a><span class="co"># two-tailed P test with certain degrees of freedom</span></span>
<span id="cb42-2"><a href="chap-blocks.html#cb42-2"></a><span class="dv">2</span><span class="op">*</span>(<span class="kw">pt</span>(<span class="kw">abs</span>(t), <span class="kw">nrow</span>(X) <span class="op">-</span><span class="st"> </span><span class="kw">ncol</span>(X), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<pre><code>##                     [,1]
## (Intercept) 3.576586e-21
## disp        9.380327e-10</code></pre>
<p>Of course, this test is only valid if the errors are IID.
When you <code>plot</code> the results of a linear model, you get a series of diagnostic
plots. The first one is a plot of the residuals at different values of <span class="math inline">\(X\beta\)</span>,
which allows you to visually inspect whether the IID assumption is valid.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="chap-blocks.html#cb44-1"></a><span class="kw">plot</span>(lm1, <span class="dt">which =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="01-intro_files/figure-html/regression-plot-1.png" width="672" /></p>
<p>So, what can you do when the IID assumption is violated? Well, you could try
to transform the data. What if the inverse of displacement is what matters?</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="chap-blocks.html#cb45-1"></a><span class="co"># transform the data</span></span>
<span id="cb45-2"><a href="chap-blocks.html#cb45-2"></a>lm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(mpg) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp), <span class="dt">data =</span> mtcars)</span>
<span id="cb45-3"><a href="chap-blocks.html#cb45-3"></a><span class="kw">plot</span>(lm2, <span class="dt">which =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="01-intro_files/figure-html/regression-inverse-1.png" width="672" /></p>
<p>There might also be other variables that matter. We could add the number of
engine cylinders into our estimation. Both of these are better than the original
model.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="chap-blocks.html#cb46-1"></a>lm3 &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>disp <span class="op">+</span><span class="st"> </span>cyl, <span class="dt">data =</span> mtcars)</span>
<span id="cb46-2"><a href="chap-blocks.html#cb46-2"></a><span class="kw">plot</span>(lm3, <span class="dt">which =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="01-intro_files/figure-html/regression-morevars-1.png" width="672" /></p>
</div>
</div>
<div id="numerical-optimization" class="section level3">
<h3><span class="header-section-number">1.5.4</span> Numerical Optimization</h3>
<p>Let’s say you have a function with a</p>
</div>
</div>
<div id="hw-blocks" class="section level2 unnumbered">
<h2>Homework</h2>
<blockquote>
<p>Some of these questions require a completed run of the demonstration model.
For instructions on accessing and running the model, see the <a href="app-demomodel.html#app-demomodel">Appendix</a></p>
</blockquote>
<ol style="list-style-type: decimal">
<li><p>With the TAZ layer and socioeconomic data in the demonstration model, make a
set of choropleth and / or bar chart maps showing the following socioeconomic
variables:</p>
<ul>
<li>total households</li>
<li>household density (per acre)</li>
<li>total jobs</li>
<li>job density</li>
<li>share of manufacturing vs office vs retail employment</li>
</ul>
<p>Compare your maps with aerial imagery from Google Maps or OpenStreetMap.
Describe the spatial patterns of the socioeconomic data in the model region.
Identify which zones constitute the central business district, and identify any
outlying employment centers.</p></li>
<li><p>With the highway network layer, create maps
showing: link functional type; link free flow speed; and link hourly capacity.
Compare your maps with aerial imagery from Google Maps or OpenStreetMap. Note
that the hourly capacity is not on the input network, so you will need to use a
either the loaded highway network that is output from the model, or an
intermediate network after the initial highway capacity calculations.
Identify the major freeways and principal arterials in the model region.</p></li>
<li><p>Find the shortest free-flow speed path along the network between two zones.
Then find the shortest <em>distance</em> path between the same two zones. Are the paths the
same? Do the paths match what an online mapping service shows for a trip in the
middle of the night?</p></li>
<li><p>Open the highway assignment report, which shows vehicle hours and miles
traveled by facility type. What percent of the region’s VMT occurs on freeways?
What percent of the region’s lane-miles are freeways?</p></li>
<li><p>Create a map of the highway links showing PM
period level of service based on the volume to capacity ratios in the table
below. How would you characterize traffic in Roanoke? Which is the
worst-performing major facility?</p></li>
</ol>
<table>
<thead>
<tr class="header">
<th align="left">LOS</th>
<th align="left">V/C</th>
<th align="left">Color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">&lt; 0.35</td>
<td align="left">Blue</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">0.35 - 0.54</td>
<td align="left">LightBlue</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="left">0.55 - 0.77</td>
<td align="left">Green</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="left">0.78 - 0.93</td>
<td align="left">Yellow</td>
</tr>
<tr class="odd">
<td align="left">E</td>
<td align="left">0.94 - 0.99</td>
<td align="left">Orange</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left"><span class="math inline">\(\geq\)</span> 1.00</td>
<td align="left">Red</td>
</tr>
</tbody>
</table>
</div>
<div id="lab-blocks" class="section level2 unnumbered">
<h2>Lab</h2>
<p>Demographers for the Commonwealth of Virginia — like those in other
states — forecast a certain number of residents, households, and jobs for
many years into the future. But this data alone is not sufficient: We believe
that larger households will make more trips than smaller households.
But we only know how many households and persons there are, and not how many
households of each different size.</p>
<div class="rmdthink">
<p>For example, let’s say that we know there are three households in a zone and nine
persons. Does that mean that there are three 3-person households? Or two one-person
households and one 7-person household? The number and types of trips generated
by these two different scenarios could be very different.</p>
</div>
<p>A <em>household classification</em> model turns these raw counts of households and
persons into distributions of households by size, number of workers, etc. The
Roanoke classification model works in two steps:</p>
<ul>
<li>The model makes a guess at the distribution by multiplying the average
persons, vehicles, or workers per household in a zone by a marginal distribution
determined from Census tables.</li>
<li>The model then adjusts this initial guess (using <a href="chap-blocks.html#ipf">IPF</a>) so that the
joint distribution of households matches what is currently there.</li>
</ul>
<p>The version of the Roanoke model you have installed contains a classification
model, but the marginal and joint distribution tables the model uses contain
nonsense. Your task for this lab is to correct the values in these tables so
that the model will calculate reasonable estimates of the current and future
population.</p>
<div id="marginal-distributions" class="section level3 unnumbered">
<h3>Marginal Distributions</h3>
<p>The United States Census Bureau attempts to count every person in the United
States every ten years. It also surveys a 1% sample of the population each year
for additional statistical questions (in a program called the American Community
Survey), like income and vehicle ownership. In order to protect respondent’s
privacy, Census makes different types of information available at different
geographic levels. For every Census tract in the country, we can get these
marginal distribution tables:</p>
<ul>
<li>Number of households by household size</li>
<li>Number of households by workers per household</li>
<li>Number of households by vehicles available.</li>
</ul>
<p>Using these data, we can calculate how the average distribution of
households changes based on the average household size in the tract. Figure
<a href="chap-blocks.html#fig:hh-marginal">1.8</a> shows precisely this distribution, using a cubic
polynomial to fit the average distribution. Each set of four points represents
one census tract; for instance, the lowest average household size is in tract
<code>51770001100</code> with 1.37 persons per household on average. This tract shows
71% of its households having 1 member, 25% having 2, and about 2 percent each
of 3 and 4+ person households.</p>
<div class="figure"><span id="fig:hh-marginal"></span>
<img src="01-intro_files/figure-html/hh-marginal-1.png" alt="Distribution of households by size, based on average households size." width="672" />
<p class="caption">
Figure 1.8: Distribution of households by size, based on average households size.
</p>
</div>
<p>For the most part the distributions make sense, with a few exceptions. It makes
sense that the proportion of 1-person households decreases with average size,
and that the proportion of 4-person households increases. Each of these curves
turns in a weird direction at the end; however, the wide margin on the
distribution means that we’re not really confident about where the actual
proportion is. We’ll need to do some manual adjusting to these curves.</p>
<p>I have provided you with initial marginal distribution curves for the three
marginal distributions of interest. These files are available
<a href="https://byu.box.com/s/gx9s8ylp46qywo9ira9dxv35f31wz5sg">on Box</a>, and the
starting values are shown graphically in Figure <a href="chap-blocks.html#fig:raw-marginals">1.9</a>.</p>
<div class="figure"><span id="fig:raw-marginals"></span>
<img src="01-intro_files/figure-html/raw-marginals-1.png" alt="Raw marginal distribution curves from Roanoke region." width="672" />
<p class="caption">
Figure 1.9: Raw marginal distribution curves from Roanoke region.
</p>
</div>
<p>Rules you need to follow when adjusting the curves:</p>
<ol style="list-style-type: decimal">
<li>If the average household size is one, then 100% of households must have
one person. The same rule applies to zero workers and zero vehicles.</li>
<li>If the average household size is four, there will still be some households
with only one, two, or three people. This is because the <code>4</code> category really
contains all households with <em>four or more</em> members.</li>
<li>The total proportions across all four marginal curves at each <span class="math inline">\(x\)</span> value
must sum to 1.</li>
</ol>
</div>
<div id="joint-distribution" class="section level3 unnumbered">
<h3>Joint Distribution</h3>
<p>In the section above we created curves to get the marginal distribution of
household size, vehicles, and workers based on the average in a zone. In order to
make sure that the joint distribution of all of these variables is correct, we
will use IPF with a joint table as the seed. Census does not independently
publish 3-dimensional tables, but the Census Transportation Planning Package
(CTPP) is a partnership between AASHTO and the Census Bureau and it publishes
key tables not available in other places.</p>
<p>The CTPP data is available
<a href="http://data5.ctpp.transportation.org/ctpp1216">through the AASHTO website</a>,
or by searching “CTPP”. Find table <code>A112305</code> for the residence counties where
your group members are from. What do you see in this table? What makes sense
and what does not?</p>
<p>I have already gathered the data and done some preliminary preparation for
you to compute the shares that belong in the household seed file. Run the
code below in an R session (with the <code>tidyverse</code> library loaded) to calculate
the necessary shares. Follow along with the code to understand what is happening.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="chap-blocks.html#cb47-1"></a>raw_counts &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://byu.box.com/shared/static/03t5b6g9cw59aroqxarst55t2khnhmcz.csv&quot;</span>) </span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   RESIDENCE = col_character(),
##   persons = col_character(),
##   workers = col_character(),
##   vehicles = col_character(),
##   output = col_character(),
##   count = col_number()
## )</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chap-blocks.html#cb49-1"></a>joint_distribution &lt;-<span class="st"> </span>raw_counts <span class="op">%&gt;%</span></span>
<span id="cb49-2"><a href="chap-blocks.html#cb49-2"></a><span class="st">  </span><span class="co"># the data contain both &quot;estimates&quot; and &quot;margin of error&quot;. We only want to</span></span>
<span id="cb49-3"><a href="chap-blocks.html#cb49-3"></a><span class="st">  </span><span class="co"># keep the estimates rows.</span></span>
<span id="cb49-4"><a href="chap-blocks.html#cb49-4"></a><span class="st">  </span><span class="kw">filter</span>(output <span class="op">==</span><span class="st"> &quot;Estimate&quot;</span>)  <span class="op">%&gt;%</span></span>
<span id="cb49-5"><a href="chap-blocks.html#cb49-5"></a><span class="st">  </span></span>
<span id="cb49-6"><a href="chap-blocks.html#cb49-6"></a><span class="st">  </span><span class="co"># The data records size as text, with `0 workers`. We want to extract the</span></span>
<span id="cb49-7"><a href="chap-blocks.html#cb49-7"></a><span class="st">  </span><span class="co"># numeric information from these fields. This line of code says, for the variables</span></span>
<span id="cb49-8"><a href="chap-blocks.html#cb49-8"></a><span class="st">  </span><span class="co"># persons, workers, and vehicles, take all non-numeric characters and replace</span></span>
<span id="cb49-9"><a href="chap-blocks.html#cb49-9"></a><span class="st">  </span><span class="co"># them with nothing. It looks like gibberish, but it came from lots of Stack</span></span>
<span id="cb49-10"><a href="chap-blocks.html#cb49-10"></a><span class="st">  </span><span class="co"># Overflow searching. I can&#39;t come up with this stuff from thin air, you know.</span></span>
<span id="cb49-11"><a href="chap-blocks.html#cb49-11"></a><span class="st">  </span><span class="kw">mutate_at</span>(</span>
<span id="cb49-12"><a href="chap-blocks.html#cb49-12"></a>    <span class="kw">c</span>(<span class="st">&quot;persons&quot;</span>, <span class="st">&quot;workers&quot;</span>, <span class="st">&quot;vehicles&quot;</span>), </span>
<span id="cb49-13"><a href="chap-blocks.html#cb49-13"></a>    <span class="cf">function</span>(x) {<span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;([0-9]+).*$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, x))}</span>
<span id="cb49-14"><a href="chap-blocks.html#cb49-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb49-15"><a href="chap-blocks.html#cb49-15"></a><span class="st">  </span></span>
<span id="cb49-16"><a href="chap-blocks.html#cb49-16"></a><span class="st">  </span><span class="co"># the rows that say &quot;total households&quot; get turned to NA by the above process, and we</span></span>
<span id="cb49-17"><a href="chap-blocks.html#cb49-17"></a><span class="st">  </span><span class="co"># don&#39;t want to keep those in anyways.</span></span>
<span id="cb49-18"><a href="chap-blocks.html#cb49-18"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(persons), <span class="op">!</span><span class="kw">is.na</span>(workers), <span class="op">!</span><span class="kw">is.na</span>(vehicles)) <span class="op">%&gt;%</span></span>
<span id="cb49-19"><a href="chap-blocks.html#cb49-19"></a><span class="st">  </span></span>
<span id="cb49-20"><a href="chap-blocks.html#cb49-20"></a><span class="st">  </span><span class="co"># the roanoke model only includes households with 3+ workers, not 4+. So if a</span></span>
<span id="cb49-21"><a href="chap-blocks.html#cb49-21"></a><span class="st">  </span><span class="co"># row is for more than 3 workers, we group it as 3</span></span>
<span id="cb49-22"><a href="chap-blocks.html#cb49-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">workers =</span> <span class="kw">ifelse</span>(workers <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>, <span class="dv">3</span>, workers)) <span class="op">%&gt;%</span></span>
<span id="cb49-23"><a href="chap-blocks.html#cb49-23"></a><span class="st">  </span></span>
<span id="cb49-24"><a href="chap-blocks.html#cb49-24"></a><span class="st">  </span><span class="co"># but this creates a problem where we now have multiple rows with</span></span>
<span id="cb49-25"><a href="chap-blocks.html#cb49-25"></a><span class="st">  </span><span class="co"># 3 workers. So we need to group and add up.</span></span>
<span id="cb49-26"><a href="chap-blocks.html#cb49-26"></a><span class="st">  </span><span class="kw">group_by</span>(persons, workers, vehicles) <span class="op">%&gt;%</span></span>
<span id="cb49-27"><a href="chap-blocks.html#cb49-27"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">sum</span>(count)) <span class="op">%&gt;%</span></span>
<span id="cb49-28"><a href="chap-blocks.html#cb49-28"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb49-29"><a href="chap-blocks.html#cb49-29"></a><span class="st">  </span></span>
<span id="cb49-30"><a href="chap-blocks.html#cb49-30"></a><span class="st">  </span><span class="co"># Finally, we want to turn the numbers into a share. So we divde the</span></span>
<span id="cb49-31"><a href="chap-blocks.html#cb49-31"></a><span class="st">  </span><span class="co"># counts by the total count in the whole table.</span></span>
<span id="cb49-32"><a href="chap-blocks.html#cb49-32"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">share =</span> count <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(count))</span></code></pre></div>
<pre><code>## Warning in (function (x) : NAs introduced by coercion</code></pre>
<pre><code>## Warning in (function (x) : NAs introduced by coercion</code></pre>
<pre><code>## Warning in (function (x) : NAs introduced by coercion</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;persons&#39;, &#39;workers&#39; (override with `.groups` argument)</code></pre>
<p>Now we can see the joint distribution of size, workers, and vehicles.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="chap-blocks.html#cb54-1"></a>joint_distribution <span class="op">%&gt;%</span></span>
<span id="cb54-2"><a href="chap-blocks.html#cb54-2"></a><span class="st">  </span><span class="kw">group_by</span>(persons) <span class="op">%&gt;%</span></span>
<span id="cb54-3"><a href="chap-blocks.html#cb54-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>count) <span class="op">%&gt;%</span></span>
<span id="cb54-4"><a href="chap-blocks.html#cb54-4"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> vehicles, <span class="dt">values_from =</span> share, <span class="dt">names_prefix =</span> <span class="st">&quot;vehicles &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-5"><a href="chap-blocks.html#cb54-5"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">persons</th>
<th align="right">workers</th>
<th align="right">vehicles 0</th>
<th align="right">vehicles 1</th>
<th align="right">vehicles 2</th>
<th align="right">vehicles 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.0424577</td>
<td align="right">0.0937149</td>
<td align="right">0.0193590</td>
<td align="right">0.0040148</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.0129243</td>
<td align="right">0.1195635</td>
<td align="right">0.0273885</td>
<td align="right">0.0073146</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0.0079746</td>
<td align="right">0.0269485</td>
<td align="right">0.0441076</td>
<td align="right">0.0211739</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.0088545</td>
<td align="right">0.0369580</td>
<td align="right">0.0531271</td>
<td align="right">0.0283235</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.0019249</td>
<td align="right">0.0120993</td>
<td align="right">0.0742460</td>
<td align="right">0.0378930</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0.0031348</td>
<td align="right">0.0067096</td>
<td align="right">0.0040148</td>
<td align="right">0.0029698</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0.0041248</td>
<td align="right">0.0192490</td>
<td align="right">0.0178740</td>
<td align="right">0.0114394</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="right">0.0008250</td>
<td align="right">0.0051697</td>
<td align="right">0.0323383</td>
<td align="right">0.0255736</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0.0002750</td>
<td align="right">0.0005500</td>
<td align="right">0.0038498</td>
<td align="right">0.0146842</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0.0015949</td>
<td align="right">0.0033548</td>
<td align="right">0.0010999</td>
<td align="right">0.0024749</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">0.0025299</td>
<td align="right">0.0140792</td>
<td align="right">0.0231537</td>
<td align="right">0.0153992</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">2</td>
<td align="right">0.0015399</td>
<td align="right">0.0087445</td>
<td align="right">0.0382779</td>
<td align="right">0.0257936</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">3</td>
<td align="right">0.0001540</td>
<td align="right">0.0021999</td>
<td align="right">0.0027499</td>
<td align="right">0.0237037</td>
</tr>
</tbody>
</table>
<p>This table serves as the seed for the IPF process in the household classification
Save this data table as a DBF file that you can put into the model at
<code>params/classification/hh_seed.dbf</code>. The <code>write.dbf()</code> function is part of the
<code>foreign</code> library.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chap-blocks.html#cb55-1"></a><span class="kw">as.data.frame</span>(joint_distribution) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-2"><a href="chap-blocks.html#cb55-2"></a><span class="st">  </span>foreign<span class="op">::</span><span class="kw">write.dbf</span>(<span class="st">&quot;data/hh_seed.dbf&quot;</span>)</span></code></pre></div>
</div>
<div id="report" class="section level3 unnumbered">
<h3>Report</h3>
<p>For your homework, you should have a complete run of the uncalibrated, “bare”
RVTPO model. Open the “Trip Generation” submodule by double-clicking on the
yellow box labeled <code>Trip Generation</code>. This submodule has two steps: the
household classification model and the trip productions model. You can run
just this step of the model (and not the entire travel model) by clicking the
“Run Application” button in the top-left of the Cube window and then selecting the
“Run current group only” option in the dialog.</p>
<p>Open the classified socioeconomic data file that is an input to the trip
productions step (the file is named <code>se_classified_2012A.dbf</code>), and make
a tabulation report counting up the number of households in each district in the
following three categories:</p>
<ul>
<li><code>W3V0</code> Households with three or more workers and no vehicles.</li>
<li><code>W0V3</code> Households with no workers and three or more vehicles.</li>
<li><code>P2V2</code> Households with two people and two vehicles.</li>
</ul>
<p>The marginal classification curves and the joint distribution seed table are
stored in the <code>params/classification</code> folder. Each file is a <code>.dbf</code> with the
following format:</p>
<ul>
<li><code>hh_size_lookup.dbf</code>: <code>[AVG, PERSONS_1, PERSONS_2, PERSONS_3, PERSONS_4]</code></li>
<li><code>hh_workers_lookup.dbf</code>: <code>[AVG, WORKERS_0, WORKERS_1, WORKERS_2, WORKERS_3]</code></li>
<li><code>hh_vehicles_lookup.dbf</code>: <code>[AVG, VEHICLES_0, VEHICLES_1, VEHICLES_2, VEHICLES_3]</code></li>
<li><code>hh_seed.dbf</code>: <code>[WORKERS, PERSONS, VEHICLES, SHARE]</code></li>
</ul>
<p>Open these files in Cube, and observe that the data contained them is nonsense.
Replace the files in the <code>params/classification</code> folder with the distributions
you created above, including the marginal distribution curves you calibrated by
hand and the household seed you constructed from CTPP. Run the trip generation
submodule again, and recreate the tabulation report you previously created. Do
these numbers make more sense?</p>
<div class="rmdexample">
<p>You can edit the DBF files in Cube by hand; its copy-paste feature is not what
you would expect from a software program in 2020 (or 2005). A more efficient
way might be to use the <code>write.dbf()</code> function in R.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="chap-blocks.html#cb56-1"></a><span class="co"># read the file you edited; there is also a readxl() function for excel</span></span>
<span id="cb56-2"><a href="chap-blocks.html#cb56-2"></a><span class="co"># spreadsheets</span></span>
<span id="cb56-3"><a href="chap-blocks.html#cb56-3"></a><span class="kw">read_csv</span>(<span class="st">&quot;data/raw_size.csv&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb56-4"><a href="chap-blocks.html#cb56-4"></a><span class="st">  </span><span class="co"># need to make sure the names on the columns match what Cube is expecting to</span></span>
<span id="cb56-5"><a href="chap-blocks.html#cb56-5"></a><span class="st">  </span><span class="co"># get; you&#39;ll need to change this for the workers and vehicles</span></span>
<span id="cb56-6"><a href="chap-blocks.html#cb56-6"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">AVG =</span> average, <span class="dt">PERSONS_1 =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">PERSONS_2 =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>,</span>
<span id="cb56-7"><a href="chap-blocks.html#cb56-7"></a>         <span class="st">`</span><span class="dt">PERSONS_3</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">3</span><span class="st">`</span>, <span class="dt">PERSONS_4 =</span> <span class="st">`</span><span class="dt">4</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb56-8"><a href="chap-blocks.html#cb56-8"></a><span class="st">  </span><span class="co"># read_csv makes a modern data frame called a `tibble`. The old DBF function</span></span>
<span id="cb56-9"><a href="chap-blocks.html#cb56-9"></a><span class="st">  </span><span class="co"># has no idea what do to with this. So we need to convert the tibble to an</span></span>
<span id="cb56-10"><a href="chap-blocks.html#cb56-10"></a><span class="st">  </span><span class="co"># old-fashioned `data.frame`</span></span>
<span id="cb56-11"><a href="chap-blocks.html#cb56-11"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb56-12"><a href="chap-blocks.html#cb56-12"></a><span class="st">  </span>foreign<span class="op">::</span><span class="kw">write.dbf</span>(<span class="st">&quot;data/hh_size_lookup.dbf&quot;</span>)</span></code></pre></div>
</div>
<p>The classification model incorporates a zone-level IPF process executed in R; the
script for this process is in <code>R/classification.R</code>. Open the script and find
the place where the maximum IPF iterations are set. Change this parameter to 50,
save the R file, and and re-run both the model and your tabulation report.
Change it again to 100 and note the execution time and any changes in the
tabulation report. How many iterations should you run?</p>
<p>Write a lab report describing the household classification model you have
developed. Describe how you developed your marginal disaggregation curves,
including any assertions you employed in smoothing /adjusting the curves.
Include plots of each curve. Describe how you determined the number of
iterations of IPF to run in your model. Compare the distribution of households
by classification category to the joint distribution you obtained from the CTPP.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-2018aashto">
<p><em>A Policy on Geometric Design of Highways and Streets, 7th Edition,</em> 2018. The Green Book. American Association of State Highway; Transportation Officials. <a href="https://books.google.com/books?id=MWHBDwAAQBAJ">https://books.google.com/books?id=MWHBDwAAQBAJ</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>The primary alternative to the four-step method is called an “activity-based” method. Activity-based models can be significantly more complex to construct and use, but they are based more concretely in human behavior. Whether they actually result in better decisions by transportation planning agencies is an open question.<a href="chap-blocks.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Sometimes called a <em>graph</em> in mathematics.<a href="chap-blocks.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Like a Metropolitan Planning Organization (MPO).<a href="chap-blocks.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-tripgen.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ceen565.pdf", "ceen565.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
