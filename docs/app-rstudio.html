<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>B R and RStudio Help | Urban Transportation Planning</title>
  <meta name="description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="B R and RStudio Help | Urban Transportation Planning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="B R and RStudio Help | Urban Transportation Planning" />
  
  <meta name="twitter:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

<meta name="author" content="Gregory Macfarlane, PhD, PE" />


<meta name="date" content="2020-08-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="app-demomodel.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Transportation Planning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Foreword</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-blocks.html"><a href="chap-blocks.html"><i class="fa fa-check"></i><b>1</b> Building Blocks</a><ul>
<li class="chapter" data-level="1.1" data-path="chap-blocks.html"><a href="chap-blocks.html#planning-for-human-systems"><i class="fa fa-check"></i><b>1.1</b> Planning for Human Systems</a></li>
<li class="chapter" data-level="1.2" data-path="chap-blocks.html"><a href="chap-blocks.html#the-four-step-process"><i class="fa fa-check"></i><b>1.2</b> The Four-Step Process</a></li>
<li class="chapter" data-level="1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-model-building-blocks"><i class="fa fa-check"></i><b>1.3</b> Travel Model Building Blocks</a><ul>
<li class="chapter" data-level="1.3.1" data-path="chap-blocks.html"><a href="chap-blocks.html#household-travel-surveys"><i class="fa fa-check"></i><b>1.3.1</b> Household Travel Surveys</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-analysis-zones"><i class="fa fa-check"></i><b>1.3.2</b> Travel Analysis Zones</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-blocks.html"><a href="chap-blocks.html#highway-networks"><i class="fa fa-check"></i><b>1.3.3</b> Highway Networks</a></li>
<li class="chapter" data-level="1.3.4" data-path="chap-blocks.html"><a href="chap-blocks.html#matrices"><i class="fa fa-check"></i><b>1.3.4</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-blocks.html"><a href="chap-blocks.html#statistical-and-mathematical-techniques"><i class="fa fa-check"></i><b>1.4</b> Statistical and Mathematical Techniques</a><ul>
<li class="chapter" data-level="1.4.1" data-path="chap-blocks.html"><a href="chap-blocks.html#continuous-and-discrete-distributions"><i class="fa fa-check"></i><b>1.4.1</b> Continuous and Discrete Distributions</a></li>
<li class="chapter" data-level="1.4.2" data-path="chap-blocks.html"><a href="chap-blocks.html#iterative-proportional-fitting"><i class="fa fa-check"></i><b>1.4.2</b> Iterative Proportional Fitting</a></li>
<li class="chapter" data-level="1.4.3" data-path="chap-blocks.html"><a href="chap-blocks.html#regression-analysis"><i class="fa fa-check"></i><b>1.4.3</b> Regression Analysis</a></li>
<li class="chapter" data-level="1.4.4" data-path="chap-blocks.html"><a href="chap-blocks.html#numerical-optimization"><i class="fa fa-check"></i><b>1.4.4</b> Numerical Optimization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#hw-blocks"><i class="fa fa-check"></i>Homework</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-tripgen.html"><a href="chap-tripgen.html"><i class="fa fa-check"></i><b>2</b> Trip Generation</a><ul>
<li class="chapter" data-level="2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production"><i class="fa fa-check"></i><b>2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction"><i class="fa fa-check"></i><b>2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.3" data-path="chap-tripgen.html"><a href="chap-tripgen.html#homework"><i class="fa fa-check"></i><b>2.3</b> Homework</a></li>
<li class="chapter" data-level="2.4" data-path="chap-tripgen.html"><a href="chap-tripgen.html#lab"><i class="fa fa-check"></i><b>2.4</b> Lab</a><ul>
<li class="chapter" data-level="2.4.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production-1"><i class="fa fa-check"></i><b>2.4.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.4.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction-1"><i class="fa fa-check"></i><b>2.4.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.4.3" data-path="chap-tripgen.html"><a href="chap-tripgen.html#report"><i class="fa fa-check"></i><b>2.4.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-distribution.html"><a href="chap-distribution.html"><i class="fa fa-check"></i><b>3</b> Trip Distribution</a></li>
<li class="chapter" data-level="4" data-path="chap-modechoice.html"><a href="chap-modechoice.html"><i class="fa fa-check"></i><b>4</b> Mode and Destination Choice</a><ul>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#hw-modechoice"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="4.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#lab-1"><i class="fa fa-check"></i><b>4.1</b> Lab</a><ul>
<li class="chapter" data-level="4.1.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#mode-choice-calibration"><i class="fa fa-check"></i><b>4.1.1</b> Mode Choice Calibration</a></li>
<li class="chapter" data-level="4.1.2" data-path="chap-modechoice.html"><a href="chap-modechoice.html#destination-choice-calibration"><i class="fa fa-check"></i><b>4.1.2</b> Destination Choice Calibration</a></li>
<li class="chapter" data-level="4.1.3" data-path="chap-modechoice.html"><a href="chap-modechoice.html#report-1"><i class="fa fa-check"></i><b>4.1.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-assignment.html"><a href="chap-assignment.html"><i class="fa fa-check"></i><b>5</b> Network Assignment and Validation</a><ul>
<li class="chapter" data-level="" data-path="chap-assignment.html"><a href="chap-assignment.html#hw-assignment"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="5.1" data-path="chap-assignment.html"><a href="chap-assignment.html#laboratory-assignment"><i class="fa fa-check"></i><b>5.1</b> Laboratory Assignment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-process.html"><a href="chap-process.html"><i class="fa fa-check"></i><b>6</b> The Planning Process</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="app-demomodel.html"><a href="app-demomodel.html"><i class="fa fa-check"></i><b>A</b> Demonstration Model</a><ul>
<li class="chapter" data-level="A.1" data-path="app-demomodel.html"><a href="app-demomodel.html#running-the-model"><i class="fa fa-check"></i><b>A.1</b> Running the Model</a></li>
<li class="chapter" data-level="A.2" data-path="app-demomodel.html"><a href="app-demomodel.html#files-and-reports"><i class="fa fa-check"></i><b>A.2</b> Files and Reports</a></li>
<li class="chapter" data-level="A.3" data-path="app-demomodel.html"><a href="app-demomodel.html#cube-tips-and-tricks"><i class="fa fa-check"></i><b>A.3</b> Cube Tips and Tricks</a><ul>
<li class="chapter" data-level="A.3.1" data-path="app-demomodel.html"><a href="app-demomodel.html#shortest-paths"><i class="fa fa-check"></i><b>A.3.1</b> Shortest Paths</a></li>
<li class="chapter" data-level="A.3.2" data-path="app-demomodel.html"><a href="app-demomodel.html#working-with-matrices"><i class="fa fa-check"></i><b>A.3.2</b> Working with Matrices</a></li>
<li class="chapter" data-level="A.3.3" data-path="app-demomodel.html"><a href="app-demomodel.html#writing-custom-scripts"><i class="fa fa-check"></i><b>A.3.3</b> Writing Custom Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="app-rstudio.html"><a href="app-rstudio.html"><i class="fa fa-check"></i><b>B</b> R and RStudio Help</a><ul>
<li class="chapter" data-level="B.1" data-path="app-rstudio.html"><a href="app-rstudio.html#installing"><i class="fa fa-check"></i><b>B.1</b> Installing</a></li>
<li class="chapter" data-level="B.2" data-path="app-rstudio.html"><a href="app-rstudio.html#rstudio-orientation"><i class="fa fa-check"></i><b>B.2</b> RStudio Orientation</a></li>
<li class="chapter" data-level="B.3" data-path="app-rstudio.html"><a href="app-rstudio.html#r-packages"><i class="fa fa-check"></i><b>B.3</b> R Packages</a></li>
<li class="chapter" data-level="B.4" data-path="app-rstudio.html"><a href="app-rstudio.html#working-with-tables"><i class="fa fa-check"></i><b>B.4</b> Working with Tables</a><ul>
<li class="chapter" data-level="B.4.1" data-path="app-rstudio.html"><a href="app-rstudio.html#reading-data"><i class="fa fa-check"></i><b>B.4.1</b> Reading Data</a></li>
<li class="chapter" data-level="B.4.2" data-path="app-rstudio.html"><a href="app-rstudio.html#modifying-and-summarizing-tables"><i class="fa fa-check"></i><b>B.4.2</b> Modifying and Summarizing Tables</a></li>
<li class="chapter" data-level="B.4.3" data-path="app-rstudio.html"><a href="app-rstudio.html#app-mutate"><i class="fa fa-check"></i><b>B.4.3</b> Mutate, Summarize, and Group</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="app-rstudio.html"><a href="app-rstudio.html#graphics-with-ggplot2"><i class="fa fa-check"></i><b>B.5</b> Graphics with <code>ggplot2</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Transportation Planning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="app-rstudio" class="section level1">
<h1><span class="header-section-number">B</span> R and RStudio Help</h1>
<p>R is a powerful, open-source statistical programming language used by both
professional and academic data scientists. It is among the computer languages
most suited to modern data science, and is growing rapidly in its user base and
available packages.</p>
<p>Some students may not feel comfortable working in a programming language like R or
a console-based application like RStudio, especially if they have used applications
primarily through a GUI.
This appendix provides a basic bootcamp for R and Rstudio, but cannot be a
comprehensive manual on RStudio, and it certainly cannot be one for R. Good
places to get more detailed help include:</p>
<ul>
<li>R help manuals</li>
<li>Stack Overflow</li>
</ul>
<p>Some of the sections in this appendix are text-based, and some contain little
more than links to YouTube videos created by me or someone else.</p>
<div id="installing" class="section level2">
<h2><span class="header-section-number">B.1</span> Installing</h2>
<p>There are two pieces of software you should install:</p>
<ul>
<li><strong>R</strong> <a href="https://cran.r-project.org/">https://cran.r-project.org/</a>: this contains
the system libraries necessary to run R commands in a terminal on your computer,
and contains a few additional helper applications. Install the most recent
stable release for your operating system.</li>
<li><strong>RStudio</strong> <a href="https://rstudio.com/products/rstudio/download/">https://rstudio.com/products/rstudio/download/</a> is an integrated application that makes using R considerably easier
with text completion, file managment, and some GUI features.</li>
</ul>
<p>Both software are available for Windows, MacOS, and Linux. The videos and screenshots
of the application I post will use MacOS; the R code for all systems is the same,
and the RStudio interface all systems is very similar with minor differences.</p>
</div>
<div id="rstudio-orientation" class="section level2">
<h2><span class="header-section-number">B.2</span> RStudio Orientation</h2>
<p>The video below gives a very basic introduction to RStudio.
There is also a very useful
<a href="https://resources.rstudio.com/rstudio-cheatsheets/rstudio-ide-cheat-sheet">cheat sheet</a>
for working with RStudio on the Rstudio website.</p>
<iframe src="https://www.youtube.com/embed/c3xv8wOIj-g" width="672" height="400px">
</iframe>
</div>
<div id="r-packages" class="section level2">
<h2><span class="header-section-number">B.3</span> R Packages</h2>
<p>One of the strengths of R is the ability for anyone to write packages. These
packages make it easier to read manipulate, and vizualize data; to estimate
statistical models; or to communicate results.</p>
<p>There are a number of ways to install additional packages. The most straightforward
is to use the <code>install.packages()</code> function in the console. The problems
in this book are solved with two additional packages<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="app-rstudio.html#cb70-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>) <span class="co"># a suite of tools for data manipulation</span></span>
<span id="cb70-2"><a href="app-rstudio.html#cb70-2"></a><span class="kw">install.packages</span>(<span class="st">&quot;mlogit&quot;</span>) <span class="co"># discrete choice modeling</span></span></code></pre></div>
<p>RStudio also contains a GUI interface to install and update packages.</p>
<p>Sometimes you want to use a package that has not yet been pushed to CRAN, the
international repository of “approved” R packages. This may be because the package
is in development, or for one reason or another does not meet CRAN’s standards
for completeness, etc. Oftentimes, the package has been made available on GitHub.
You can install a package directly from GitHub with the <code>remotes</code> library. One
package you will want for the problems in the book is the <code>nhts2017</code> package
on the BYU Transportation GitHub account. This package contains datasets from the 2017
<a href="https://nhts.ornl.gov/">National Household Travel Survey</a>.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="app-rstudio.html#cb71-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>) <span class="co"># tools for installing development packages</span></span>
<span id="cb71-2"><a href="app-rstudio.html#cb71-2"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;byu-transpolab/nhts2017&quot;</span>)</span></code></pre></div>
<p>You only need to <strong>install</strong> a package once on your computer. But every time you
want to <strong>use</strong> a function in a package, you need to load the package with the
<code>library()</code> function. To load the <code>tidyverse</code> packages, for instance,</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="app-rstudio.html#cb72-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.1     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   1.0.0
## ✓ tidyr   1.1.0     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<p>If you get errors when you run the command above, it means that for some reason
you did not install the package correctly. And if you ever get an error like</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="app-rstudio.html#cb76-1"></a><span class="kw">kable</span>(<span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)))</span></code></pre></div>
<pre><code>## Error in kable(tibble(x = 1:2, y = c(&quot;blue&quot;, &quot;red&quot;))): could not find function &quot;kable&quot;</code></pre>
<p>It often means you didn’t load the library. In this case, the <code>kable()</code> function
to make pretty tables is part of the <code>knitr</code> package.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="app-rstudio.html#cb78-1"></a><span class="kw">library</span>(knitr)</span>
<span id="cb78-2"><a href="app-rstudio.html#cb78-2"></a><span class="kw">kable</span>(<span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="left">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">blue</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">red</td>
</tr>
</tbody>
</table>
<p>You can also use a function from a package without loading the library if you
use the <code>::</code> operator, like you did in the <code>remotes::install_github()</code> command
earlier. This is handy if you only want to use one function from a package, or
if you have two functions from different packages with the same name. For example,
when you loaded the <code>tidyverse</code> package, R told you that <code>dplyr::filter()</code> would
mask <code>stats::filter()</code>. So if for some reason you wanted to use the <code>filter</code> function
from the <code>stats</code> package, you would need to use <code>stats::filter()</code>.</p>
</div>
<div id="working-with-tables" class="section level2">
<h2><span class="header-section-number">B.4</span> Working with Tables</h2>
<p>Most data you will work with comes in a <em>tabular</em> form, meaning that the data
is formatted in columns of variables and rows of observations.</p>
<div id="reading-data" class="section level3">
<h3><span class="header-section-number">B.4.1</span> Reading Data</h3>
<p>Tabular data is often stored in a comma-separated values <code>.csv</code> file. To read a
data file like this in R, you can use the <code>read_csv()</code> function included in
<code>tidyverse</code>.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="app-rstudio.html#cb79-1"></a>trips &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/demo_trips.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   houseid = col_double(),
##   personid = col_character(),
##   trpmiles = col_double(),
##   trippurp = col_character()
## )</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="app-rstudio.html#cb81-1"></a><span class="kw">print</span>(trips)</span></code></pre></div>
<pre><code>## # A tibble: 924 x 4
##     houseid personid trpmiles trippurp
##       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
##  1 30182694 01         13.6   HBW     
##  2 40532989 02          9.38  HBSOCREC
##  3 40729475 01          5.06  HBSHOP  
##  4 40290784 01          0.509 HBSOCREC
##  5 30118876 02          0.599 NHB     
##  6 30352119 01         20.3   HBO     
##  7 30085077 01         22.5   NHB     
##  8 30180962 02          0.581 HBSOCREC
##  9 40155356 01          2.74  HBO     
## 10 30069734 01          4.65  NHB     
## # … with 914 more rows</code></pre>
<p>This function will make a guess as to what the columns types should be. Often
we want to keep ID values as characters, even if they are numeric (this preserves
leading <code>0</code> values, etc.). We can tell <code>read_csv()</code> what types we expect with
the <code>col_types</code> argument.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="app-rstudio.html#cb83-1"></a>trips &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/demo_trips.csv&quot;</span>, <span class="dt">col_types =</span> <span class="kw">list</span>(<span class="dt">houseid =</span> <span class="kw">col_character</span>()))</span>
<span id="cb83-2"><a href="app-rstudio.html#cb83-2"></a><span class="kw">print</span>(trips)</span></code></pre></div>
<pre><code>## # A tibble: 924 x 4
##    houseid  personid trpmiles trippurp
##    &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
##  1 30182694 01         13.6   HBW     
##  2 40532989 02          9.38  HBSOCREC
##  3 40729475 01          5.06  HBSHOP  
##  4 40290784 01          0.509 HBSOCREC
##  5 30118876 02          0.599 NHB     
##  6 30352119 01         20.3   HBO     
##  7 30085077 01         22.5   NHB     
##  8 30180962 02          0.581 HBSOCREC
##  9 40155356 01          2.74  HBO     
## 10 30069734 01          4.65  NHB     
## # … with 914 more rows</code></pre>
<p>You can also write tables back to <code>.csv</code> with the <code>write_csv()</code> command.</p>
</div>
<div id="modifying-and-summarizing-tables" class="section level3">
<h3><span class="header-section-number">B.4.2</span> Modifying and Summarizing Tables</h3>
<p>In much of this section, we will work with the <code>nhts_trips</code> dataset of trips
from the 2017 National Household Travel Survey in the <code>nhts2017</code> package you
installed from GitHub above.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="app-rstudio.html#cb85-1"></a><span class="kw">library</span>(nhts2017)</span>
<span id="cb85-2"><a href="app-rstudio.html#cb85-2"></a>trips &lt;-<span class="st"> </span>nhts_trips</span>
<span id="cb85-3"><a href="app-rstudio.html#cb85-3"></a>trips</span></code></pre></div>
<pre><code>## # A tibble: 923,572 x 62
##    houseid personid tdtrpnum strttime            endtime             trvlcmin
##    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;dbl+lb&gt;
##  1 300000… 01              1 2017-10-10 10:00:00 2017-10-10 10:15:00       15
##  2 300000… 01              2 2017-10-10 15:10:00 2017-10-10 15:30:00       20
##  3 300000… 02              1 2017-10-10 07:00:00 2017-10-10 09:00:00      120
##  4 300000… 02              2 2017-10-10 18:00:00 2017-10-10 20:30:00      150
##  5 300000… 03              1 2017-10-10 08:45:00 2017-10-10 09:00:00       15
##  6 300000… 03              2 2017-10-10 14:30:00 2017-10-10 14:45:00       15
##  7 300000… 01              1 2017-10-10 11:15:00 2017-10-10 11:30:00       15
##  8 300000… 01              2 2017-10-10 23:30:00 2017-10-10 23:40:00       10
##  9 300000… 01              1 2017-10-10 05:50:00 2017-10-10 06:05:00       15
## 10 300000… 01              2 2017-10-10 07:00:00 2017-10-10 07:15:00       15
## # … with 923,562 more rows, and 56 more variables: trpmiles &lt;dbl+lbl&gt;,
## #   trptrans &lt;chr+lbl&gt;, trpaccmp &lt;dbl+lbl&gt;, trphhacc &lt;dbl+lbl&gt;,
## #   vehid &lt;chr+lbl&gt;, trwaittm &lt;dbl+lbl&gt;, numtrans &lt;dbl+lbl&gt;, tracctm &lt;dbl+lbl&gt;,
## #   drop_prk &lt;chr+lbl&gt;, tregrtm &lt;dbl+lbl&gt;, whodrove &lt;chr+lbl&gt;,
## #   whyfrom &lt;chr+lbl&gt;, loop_trip &lt;chr+lbl&gt;, trphhveh &lt;chr+lbl&gt;,
## #   hhmemdrv &lt;chr+lbl&gt;, hh_ontd &lt;dbl+lbl&gt;, nonhhcnt &lt;dbl+lbl&gt;,
## #   numontrp &lt;dbl+lbl&gt;, psgr_flg &lt;chr+lbl&gt;, pubtrans &lt;chr+lbl&gt;,
## #   trippurp &lt;chr+lbl&gt;, dweltime &lt;dbl+lbl&gt;, tdwknd &lt;chr+lbl&gt;,
## #   vmt_mile &lt;dbl+lbl&gt;, drvr_flg &lt;chr+lbl&gt;, whytrp1s &lt;chr+lbl&gt;,
## #   ontd_p1 &lt;chr+lbl&gt;, ontd_p2 &lt;chr+lbl&gt;, ontd_p3 &lt;chr+lbl&gt;, ontd_p4 &lt;chr+lbl&gt;,
## #   ontd_p5 &lt;chr+lbl&gt;, ontd_p6 &lt;chr+lbl&gt;, ontd_p7 &lt;chr+lbl&gt;, ontd_p8 &lt;chr+lbl&gt;,
## #   ontd_p9 &lt;chr+lbl&gt;, ontd_p10 &lt;chr+lbl&gt;, ontd_p11 &lt;chr+lbl&gt;,
## #   ontd_p12 &lt;chr+lbl&gt;, ontd_p13 &lt;chr+lbl&gt;, tdcaseid &lt;chr&gt;,
## #   tracc_wlk &lt;chr+lbl&gt;, tracc_pov &lt;chr+lbl&gt;, tracc_bus &lt;chr+lbl&gt;,
## #   tracc_crl &lt;chr+lbl&gt;, tracc_sub &lt;chr+lbl&gt;, tracc_oth &lt;chr+lbl&gt;,
## #   tregr_wlk &lt;chr+lbl&gt;, tregr_pov &lt;chr+lbl&gt;, tregr_bus &lt;chr+lbl&gt;,
## #   tregr_crl &lt;chr+lbl&gt;, tregr_sub &lt;chr+lbl&gt;, tregr_oth &lt;chr+lbl&gt;,
## #   whyto &lt;chr+lbl&gt;, gasprice &lt;chr&gt;, wttrdfin &lt;dbl&gt;, whytrp90 &lt;chr+lbl&gt;</code></pre>
<div id="select-filter-and-chains" class="section level4">
<h4><span class="header-section-number">B.4.2.1</span> Select, Filter, and Chains</h4>
<p>This table is pretty overwhelming. But there are two functions that can help
us pare it down:</p>
<ul>
<li><code>select()</code> lets you select columns in a table using the names of the columns.</li>
<li><code>filter()</code> lets you select rows in a table that meet a certain condition.</li>
</ul>
<p>Let’s practice this by selecting our <code>trips</code> dataset to only include the id
columns, the trip length, and the trip purpose.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="app-rstudio.html#cb87-1"></a><span class="kw">select</span>(trips, houseid, personid, trpmiles, trippurp)</span></code></pre></div>
<pre><code>## # A tibble: 923,572 x 4
##    houseid  personid  trpmiles trippurp                                        
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl+lbl&gt; &lt;chr+lbl&gt;                                       
##  1 30000007 01            5.24 HBO [Home-based trip (other)]                   
##  2 30000007 01            5.15 HBO [Home-based trip (other)]                   
##  3 30000007 02           84.0  HBW [Home-based trip (work)]                    
##  4 30000007 02           81.6  HBW [Home-based trip (work)]                    
##  5 30000007 03            2.25 HBO [Home-based trip (other)]                   
##  6 30000007 03            2.24 HBO [Home-based trip (other)]                   
##  7 30000008 01            8.02 HBW [Home-based trip (work)]                    
##  8 30000008 01            8.02 HBW [Home-based trip (work)]                    
##  9 30000012 01            3.40 HBSOCREC [Home-based trip (social/recreational)]
## 10 30000012 01            3.40 HBSOCREC [Home-based trip (social/recreational)]
## # … with 923,562 more rows</code></pre>
<p>Let’s also practice filtering the <code>trips</code> dataset to only include trips
of the purpose “HBO” (home-based other). Notice how the number of rows
in the table trips is much smaller.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="app-rstudio.html#cb89-1"></a><span class="kw">filter</span>(trips, trippurp <span class="op">==</span><span class="st"> &quot;HBW&quot;</span>) <span class="co"># use double equals as comparison</span></span></code></pre></div>
<pre><code>## # A tibble: 117,368 x 62
##    houseid personid tdtrpnum strttime            endtime             trvlcmin
##    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;dbl+lb&gt;
##  1 300000… 02              1 2017-10-10 07:00:00 2017-10-10 09:00:00      120
##  2 300000… 02              2 2017-10-10 18:00:00 2017-10-10 20:30:00      150
##  3 300000… 01              1 2017-10-10 11:15:00 2017-10-10 11:30:00       15
##  4 300000… 01              2 2017-10-10 23:30:00 2017-10-10 23:40:00       10
##  5 300000… 01              5 2017-10-10 09:00:00 2017-10-10 09:20:00       20
##  6 300000… 01              7 2017-10-10 15:30:00 2017-10-10 16:05:00       35
##  7 300000… 01              1 2017-10-10 08:00:00 2017-10-10 08:20:00       20
##  8 300000… 01              2 2017-10-10 18:00:00 2017-10-10 20:00:00      120
##  9 300000… 02              3 2017-10-10 09:00:00 2017-10-10 11:00:00      120
## 10 300000… 02              4 2017-10-10 18:30:00 2017-10-10 20:30:00      120
## # … with 117,358 more rows, and 56 more variables: trpmiles &lt;dbl+lbl&gt;,
## #   trptrans &lt;chr+lbl&gt;, trpaccmp &lt;dbl+lbl&gt;, trphhacc &lt;dbl+lbl&gt;,
## #   vehid &lt;chr+lbl&gt;, trwaittm &lt;dbl+lbl&gt;, numtrans &lt;dbl+lbl&gt;, tracctm &lt;dbl+lbl&gt;,
## #   drop_prk &lt;chr+lbl&gt;, tregrtm &lt;dbl+lbl&gt;, whodrove &lt;chr+lbl&gt;,
## #   whyfrom &lt;chr+lbl&gt;, loop_trip &lt;chr+lbl&gt;, trphhveh &lt;chr+lbl&gt;,
## #   hhmemdrv &lt;chr+lbl&gt;, hh_ontd &lt;dbl+lbl&gt;, nonhhcnt &lt;dbl+lbl&gt;,
## #   numontrp &lt;dbl+lbl&gt;, psgr_flg &lt;chr+lbl&gt;, pubtrans &lt;chr+lbl&gt;,
## #   trippurp &lt;chr+lbl&gt;, dweltime &lt;dbl+lbl&gt;, tdwknd &lt;chr+lbl&gt;,
## #   vmt_mile &lt;dbl+lbl&gt;, drvr_flg &lt;chr+lbl&gt;, whytrp1s &lt;chr+lbl&gt;,
## #   ontd_p1 &lt;chr+lbl&gt;, ontd_p2 &lt;chr+lbl&gt;, ontd_p3 &lt;chr+lbl&gt;, ontd_p4 &lt;chr+lbl&gt;,
## #   ontd_p5 &lt;chr+lbl&gt;, ontd_p6 &lt;chr+lbl&gt;, ontd_p7 &lt;chr+lbl&gt;, ontd_p8 &lt;chr+lbl&gt;,
## #   ontd_p9 &lt;chr+lbl&gt;, ontd_p10 &lt;chr+lbl&gt;, ontd_p11 &lt;chr+lbl&gt;,
## #   ontd_p12 &lt;chr+lbl&gt;, ontd_p13 &lt;chr+lbl&gt;, tdcaseid &lt;chr&gt;,
## #   tracc_wlk &lt;chr+lbl&gt;, tracc_pov &lt;chr+lbl&gt;, tracc_bus &lt;chr+lbl&gt;,
## #   tracc_crl &lt;chr+lbl&gt;, tracc_sub &lt;chr+lbl&gt;, tracc_oth &lt;chr+lbl&gt;,
## #   tregr_wlk &lt;chr+lbl&gt;, tregr_pov &lt;chr+lbl&gt;, tregr_bus &lt;chr+lbl&gt;,
## #   tregr_crl &lt;chr+lbl&gt;, tregr_sub &lt;chr+lbl&gt;, tregr_oth &lt;chr+lbl&gt;,
## #   whyto &lt;chr+lbl&gt;, gasprice &lt;chr&gt;, wttrdfin &lt;dbl&gt;, whytrp90 &lt;chr+lbl&gt;</code></pre>
<p>One <strong><em>extremely</em></strong> useful feature of the <code>tidyverse</code> functions is the chain
operator, <code>%&gt;%</code>. This operator basically does the opposite of the assigment
operator <code>&lt;-</code>. While assignment says “take the thing on the right and put it in
the thing on the left,” chain says “take the thing on the left and pass it as
the first argument of the function on the right.” What this means in practice is
we can chain R commands together. So we can do the <code>select</code> <em>and</em> the <code>filter</code>
statements in sequence,</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="app-rstudio.html#cb91-1"></a>trips <span class="op">%&gt;%</span></span>
<span id="cb91-2"><a href="app-rstudio.html#cb91-2"></a><span class="st">  </span><span class="kw">select</span>(houseid, personid, trpmiles, trippurp) <span class="op">%&gt;%</span></span>
<span id="cb91-3"><a href="app-rstudio.html#cb91-3"></a><span class="st">  </span><span class="kw">filter</span>(trippurp <span class="op">==</span><span class="st"> &quot;HBW&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 117,368 x 4
##    houseid  personid  trpmiles trippurp                    
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl+lbl&gt; &lt;chr+lbl&gt;                   
##  1 30000007 02           84.0  HBW [Home-based trip (work)]
##  2 30000007 02           81.6  HBW [Home-based trip (work)]
##  3 30000008 01            8.02 HBW [Home-based trip (work)]
##  4 30000008 01            8.02 HBW [Home-based trip (work)]
##  5 30000012 01            4.29 HBW [Home-based trip (work)]
##  6 30000012 01            6.82 HBW [Home-based trip (work)]
##  7 30000039 01           11.5  HBW [Home-based trip (work)]
##  8 30000041 01           73.7  HBW [Home-based trip (work)]
##  9 30000041 02           77.9  HBW [Home-based trip (work)]
## 10 30000041 02           77.8  HBW [Home-based trip (work)]
## # … with 117,358 more rows</code></pre>
<p>Notice that we didn’t have to tell the <code>select</code> and <code>filter</code> functions the
name of the table we were selecting or filtering. The <code>%&gt;%</code> chain operator did
that for us.</p>
<p>Once we have the table we want, we can assign it to a new object called <code>mytrips</code>
In this case, let’s get <code>HBO</code> and <code>HBW</code> trips.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="app-rstudio.html#cb93-1"></a>mytrips &lt;-<span class="st"> </span>trips <span class="op">%&gt;%</span></span>
<span id="cb93-2"><a href="app-rstudio.html#cb93-2"></a><span class="st">  </span><span class="kw">select</span>(houseid, personid, trpmiles, trippurp) <span class="op">%&gt;%</span></span>
<span id="cb93-3"><a href="app-rstudio.html#cb93-3"></a><span class="st">  </span><span class="kw">filter</span>(trippurp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HBW&quot;</span>, <span class="st">&quot;HBO&quot;</span>)) <span class="co"># use %in% for multiple comparisons.</span></span></code></pre></div>
</div>
</div>
<div id="app-mutate" class="section level3">
<h3><span class="header-section-number">B.4.3</span> Mutate, Summarize, and Group</h3>
<p>Sometimes we want to calculate a new column in a table, or recompute an
existing column. We can do that with the <code>mutate</code> function, and we can
put more than one calculation in a single <code>mutate</code> statement.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="app-rstudio.html#cb94-1"></a>mytrips <span class="op">%&gt;%</span></span>
<span id="cb94-2"><a href="app-rstudio.html#cb94-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb94-3"><a href="app-rstudio.html#cb94-3"></a>    <span class="dt">tripkm =</span> trpmiles <span class="op">*</span><span class="st"> </span><span class="fl">1.60934</span>, <span class="co"># convert miles to km.</span></span>
<span id="cb94-4"><a href="app-rstudio.html#cb94-4"></a>    <span class="dt">longtrip =</span> <span class="kw">ifelse</span>(tripkm <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>) <span class="co"># is trip longer than 50 km?</span></span>
<span id="cb94-5"><a href="app-rstudio.html#cb94-5"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 307,390 x 6
##    houseid  personid  trpmiles trippurp                         tripkm longtrip
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl+lbl&gt; &lt;chr+lbl&gt;                     &lt;dbl+lbl&gt; &lt;lgl&gt;   
##  1 30000007 01            5.24 HBO [Home-based trip (other)]      8.44 FALSE   
##  2 30000007 01            5.15 HBO [Home-based trip (other)]      8.29 FALSE   
##  3 30000007 02           84.0  HBW [Home-based trip (work)]     135.   TRUE    
##  4 30000007 02           81.6  HBW [Home-based trip (work)]     131.   TRUE    
##  5 30000007 03            2.25 HBO [Home-based trip (other)]      3.62 FALSE   
##  6 30000007 03            2.24 HBO [Home-based trip (other)]      3.61 FALSE   
##  7 30000008 01            8.02 HBW [Home-based trip (work)]      12.9  FALSE   
##  8 30000008 01            8.02 HBW [Home-based trip (work)]      12.9  FALSE   
##  9 30000012 01            4.29 HBW [Home-based trip (work)]       6.91 FALSE   
## 10 30000012 01            6.82 HBW [Home-based trip (work)]      11.0  FALSE   
## # … with 307,380 more rows</code></pre>
<p>Other times we want to calculate summary statistics like means.
For this we can use the <code>summarize()</code> function.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="app-rstudio.html#cb96-1"></a>mytrips <span class="op">%&gt;%</span></span>
<span id="cb96-2"><a href="app-rstudio.html#cb96-2"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb96-3"><a href="app-rstudio.html#cb96-3"></a>    <span class="dt">mean_trip =</span> <span class="kw">mean</span>(trpmiles),</span>
<span id="cb96-4"><a href="app-rstudio.html#cb96-4"></a>    <span class="dt">sd_trip =</span> <span class="kw">sd</span>(trpmiles),</span>
<span id="cb96-5"><a href="app-rstudio.html#cb96-5"></a>    <span class="dt">max_trip =</span> <span class="kw">max</span>(trpmiles),</span>
<span id="cb96-6"><a href="app-rstudio.html#cb96-6"></a>    <span class="dt">min_trip =</span> <span class="kw">min</span>(trpmiles)</span>
<span id="cb96-7"><a href="app-rstudio.html#cb96-7"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   mean_trip sd_trip max_trip min_trip
##       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1      9.81    32.1    5699.       -9</code></pre>
<p>Finally, we sometimes want to calculate summary statistics for different groups.
We can tell <code>tidyverse</code> to group our tables with the <code>group_by()</code> function.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="app-rstudio.html#cb98-1"></a>mytrips <span class="op">%&gt;%</span></span>
<span id="cb98-2"><a href="app-rstudio.html#cb98-2"></a><span class="st">  </span><span class="kw">group_by</span>(trippurp) <span class="op">%&gt;%</span></span>
<span id="cb98-3"><a href="app-rstudio.html#cb98-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb98-4"><a href="app-rstudio.html#cb98-4"></a>    <span class="dt">mean_trip =</span> <span class="kw">mean</span>(trpmiles),</span>
<span id="cb98-5"><a href="app-rstudio.html#cb98-5"></a>    <span class="dt">sd_trip =</span> <span class="kw">sd</span>(trpmiles),</span>
<span id="cb98-6"><a href="app-rstudio.html#cb98-6"></a>    <span class="dt">max_trip =</span> <span class="kw">max</span>(trpmiles),</span>
<span id="cb98-7"><a href="app-rstudio.html#cb98-7"></a>    <span class="dt">min_trip =</span> <span class="kw">min</span>(trpmiles)</span>
<span id="cb98-8"><a href="app-rstudio.html#cb98-8"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 5
##   trippurp                      mean_trip sd_trip max_trip min_trip
##   &lt;chr+lbl&gt;                         &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 HBO [Home-based trip (other)]      7.73    32.0    5699.       -9
## 2 HBW [Home-based trip (work)]      13.2     31.9    2927.       -9</code></pre>
<blockquote>
<p>As you might expect, work trips are on average longer than other kinds of trips.
But some people report very long trips! You might want to filter your data more
carefully for real analyses.</p>
</blockquote>
</div>
</div>
<div id="graphics-with-ggplot2" class="section level2">
<h2><span class="header-section-number">B.5</span> Graphics with <code>ggplot2</code></h2>
<p>The <code>ggplot2</code> package included in the <code>tidyverse</code> is a very powerful graphics
engine with a relatively easy-to-learn grammar. In fact, the <code>gg</code> stands for
“grammar of graphics” as it implements the grammar defined by
<span class="citation">Wilkinson (<a href="#ref-wilkinson2012grammar" role="doc-biblioref">2012</a>)</span>.</p>
<p>The basic structure of a <code>ggplot2</code> call is constructed as follows:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="app-rstudio.html#cb101-1"></a><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(data aesthetics like x and y coordinates, fill color, etc.)) <span class="op">+</span></span>
<span id="cb101-2"><a href="app-rstudio.html#cb101-2"></a><span class="st">  </span><span class="kw">geom_</span>(geometry style like point, bar, or histogram) <span class="op">+</span></span>
<span id="cb101-3"><a href="app-rstudio.html#cb101-3"></a><span class="st">  </span>other things like theme, color, and labels</span></code></pre></div>
<p>For instance, we can create a histogram of trip lengths in the NHTS by giving
the <code>x</code> aesthetic as the <code>trpmiles</code> column in the <code>mytrips</code> dataset.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="app-rstudio.html#cb102-1"></a><span class="kw">ggplot</span>(mytrips, <span class="kw">aes</span>(<span class="dt">x =</span> trpmiles)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb102-2"><a href="app-rstudio.html#cb102-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-histogram-1.png" width="672" /></p>
<p>This ends up not being very informative because some trips are very long. We
could filter out the long trips within the data argument (Note that we still have
the <code>-9</code> values from the missing information).</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="app-rstudio.html#cb105-1"></a><span class="kw">ggplot</span>(mytrips <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(trpmiles <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">x =</span> trpmiles)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb105-2"><a href="app-rstudio.html#cb105-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-histogram1-1.png" width="672" /></p>
<p>If we wanted to see the difference between lengths of different trip purposes,
we could add a color aesthetic to the plot. By default this stacks the two
categories on top of each other.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="app-rstudio.html#cb108-1"></a><span class="kw">ggplot</span>(mytrips <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(trpmiles <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">x =</span> trpmiles, <span class="dt">fill =</span> <span class="kw">factor</span>(trippurp))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb108-2"><a href="app-rstudio.html#cb108-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-histogram2-1.png" width="672" /></p>
<p>You could also show this with a statistical density (the integral of a density
function is 1). Note that the <code>alpha</code> statement for fill opacity is not included
as an aesthetic, because it doesn’t vary based on any data elements in the way that
the <code>x</code> and <code>fill</code> variables do.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="app-rstudio.html#cb111-1"></a><span class="kw">ggplot</span>(mytrips <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(trpmiles <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">x =</span> trpmiles, <span class="dt">fill =</span> <span class="kw">factor</span>(trippurp))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb111-2"><a href="app-rstudio.html#cb111-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-histogram3-1.png" width="672" /></p>
<p><code>ggplot2</code> also excels at building statistical analysis on top of visualization.
For example, we can see the odometer reading for cars still on the road in
2017 by make.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="app-rstudio.html#cb113-1"></a><span class="kw">set.seed</span>(<span class="dv">15</span>) <span class="co"># so that we pull the same random records each time</span></span>
<span id="cb113-2"><a href="app-rstudio.html#cb113-2"></a><span class="co"># sample 15k vehicles built after 1980 with 0 to 500k miles</span></span>
<span id="cb113-3"><a href="app-rstudio.html#cb113-3"></a>vehicles &lt;-<span class="st"> </span>nhts_vehicles <span class="op">%&gt;%</span></span>
<span id="cb113-4"><a href="app-rstudio.html#cb113-4"></a><span class="st">  </span><span class="co"># convert numeric make to its labeled name, and then group into manufacturers</span></span>
<span id="cb113-5"><a href="app-rstudio.html#cb113-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb113-6"><a href="app-rstudio.html#cb113-6"></a>    <span class="dt">make =</span> <span class="kw">as_factor</span>(make, <span class="dt">levels =</span> <span class="st">&quot;labels&quot;</span>),</span>
<span id="cb113-7"><a href="app-rstudio.html#cb113-7"></a>    <span class="dt">vehtype =</span> <span class="kw">as_factor</span>(vehtype, <span class="dt">levels =</span> <span class="st">&quot;labels&quot;</span>),</span>
<span id="cb113-8"><a href="app-rstudio.html#cb113-8"></a>    <span class="dt">make =</span> <span class="kw">case_when</span>(</span>
<span id="cb113-9"><a href="app-rstudio.html#cb113-9"></a>      make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Toyota&quot;</span>, <span class="st">&quot;Lexus&quot;</span>, <span class="st">&quot;Subaru&quot;</span>) <span class="op">~</span><span class="st"> &quot;Toyota&quot;</span>,</span>
<span id="cb113-10"><a href="app-rstudio.html#cb113-10"></a>      make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ford&quot;</span>, <span class="st">&quot;Lincoln&quot;</span>, <span class="st">&quot;Mercury&quot;</span>) <span class="op">~</span><span class="st"> &quot;Ford&quot;</span>,</span>
<span id="cb113-11"><a href="app-rstudio.html#cb113-11"></a>      make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Chevrolet&quot;</span>, <span class="st">&quot;GMC&quot;</span>, <span class="st">&quot;Pontiac&quot;</span>, <span class="st">&quot;Buick&quot;</span>, <span class="st">&quot;Cadillac&quot;</span>, <span class="st">&quot;Saturn&quot;</span>) <span class="op">~</span><span class="st"> &quot;GM&quot;</span>,</span>
<span id="cb113-12"><a href="app-rstudio.html#cb113-12"></a>      make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Volkswagen&quot;</span>, <span class="st">&quot;Audi&quot;</span>, <span class="st">&quot;Porsche&quot;</span>) <span class="op">~</span><span class="st"> &quot;VW&quot;</span>,</span>
<span id="cb113-13"><a href="app-rstudio.html#cb113-13"></a>      <span class="kw">grepl</span>(<span class="st">&quot;Jeep&quot;</span>, make) <span class="op">|</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;Chrysler&quot;</span>, make) <span class="op">|</span><span class="st"> </span>make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ram&quot;</span>, <span class="st">&quot;Dodge&quot;</span>, <span class="st">&quot;Plymouth&quot;</span>) <span class="op">~</span><span class="st"> &quot;Chrysler&quot;</span>,</span>
<span id="cb113-14"><a href="app-rstudio.html#cb113-14"></a>      make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Honda&quot;</span>, <span class="st">&quot;Acura&quot;</span>) <span class="op">~</span><span class="st"> &quot;Honda&quot;</span>,</span>
<span id="cb113-15"><a href="app-rstudio.html#cb113-15"></a>      make <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Nissan/Datsun&quot;</span>, <span class="st">&quot;Infiniti&quot;</span>) <span class="op">~</span><span class="st"> &quot;Nissan&quot;</span>,</span>
<span id="cb113-16"><a href="app-rstudio.html#cb113-16"></a>      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span> <span class="co"># all other makes</span></span>
<span id="cb113-17"><a href="app-rstudio.html#cb113-17"></a>    ) ,</span>
<span id="cb113-18"><a href="app-rstudio.html#cb113-18"></a>    <span class="dt">vehtype =</span> <span class="kw">case_when</span>(</span>
<span id="cb113-19"><a href="app-rstudio.html#cb113-19"></a>      <span class="kw">grepl</span>(<span class="st">&quot;Car&quot;</span>, vehtype) <span class="op">~</span><span class="st"> &quot;Car&quot;</span>,</span>
<span id="cb113-20"><a href="app-rstudio.html#cb113-20"></a>      <span class="kw">grepl</span>(<span class="st">&quot;Van&quot;</span>, vehtype) <span class="op">~</span><span class="st"> &quot;Van&quot;</span>,</span>
<span id="cb113-21"><a href="app-rstudio.html#cb113-21"></a>      <span class="kw">grepl</span>(<span class="st">&quot;SUV&quot;</span>, vehtype) <span class="op">~</span><span class="st"> &quot;SUV&quot;</span>,</span>
<span id="cb113-22"><a href="app-rstudio.html#cb113-22"></a>      <span class="kw">grepl</span>(<span class="st">&quot;Pickup&quot;</span>, vehtype) <span class="op">~</span><span class="st"> &quot;Pickup&quot;</span>,</span>
<span id="cb113-23"><a href="app-rstudio.html#cb113-23"></a>      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span>,</span>
<span id="cb113-24"><a href="app-rstudio.html#cb113-24"></a>    )</span>
<span id="cb113-25"><a href="app-rstudio.html#cb113-25"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb113-26"><a href="app-rstudio.html#cb113-26"></a><span class="st">  </span><span class="kw">filter</span>(vehtype <span class="op">!=</span><span class="st"> &quot;Other&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-27"><a href="app-rstudio.html#cb113-27"></a><span class="st">  </span><span class="kw">filter</span>(vehyear <span class="op">&gt;</span><span class="st"> </span><span class="dv">1980</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-28"><a href="app-rstudio.html#cb113-28"></a><span class="st">  </span><span class="kw">filter</span>(od_read <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, od_read <span class="op">&lt;</span><span class="st"> </span><span class="dv">500000</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-29"><a href="app-rstudio.html#cb113-29"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">15000</span>) </span>
<span id="cb113-30"><a href="app-rstudio.html#cb113-30"></a>  </span>
<span id="cb113-31"><a href="app-rstudio.html#cb113-31"></a><span class="kw">ggplot</span>(vehicles, <span class="kw">aes</span>(<span class="dt">x =</span> vehyear, <span class="dt">y =</span> od_read, <span class="dt">color =</span> make)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb113-32"><a href="app-rstudio.html#cb113-32"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-vehicles-1.png" width="672" /></p>
<p>This is pretty unreadable. But we can add a few things to the figure to make it a little bit
easier to understand, like smooth average lines and point transparency.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="app-rstudio.html#cb115-1"></a><span class="kw">ggplot</span>(vehicles, <span class="kw">aes</span>(<span class="dt">x =</span> vehyear, <span class="dt">y =</span> od_read, <span class="dt">color =</span> make)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb115-2"><a href="app-rstudio.html#cb115-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb115-3"><a href="app-rstudio.html#cb115-3"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-vehicles1-1.png" width="672" /></p>
<p>Let’s break this out by vehicle type.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="app-rstudio.html#cb118-1"></a><span class="kw">ggplot</span>(vehicles, <span class="kw">aes</span>(<span class="dt">x =</span> vehyear, <span class="dt">y =</span> od_read, <span class="dt">color =</span> make)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb118-2"><a href="app-rstudio.html#cb118-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb118-3"><a href="app-rstudio.html#cb118-3"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb118-4"><a href="app-rstudio.html#cb118-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>vehtype)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-vehicles2-1.png" width="672" /></p>
<p>And let’s clean it up a little bit. This is a figure that you could put in a
published journal article or thesis, if it showed something you cared to show.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="app-rstudio.html#cb121-1"></a><span class="kw">ggplot</span>(vehicles, <span class="kw">aes</span>(<span class="dt">x =</span> vehyear, <span class="dt">y =</span> od_read, <span class="dt">color =</span> make)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb121-2"><a href="app-rstudio.html#cb121-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb121-3"><a href="app-rstudio.html#cb121-3"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="st">&quot;Manufacturer&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb121-4"><a href="app-rstudio.html#cb121-4"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb121-5"><a href="app-rstudio.html#cb121-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>vehtype) <span class="op">+</span></span>
<span id="cb121-6"><a href="app-rstudio.html#cb121-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Vehicle Model Year&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Odometer Reading&quot;</span>) <span class="op">+</span></span>
<span id="cb121-7"><a href="app-rstudio.html#cb121-7"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type haven_labelled. Defaulting to continuous.</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="12_app_rstudio_files/figure-html/ggplot2-vehicles3-1.png" width="672" /></p>

<div id="refs" class="references">
<div>
<p><em>A Policy on Geometric Design of Highways and Streets, 7th Edition,</em> 2018. The Green Book. American Association of State Highway; Transportation Officials. <a href="https://books.google.com/books?id=MWHBDwAAQBAJ">https://books.google.com/books?id=MWHBDwAAQBAJ</a>.</p>
</div>
<div>
<p>Wilkinson, Leland. 2012. “The Grammar of Graphics.” In <em>Handbook of Computational Statistics</em>, 375–414. Springer.</p>
</div>
</div>
</div>
</div>


















<h3>References</h3>
<div id="refs" class="references">
<div id="ref-wilkinson2012grammar">
<p>Wilkinson, Leland. 2012. “The Grammar of Graphics.” In <em>Handbook of Computational Statistics</em>, 375–414. Springer.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p><code>tidyverse</code> is actually a collection
of very useful packages, and many R users just load them all at once.<a href="app-rstudio.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="app-demomodel.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ceen565.pdf", "ceen565.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
