<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Trip Distribution | Urban Transportation Planning</title>
  <meta name="description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Trip Distribution | Urban Transportation Planning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Trip Distribution | Urban Transportation Planning" />
  
  <meta name="twitter:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

<meta name="author" content="Gregory Macfarlane, PhD, PE" />


<meta name="date" content="2020-09-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chap-tripgen.html"/>
<link rel="next" href="chap-modechoice.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Transportation Planning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Foreword</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-blocks.html"><a href="chap-blocks.html"><i class="fa fa-check"></i><b>1</b> Building Blocks</a><ul>
<li class="chapter" data-level="1.1" data-path="chap-blocks.html"><a href="chap-blocks.html#planning-for-human-systems"><i class="fa fa-check"></i><b>1.1</b> Planning for Human Systems</a></li>
<li class="chapter" data-level="1.2" data-path="chap-blocks.html"><a href="chap-blocks.html#the-four-step-transportation-planning-process"><i class="fa fa-check"></i><b>1.2</b> The Four-Step Transportation Planning Process</a></li>
<li class="chapter" data-level="1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-model-building-blocks"><i class="fa fa-check"></i><b>1.3</b> Travel Model Building Blocks</a><ul>
<li class="chapter" data-level="1.3.1" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-analysis-zones-and-se-data"><i class="fa fa-check"></i><b>1.3.1</b> Travel Analysis Zones and SE Data</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-blocks.html"><a href="chap-blocks.html#transportation-networks"><i class="fa fa-check"></i><b>1.3.2</b> Transportation Networks</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-blocks.html"><a href="chap-blocks.html#matrices"><i class="fa fa-check"></i><b>1.3.3</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-blocks.html"><a href="chap-blocks.html#data-inputs"><i class="fa fa-check"></i><b>1.4</b> Data Inputs</a><ul>
<li class="chapter" data-level="1.4.1" data-path="chap-blocks.html"><a href="chap-blocks.html#household-travel-surveys"><i class="fa fa-check"></i><b>1.4.1</b> Household Travel Surveys</a></li>
<li class="chapter" data-level="1.4.2" data-path="chap-blocks.html"><a href="chap-blocks.html#us-census-bureau"><i class="fa fa-check"></i><b>1.4.2</b> US Census Bureau</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="chap-blocks.html"><a href="chap-blocks.html#statistical-and-mathematical-techniques"><i class="fa fa-check"></i><b>1.5</b> Statistical and Mathematical Techniques</a><ul>
<li class="chapter" data-level="1.5.1" data-path="chap-blocks.html"><a href="chap-blocks.html#continuous-and-discrete-distributions"><i class="fa fa-check"></i><b>1.5.1</b> Continuous and Discrete Distributions</a></li>
<li class="chapter" data-level="1.5.2" data-path="chap-blocks.html"><a href="chap-blocks.html#ipf"><i class="fa fa-check"></i><b>1.5.2</b> Iterative Proportional Fitting</a></li>
<li class="chapter" data-level="1.5.3" data-path="chap-blocks.html"><a href="chap-blocks.html#regression-analysis"><i class="fa fa-check"></i><b>1.5.3</b> Regression Analysis</a></li>
<li class="chapter" data-level="1.5.4" data-path="chap-blocks.html"><a href="chap-blocks.html#numerical-optimization"><i class="fa fa-check"></i><b>1.5.4</b> Numerical Optimization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#hw-blocks"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#lab-blocks"><i class="fa fa-check"></i>Lab</a><ul>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#marginal-distributions"><i class="fa fa-check"></i>Marginal Distributions</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#joint-distribution"><i class="fa fa-check"></i>Joint Distribution</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i>Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-tripgen.html"><a href="chap-tripgen.html"><i class="fa fa-check"></i><b>2</b> Trip Generation</a><ul>
<li class="chapter" data-level="2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production"><i class="fa fa-check"></i><b>2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction"><i class="fa fa-check"></i><b>2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="" data-path="chap-tripgen.html"><a href="chap-tripgen.html#hw-generation"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-tripgen.html"><a href="chap-tripgen.html#lab-generation"><i class="fa fa-check"></i>Lab</a><ul>
<li class="chapter" data-level="2.2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production-1"><i class="fa fa-check"></i><b>2.2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction-1"><i class="fa fa-check"></i><b>2.2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.2.3" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i><b>2.2.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-distribution.html"><a href="chap-distribution.html"><i class="fa fa-check"></i><b>3</b> Trip Distribution</a><ul>
<li class="chapter" data-level="" data-path="chap-distribution.html"><a href="chap-distribution.html#hw-distribution"><i class="fa fa-check"></i>Homework</a><ul>
<li class="chapter" data-level="3.0.1" data-path="chap-distribution.html"><a href="chap-distribution.html#first-problem-gravity-model-development"><i class="fa fa-check"></i><b>3.0.1</b> First Problem: Gravity Model Development</a></li>
<li class="chapter" data-level="3.0.2" data-path="chap-distribution.html"><a href="chap-distribution.html#second-problem-model-application"><i class="fa fa-check"></i><b>3.0.2</b> Second Problem: Model Application</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-modechoice.html"><a href="chap-modechoice.html"><i class="fa fa-check"></i><b>4</b> Mode and Destination Choice</a><ul>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#hw-modechoice"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="4.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#lab"><i class="fa fa-check"></i><b>4.1</b> Lab</a><ul>
<li class="chapter" data-level="4.1.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#mode-choice-calibration"><i class="fa fa-check"></i><b>4.1.1</b> Mode Choice Calibration</a></li>
<li class="chapter" data-level="4.1.2" data-path="chap-modechoice.html"><a href="chap-modechoice.html#destination-choice-calibration"><i class="fa fa-check"></i><b>4.1.2</b> Destination Choice Calibration</a></li>
<li class="chapter" data-level="4.1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i><b>4.1.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-assignment.html"><a href="chap-assignment.html"><i class="fa fa-check"></i><b>5</b> Network Assignment and Validation</a><ul>
<li class="chapter" data-level="" data-path="chap-assignment.html"><a href="chap-assignment.html#hw-assignment"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="5.1" data-path="chap-assignment.html"><a href="chap-assignment.html#laboratory-assignment"><i class="fa fa-check"></i><b>5.1</b> Laboratory Assignment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-process.html"><a href="chap-process.html"><i class="fa fa-check"></i><b>6</b> The Planning Process</a></li>
<li class="appendix"><span><b>Appendix</b></span><ul>
<li class="chapter" data-level="1" data-path="chap-process.html"><a href="chap-process.html#running-the-model"><i class="fa fa-check"></i><b>1</b> Running the Model</a></li>
<li class="chapter" data-level="2" data-path="chap-process.html"><a href="chap-process.html#files-and-reports"><i class="fa fa-check"></i><b>2</b> Files and Reports</a></li>
<li class="chapter" data-level="3" data-path="chap-process.html"><a href="chap-process.html#network-and-zone-maps"><i class="fa fa-check"></i><b>3</b> Network and Zone Maps</a><ul>
<li class="chapter" data-level="3.1" data-path="chap-process.html"><a href="chap-process.html#shortest-paths"><i class="fa fa-check"></i><b>3.1</b> Shortest Paths</a></li>
<li class="chapter" data-level="3.2" data-path="chap-process.html"><a href="chap-process.html#working-with-matrices"><i class="fa fa-check"></i><b>3.2</b> Working with Matrices</a></li>
<li class="chapter" data-level="3.3" data-path="chap-process.html"><a href="chap-process.html#writing-custom-scripts"><i class="fa fa-check"></i><b>3.3</b> Writing Custom Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="A" data-path="app-rstudio.html"><a href="app-rstudio.html"><i class="fa fa-check"></i><b>A</b> R and RStudio Help</a><ul>
<li class="chapter" data-level="A.1" data-path="app-rstudio.html"><a href="app-rstudio.html#installing"><i class="fa fa-check"></i><b>A.1</b> Installing</a></li>
<li class="chapter" data-level="A.2" data-path="app-rstudio.html"><a href="app-rstudio.html#rstudio-orientation"><i class="fa fa-check"></i><b>A.2</b> RStudio Orientation</a></li>
<li class="chapter" data-level="A.3" data-path="app-rstudio.html"><a href="app-rstudio.html#r-packages"><i class="fa fa-check"></i><b>A.3</b> R Packages</a></li>
<li class="chapter" data-level="A.4" data-path="app-rstudio.html"><a href="app-rstudio.html#working-with-tables"><i class="fa fa-check"></i><b>A.4</b> Working with Tables</a><ul>
<li class="chapter" data-level="A.4.1" data-path="app-rstudio.html"><a href="app-rstudio.html#reading-data"><i class="fa fa-check"></i><b>A.4.1</b> Reading Data</a></li>
<li class="chapter" data-level="A.4.2" data-path="app-rstudio.html"><a href="app-rstudio.html#modifying-and-summarizing-tables"><i class="fa fa-check"></i><b>A.4.2</b> Modifying and Summarizing Tables</a></li>
<li class="chapter" data-level="A.4.3" data-path="app-rstudio.html"><a href="app-rstudio.html#app-mutate"><i class="fa fa-check"></i><b>A.4.3</b> Mutate, Summarize, and Group</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="app-rstudio.html"><a href="app-rstudio.html#graphics-with-ggplot2"><i class="fa fa-check"></i><b>A.5</b> Graphics with <code>ggplot2</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Transportation Planning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap-distribution" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Trip Distribution</h1>
<p>The trip distribution model is the second component in a traditional 4-step model. The purpose of the trip distribution model is to produce a trip table with the estimated number of trips from each TAZ to every other TAZ in the study area. To do this, predicted productions at each origin TAZ, and predicted attractions at each destination TAZ are combined to create a production-attraction model. Your homework this week will focus on a basic, three zone system which you will calibrate using a Gravity Model. The Gravity Model assumes that the number of trips between any two zones is either directly proportional to the trips produced and attracted, or is inversely proportional to the travel time between two zones.</p>
<p>Please reference this article from the Travel Forecasting Resource for more information about trip distribution: <a href="https://tfresource.org/topics/Trip_distribution.html">Trip Distribution Article</a></p>
<div id="hw-distribution" class="section level2 unnumbered">
<h2>Homework</h2>
<div class="figure"><span id="fig:networkgraph"></span>
<img src="images/03_networkgraph.png" alt="Simple 3-Zone System." width="570" />
<p class="caption">
Figure 3.1: Simple 3-Zone System.
</p>
</div>
<p>Figure 3.1 shows a basic three-zone system,
including the
productions and attractions at each zone, as well as the travel times between them.</p>
<p>Figure <a href="chap-distribution.html#fig:networkgraph">3.1</a><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
presents a simple three zone system, the link travel times for this system (for
internal trips, <span class="math inline">\(t_{ii}=2\)</span> globally), and the zonal productions and attractions.
Assume a gravity model of the form</p>
<p><span class="math display">\[T_{ij}=\frac{P_iA_j^*(t_{ij})^{-b}}{\sum_{j&#39;}A^*_{j&#39;}(t_{ij})^{-b}}\]</span></p>
<p>where <span class="math inline">\(A_j^*\)</span> is a “modified attraction term” defined by the
algorithm shown in Figure <a href="chap-distribution.html#fig:tripbalancing">3.2</a> below. This algorithm
constrains the predicted trips to a given zone to equal the true zonal
attractions <span class="math inline">\(A_j\)</span>.</p>
<div class="figure"><span id="fig:tripbalancing"></span>
<img src="images/03_algorithm.png" alt="Trip balancing algorithm." width="384" />
<p class="caption">
Figure 3.2: Trip balancing algorithm.
</p>
</div>
<div id="first-problem-gravity-model-development" class="section level3">
<h3><span class="header-section-number">3.0.1</span> First Problem: Gravity Model Development</h3>
<p>Write a computer program or build a spreadsheet that computes the
O-D flows for this system using the algorithm (with <span class="math inline">\(\varepsilon=1\)</span>). Find the
value of <span class="math inline">\(b\)</span> (to a single decimal place) which provides the “best fit” with the
observed O-D matrix in the table below. Discuss how you determined which <span class="math inline">\(b\)</span>
value gave the “best fit.”</p>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(i\)</span></th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="center">80</td>
<td align="center">5</td>
<td align="center">15</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">80</td>
<td align="center">40</td>
<td align="center">80</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="center">40</td>
<td align="center">5</td>
<td align="center">55</td>
</tr>
</tbody>
</table>
<p>The function below shows how to calculate one round of a gravity model in R.
The function takes the production and attractions vector, in addition to the
cost matrix and the impedance parameter, and calculates the <span class="math inline">\(T_{ij}\)</span> matrix.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chap-distribution.html#cb1-1"></a><span class="co">#&#39; Gravity Model</span></span>
<span id="cb1-2"><a href="chap-distribution.html#cb1-2"></a><span class="co">#&#39; @param p vector of productions, length n</span></span>
<span id="cb1-3"><a href="chap-distribution.html#cb1-3"></a><span class="co">#&#39; @param A vector of attractions, lenth n</span></span>
<span id="cb1-4"><a href="chap-distribution.html#cb1-4"></a><span class="co">#&#39; @param C matrix of impedances, dim n x n</span></span>
<span id="cb1-5"><a href="chap-distribution.html#cb1-5"></a><span class="co">#&#39; @param b impedance parameter</span></span>
<span id="cb1-6"><a href="chap-distribution.html#cb1-6"></a>gravity &lt;-<span class="st"> </span><span class="cf">function</span>(p, a, C, b){</span>
<span id="cb1-7"><a href="chap-distribution.html#cb1-7"></a>  <span class="co"># output matrix (all 0 here)</span></span>
<span id="cb1-8"><a href="chap-distribution.html#cb1-8"></a>  trips &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow =</span> <span class="kw">length</span>(p), <span class="dt">ncol =</span> <span class="kw">length</span>(a)) </span>
<span id="cb1-9"><a href="chap-distribution.html#cb1-9"></a>  <span class="co"># loop over all rows (production)</span></span>
<span id="cb1-10"><a href="chap-distribution.html#cb1-10"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(p)) {</span>
<span id="cb1-11"><a href="chap-distribution.html#cb1-11"></a>    bottomA &lt;-<span class="st"> </span><span class="kw">sum</span>(a <span class="op">*</span><span class="st"> </span>C[i, ]<span class="op">^</span>(<span class="op">-</span>b)) <span class="co"># denominator</span></span>
<span id="cb1-12"><a href="chap-distribution.html#cb1-12"></a>    </span>
<span id="cb1-13"><a href="chap-distribution.html#cb1-13"></a>    <span class="co"># loop over all columns (attraction)</span></span>
<span id="cb1-14"><a href="chap-distribution.html#cb1-14"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(a)) {</span>
<span id="cb1-15"><a href="chap-distribution.html#cb1-15"></a>      <span class="co"># calculate gravity model for trips from i to j</span></span>
<span id="cb1-16"><a href="chap-distribution.html#cb1-16"></a>      topA &lt;-<span class="st"> </span>a[j] <span class="op">*</span><span class="st"> </span>C[i,j]<span class="op">^</span>(<span class="op">-</span>b)</span>
<span id="cb1-17"><a href="chap-distribution.html#cb1-17"></a>      trips[i, j] &lt;-<span class="st">  </span>p[i] <span class="op">*</span><span class="st"> </span>topA <span class="op">/</span><span class="st"> </span>bottomA</span>
<span id="cb1-18"><a href="chap-distribution.html#cb1-18"></a>    }</span>
<span id="cb1-19"><a href="chap-distribution.html#cb1-19"></a>  }</span>
<span id="cb1-20"><a href="chap-distribution.html#cb1-20"></a>  </span>
<span id="cb1-21"><a href="chap-distribution.html#cb1-21"></a>  <span class="kw">return</span>(trips)</span>
<span id="cb1-22"><a href="chap-distribution.html#cb1-22"></a>}</span></code></pre></div>
<p>Once you have this function (as well as the necessary vectors and cost matrix),
you can calculate the gravity model with arbitrary values of the impedance coefficient.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="chap-distribution.html#cb2-1"></a><span class="co"># calculate one round of gravity model with </span></span>
<span id="cb2-2"><a href="chap-distribution.html#cb2-2"></a>p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">100</span>)</span>
<span id="cb2-3"><a href="chap-distribution.html#cb2-3"></a>a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">50</span>, <span class="dv">150</span>)</span>
<span id="cb2-4"><a href="chap-distribution.html#cb2-4"></a>C &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>), <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb2-5"><a href="chap-distribution.html#cb2-5"></a><span class="kw">gravity</span>(p, a, C, <span class="dt">b =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>##          [,1]      [,2]     [,3]
## [1,] 59.22613  9.364473 31.40940
## [2,] 84.61917 33.448665 81.93216
## [3,] 42.56523 12.287524 45.14725</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chap-distribution.html#cb4-1"></a><span class="kw">gravity</span>(p, a, C, <span class="dt">b =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<pre><code>##          [,1]      [,2]     [,3]
## [1,] 75.27793  4.760994 19.96108
## [2,] 55.52540 54.870858 89.60374
## [3,] 28.52074 10.977638 60.50162</code></pre>
<p>The code I provided above is real, and will work for you if you choose to do
this exercise in R. The code below is pseudo-code that you will need to flesh
out on your own (and with your classmates) to accomplish the first part of this
homework. You will need to figure out how to store the adjusted attractions
vector, as well as how to compute the error between successive iterations of the
algorithm.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chap-distribution.html#cb6-1"></a><span class="co">#&#39; Function to balance gravity model PSEUDO-CODE</span></span>
<span id="cb6-2"><a href="chap-distribution.html#cb6-2"></a><span class="co">#&#39; @param p vector of productions, length n</span></span>
<span id="cb6-3"><a href="chap-distribution.html#cb6-3"></a><span class="co">#&#39; @param A vector of attractions, lenth n</span></span>
<span id="cb6-4"><a href="chap-distribution.html#cb6-4"></a><span class="co">#&#39; @param C matrix of impedances, dim n x n</span></span>
<span id="cb6-5"><a href="chap-distribution.html#cb6-5"></a><span class="co">#&#39; @param b impedance parameter</span></span>
<span id="cb6-6"><a href="chap-distribution.html#cb6-6"></a><span class="co">#&#39; @param tolerance Acceptable change in trips matrix</span></span>
<span id="cb6-7"><a href="chap-distribution.html#cb6-7"></a><span class="kw">balance_gravity</span>(p, a, C, b, tolerance) {</span>
<span id="cb6-8"><a href="chap-distribution.html#cb6-8"></a>  <span class="co"># loop through algorithm</span></span>
<span id="cb6-9"><a href="chap-distribution.html#cb6-9"></a>  <span class="cf">while</span>(error <span class="op">&gt;</span><span class="st"> </span>tolerance){</span>
<span id="cb6-10"><a href="chap-distribution.html#cb6-10"></a>    <span class="co"># compute gravity model with adjusted attractions, using your function</span></span>
<span id="cb6-11"><a href="chap-distribution.html#cb6-11"></a>    trips &lt;-<span class="st"> </span><span class="kw">gravity</span>(p, astar, C, b) </span>
<span id="cb6-12"><a href="chap-distribution.html#cb6-12"></a>    <span class="co"># calculate the error as the change in trips in successive iterations</span></span>
<span id="cb6-13"><a href="chap-distribution.html#cb6-13"></a>  }</span>
<span id="cb6-14"><a href="chap-distribution.html#cb6-14"></a>  <span class="kw">return</span>(trips)</span>
<span id="cb6-15"><a href="chap-distribution.html#cb6-15"></a>}</span></code></pre></div>
<p>Once you have the algorithm in place, you will need to determine how you will
decide which value of <code>b</code> minimizes the total error between the predicted and
observed trip distribution. You could solve this manually by trying different
values of beta, or by using a goal seek / optimization program. The choice
is yours, but you should document what you do in your homework response.</p>
</div>
<div id="second-problem-model-application" class="section level3">
<h3><span class="header-section-number">3.0.2</span> Second Problem: Model Application</h3>
<p>The region represented in Problem 1 has begun improvements to the
link between zones 1 and 2 that will reduce the travel cost from 5 to 3. Using
your algorithm and the value of <span class="math inline">\(b\)</span> estimated above, determine the effect of this
improvement on the predicted trip distribution matrix.<br />
Is the response reasonable?</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>This problem is adapted with permission from
<em>Urban Transportation Planning: Second Edition</em> by Michael D. Meyer and
Eric J. Miller.<a href="chap-distribution.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chap-tripgen.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-modechoice.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ceen565.pdf", "ceen565.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
