<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Trip Distribution | Urban Transportation Planning</title>
  <meta name="description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Trip Distribution | Urban Transportation Planning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Trip Distribution | Urban Transportation Planning" />
  
  <meta name="twitter:description" content="These are notes and assignments related to the Urban Transportation Planning class at BYU." />
  

<meta name="author" content="Gregory Macfarlane, PhD, PE" />


<meta name="date" content="2021-10-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chap-tripgen.html"/>
<link rel="next" href="chap-modechoice.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Urban Transportation Planning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Foreword</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="chap-blocks.html"><a href="chap-blocks.html"><i class="fa fa-check"></i><b>1</b> Building Blocks</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chap-blocks.html"><a href="chap-blocks.html#planning-for-human-systems"><i class="fa fa-check"></i><b>1.1</b> Planning for Human Systems</a></li>
<li class="chapter" data-level="1.2" data-path="chap-blocks.html"><a href="chap-blocks.html#the-four-step-transportation-planning-process"><i class="fa fa-check"></i><b>1.2</b> The Four-Step Transportation Planning Process</a></li>
<li class="chapter" data-level="1.3" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-model-building-blocks"><i class="fa fa-check"></i><b>1.3</b> Travel Model Building Blocks</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="chap-blocks.html"><a href="chap-blocks.html#travel-analysis-zones-and-se-data"><i class="fa fa-check"></i><b>1.3.1</b> Travel Analysis Zones and SE Data</a></li>
<li class="chapter" data-level="1.3.2" data-path="chap-blocks.html"><a href="chap-blocks.html#transportation-networks"><i class="fa fa-check"></i><b>1.3.2</b> Transportation Networks</a></li>
<li class="chapter" data-level="1.3.3" data-path="chap-blocks.html"><a href="chap-blocks.html#matrices"><i class="fa fa-check"></i><b>1.3.3</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chap-blocks.html"><a href="chap-blocks.html#data-inputs"><i class="fa fa-check"></i><b>1.4</b> Data Inputs</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="chap-blocks.html"><a href="chap-blocks.html#household-travel-surveys"><i class="fa fa-check"></i><b>1.4.1</b> Household Travel Surveys</a></li>
<li class="chapter" data-level="1.4.2" data-path="chap-blocks.html"><a href="chap-blocks.html#us-census-bureau"><i class="fa fa-check"></i><b>1.4.2</b> US Census Bureau</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="chap-blocks.html"><a href="chap-blocks.html#statistical-and-mathematical-techniques"><i class="fa fa-check"></i><b>1.5</b> Statistical and Mathematical Techniques</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="chap-blocks.html"><a href="chap-blocks.html#continuous-and-discrete-distributions"><i class="fa fa-check"></i><b>1.5.1</b> Continuous and Discrete Distributions</a></li>
<li class="chapter" data-level="1.5.2" data-path="chap-blocks.html"><a href="chap-blocks.html#ipf"><i class="fa fa-check"></i><b>1.5.2</b> Iterative Proportional Fitting</a></li>
<li class="chapter" data-level="1.5.3" data-path="chap-blocks.html"><a href="chap-blocks.html#regression-analysis"><i class="fa fa-check"></i><b>1.5.3</b> Regression Analysis</a></li>
<li class="chapter" data-level="1.5.4" data-path="chap-blocks.html"><a href="chap-blocks.html#numerical-optimization"><i class="fa fa-check"></i><b>1.5.4</b> Numerical Optimization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#hw-blocks"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#lab-blocks"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#marginal-distributions"><i class="fa fa-check"></i>Marginal Distributions</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#joint-distribution"><i class="fa fa-check"></i>Joint Distribution</a></li>
<li class="chapter" data-level="" data-path="chap-blocks.html"><a href="chap-blocks.html#report"><i class="fa fa-check"></i>Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-tripgen.html"><a href="chap-tripgen.html"><i class="fa fa-check"></i><b>2</b> Trip Generation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production"><i class="fa fa-check"></i><b>2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction"><i class="fa fa-check"></i><b>2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="" data-path="chap-tripgen.html"><a href="chap-tripgen.html#hw-generation"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-tripgen.html"><a href="chap-tripgen.html#lab-generation"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-production-1"><i class="fa fa-check"></i><b>2.2.1</b> Trip Production</a></li>
<li class="chapter" data-level="2.2.2" data-path="chap-tripgen.html"><a href="chap-tripgen.html#trip-attraction-1"><i class="fa fa-check"></i><b>2.2.2</b> Trip Attraction</a></li>
<li class="chapter" data-level="2.2.3" data-path="chap-tripgen.html"><a href="chap-tripgen.html#report-1"><i class="fa fa-check"></i><b>2.2.3</b> Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-distribution.html"><a href="chap-distribution.html"><i class="fa fa-check"></i><b>3</b> Trip Distribution</a>
<ul>
<li class="chapter" data-level="" data-path="chap-distribution.html"><a href="chap-distribution.html#hw-distribution"><i class="fa fa-check"></i>Homework</a>
<ul>
<li class="chapter" data-level="" data-path="chap-distribution.html"><a href="chap-distribution.html#first-problem-gravity-model-development"><i class="fa fa-check"></i>First Problem: Gravity Model Development</a></li>
<li class="chapter" data-level="" data-path="chap-distribution.html"><a href="chap-distribution.html#second-problem-model-calibration"><i class="fa fa-check"></i>Second Problem: Model Calibration</a></li>
<li class="chapter" data-level="" data-path="chap-distribution.html"><a href="chap-distribution.html#third-problem-model-application"><i class="fa fa-check"></i>Third Problem: Model Application</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-modechoice.html"><a href="chap-modechoice.html"><i class="fa fa-check"></i><b>4</b> Mode and Destination Choice</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chap-modechoice.html"><a href="chap-modechoice.html#mathematical-derivation"><i class="fa fa-check"></i><b>4.1</b> Mathematical Derivation</a></li>
<li class="chapter" data-level="4.2" data-path="chap-modechoice.html"><a href="chap-modechoice.html#utility-equations"><i class="fa fa-check"></i><b>4.2</b> Utility Equations</a></li>
<li class="chapter" data-level="4.3" data-path="chap-modechoice.html"><a href="chap-modechoice.html#mnl-estimation"><i class="fa fa-check"></i><b>4.3</b> MNL Estimation</a></li>
<li class="chapter" data-level="4.4" data-path="chap-modechoice.html"><a href="chap-modechoice.html#iia-and-nested-logit"><i class="fa fa-check"></i><b>4.4</b> IIA and Nested Logit</a></li>
<li class="chapter" data-level="4.5" data-path="chap-modechoice.html"><a href="chap-modechoice.html#accessibility-and-log-sums"><i class="fa fa-check"></i><b>4.5</b> Accessibility and Log Sums</a></li>
<li class="chapter" data-level="4.6" data-path="chap-modechoice.html"><a href="chap-modechoice.html#destination-choice"><i class="fa fa-check"></i><b>4.6</b> Destination Choice</a></li>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#hw-modechoice"><i class="fa fa-check"></i>Homework</a>
<ul>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#first-problem-set-multinomial-logit-model-estimation"><i class="fa fa-check"></i>First Problem Set: Multinomial Logit Model Estimation</a></li>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#second-problem-set-nested-logit-models"><i class="fa fa-check"></i>Second Problem Set: Nested Logit Models</a></li>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#third-problem-set-log-sums-and-destination-choice"><i class="fa fa-check"></i>Third Problem Set: Log Sums and Destination Choice</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#lab"><i class="fa fa-check"></i>Lab</a>
<ul>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#mode-choice-calibration"><i class="fa fa-check"></i>Mode Choice Calibration</a></li>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#destination-choice-calibration"><i class="fa fa-check"></i>Destination Choice Calibration</a></li>
<li class="chapter" data-level="" data-path="chap-modechoice.html"><a href="chap-modechoice.html#report-2"><i class="fa fa-check"></i>Report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-assignment.html"><a href="chap-assignment.html"><i class="fa fa-check"></i><b>5</b> Network Assignment and Validation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chap-assignment.html"><a href="chap-assignment.html#volume---delay-functions"><i class="fa fa-check"></i><b>5.1</b> Volume - Delay Functions</a></li>
<li class="chapter" data-level="5.2" data-path="chap-assignment.html"><a href="chap-assignment.html#assignment-algorithms"><i class="fa fa-check"></i><b>5.2</b> Assignment Algorithms</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="chap-assignment.html"><a href="chap-assignment.html#all-or-nothing"><i class="fa fa-check"></i><b>5.2.1</b> All-or-Nothing</a></li>
<li class="chapter" data-level="5.2.2" data-path="chap-assignment.html"><a href="chap-assignment.html#incremental-assignment"><i class="fa fa-check"></i><b>5.2.2</b> Incremental Assignment</a></li>
<li class="chapter" data-level="5.2.3" data-path="chap-assignment.html"><a href="chap-assignment.html#successive-averages-fhwa-assignment"><i class="fa fa-check"></i><b>5.2.3</b> Successive Averages (FHWA) Assignment</a></li>
<li class="chapter" data-level="5.2.4" data-path="chap-assignment.html"><a href="chap-assignment.html#frank-wolfe"><i class="fa fa-check"></i><b>5.2.4</b> Frank-Wolfe</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chap-assignment.html"><a href="chap-assignment.html#hw-assignment"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="chap-assignment.html"><a href="chap-assignment.html#laboratory-assignment"><i class="fa fa-check"></i>Laboratory Assignment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-process.html"><a href="chap-process.html"><i class="fa fa-check"></i><b>6</b> The Planning Process</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="app-demomodel.html"><a href="app-demomodel.html"><i class="fa fa-check"></i><b>A</b> Demonstration Model</a>
<ul>
<li class="chapter" data-level="A.1" data-path="app-demomodel.html"><a href="app-demomodel.html#running-the-model"><i class="fa fa-check"></i><b>A.1</b> Running the Model</a></li>
<li class="chapter" data-level="A.2" data-path="app-demomodel.html"><a href="app-demomodel.html#files-and-reports"><i class="fa fa-check"></i><b>A.2</b> Files and Reports</a></li>
<li class="chapter" data-level="A.3" data-path="app-demomodel.html"><a href="app-demomodel.html#writing-custom-scripts"><i class="fa fa-check"></i><b>A.3</b> Writing Custom Scripts</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="app-demomodel.html"><a href="app-demomodel.html#network-bandwidth"><i class="fa fa-check"></i><b>A.3.1</b> Network Bandwidth</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="app-demomodel.html"><a href="app-demomodel.html#network-and-zone-maps"><i class="fa fa-check"></i><b>A.4</b> Network and Zone Maps</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="app-demomodel.html"><a href="app-demomodel.html#shortest-paths"><i class="fa fa-check"></i><b>A.4.1</b> Shortest Paths</a></li>
<li class="chapter" data-level="A.4.2" data-path="app-demomodel.html"><a href="app-demomodel.html#mode-choice-logsum-maps"><i class="fa fa-check"></i><b>A.4.2</b> Mode Choice Logsum Maps</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="app-demomodel.html"><a href="app-demomodel.html#editing-transit-lines"><i class="fa fa-check"></i><b>A.5</b> Editing Transit Lines</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="app-rstudio.html"><a href="app-rstudio.html"><i class="fa fa-check"></i><b>B</b> R and RStudio Help</a>
<ul>
<li class="chapter" data-level="B.1" data-path="app-rstudio.html"><a href="app-rstudio.html#installing"><i class="fa fa-check"></i><b>B.1</b> Installing</a></li>
<li class="chapter" data-level="B.2" data-path="app-rstudio.html"><a href="app-rstudio.html#rstudio-orientation"><i class="fa fa-check"></i><b>B.2</b> RStudio Orientation</a></li>
<li class="chapter" data-level="B.3" data-path="app-rstudio.html"><a href="app-rstudio.html#r-packages"><i class="fa fa-check"></i><b>B.3</b> R Packages</a></li>
<li class="chapter" data-level="B.4" data-path="app-rstudio.html"><a href="app-rstudio.html#working-with-tables"><i class="fa fa-check"></i><b>B.4</b> Working with Tables</a>
<ul>
<li class="chapter" data-level="B.4.1" data-path="app-rstudio.html"><a href="app-rstudio.html#reading-data"><i class="fa fa-check"></i><b>B.4.1</b> Reading Data</a></li>
<li class="chapter" data-level="B.4.2" data-path="app-rstudio.html"><a href="app-rstudio.html#modifying-and-summarizing-tables"><i class="fa fa-check"></i><b>B.4.2</b> Modifying and Summarizing Tables</a></li>
<li class="chapter" data-level="B.4.3" data-path="app-rstudio.html"><a href="app-rstudio.html#app-mutate"><i class="fa fa-check"></i><b>B.4.3</b> Mutate, Summarize, and Group</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="app-rstudio.html"><a href="app-rstudio.html#graphics-with-ggplot2"><i class="fa fa-check"></i><b>B.5</b> Graphics with <code>ggplot2</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Urban Transportation Planning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap-distribution" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Trip Distribution</h1>
<p>The trip distribution model is the second component in a traditional 4-step
model. The purpose of the trip distribution model is to produce a trip table
with the estimated number of trips from each TAZ to every other TAZ in the study
area. To do this, predicted productions at each origin TAZ, and predicted
attractions at each destination TAZ are combined to create a
production-attraction model. Your homework this week will focus on a basic,
three zone system which you will calibrate using a Gravity Model. The Gravity
Model assumes that the number of trips between any two zones is directly
proportional to the trips produced and attracted, controlling for the
proportional to the travel time between two zones.</p>
<p>Please reference <a href="https://tfresource.org/topics/Trip_distribution.html">this article from the Travel Forecasting Resource</a>
for more information about about trip distribution. Section 4.5 of NHCRP report
716 also provides good background.</p>
<div id="hw-distribution" class="section level2 unnumbered">
<h2>Homework</h2>
<div class="figure"><span style="display:block;" id="fig:networkgraph"></span>
<img src="images/03_networkgraph.png" alt="Simple 3-Zone System." width="570" />
<p class="caption">
Figure 3.1: Simple 3-Zone System.
</p>
</div>
<p>Figure <a href="chap-distribution.html#fig:networkgraph">3.1</a><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
presents a simple three zone system, the link travel times for this system (for
internal trips, <span class="math inline">\(t_{ii}=2\)</span> globally), and the zonal productions and attractions.
In this homework you will develop, calibrate, and apply a doubly-constrained
gravity model for this system.</p>
<div id="first-problem-gravity-model-development" class="section level3 unnumbered">
<h3>First Problem: Gravity Model Development</h3>
<p>In this step, you will develop a gravity model. Assume a gravity model of the
form</p>
<p><span class="math display">\[T_{ij}=\frac{P_iA_j^*(t_{ij})^{-b}}{\sum_{j&#39;\in J}A^*_{j&#39;}(t_{ij&#39;})^{-b}}\]</span></p>
<p>where <span class="math inline">\(A_j^*\)</span> is a “modified attraction term” defined by the algorithm shown in
Figure <a href="chap-distribution.html#fig:tripbalancing">3.2</a> below. This is an
iterative algorithm; in each iteration the <span class="math inline">\(A^*\)</span> vector gets updated based
on the difference between the predicted trips <span class="math inline">\(T_{ij}\)</span> and the input attractions
<span class="math inline">\(A\)</span>. As the number of iterations increases, the ratio <span class="math inline">\(A_j / \sum_i T_{ij}\)</span> gets
closer to 1. At the same time, the difference between successive predicted trip
matrices becomes close to zero. This algorithm therefore
“doubly-constrains” the predicted trips to a given zone to equal the input zonal
attractions <span class="math inline">\(A_j\)</span>, within some <em>tolerance</em> represented by the value <span class="math inline">\(\varepsilon\)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:tripbalancing"></span>
<img src="images/03_algorithm.png" alt="Trip balancing algorithm." width="384" />
<p class="caption">
Figure 3.2: Trip balancing algorithm.
</p>
</div>
<div class="rmdthink">
<p>Why might we want to doubly-constrain a gravity model? Why might we not?</p>
</div>
<p>Write a program function or develop a spreadsheet to apply this
doubly-constrained gravity model.</p>
<p>The function code below shows how to calculate one iteration of a gravity model in R.
The function takes the production and attractions vector, in addition to the
cost matrix and the impedance parameter, and calculates the <span class="math inline">\(T_{ij}\)</span> matrix.
Once you have this function (as well as the necessary vectors and cost matrix),
you can calculate the gravity model with arbitrary values of the impedance
coefficient.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="chap-distribution.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Gravity Model</span></span>
<span id="cb88-2"><a href="chap-distribution.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p vector of productions, length n</span></span>
<span id="cb88-3"><a href="chap-distribution.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param A vector of attractions, lenth n</span></span>
<span id="cb88-4"><a href="chap-distribution.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param C matrix of impedances, dim n x n</span></span>
<span id="cb88-5"><a href="chap-distribution.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param b impedance parameter</span></span>
<span id="cb88-6"><a href="chap-distribution.html#cb88-6" aria-hidden="true" tabindex="-1"></a>gravity <span class="ot">&lt;-</span> <span class="cf">function</span>(p, a, C, b){</span>
<span id="cb88-7"><a href="chap-distribution.html#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output matrix (all 0 here)</span></span>
<span id="cb88-8"><a href="chap-distribution.html#cb88-8" aria-hidden="true" tabindex="-1"></a>  trips <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(p), <span class="at">ncol =</span> <span class="fu">length</span>(a)) </span>
<span id="cb88-9"><a href="chap-distribution.html#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop over all rows (production)</span></span>
<span id="cb88-10"><a href="chap-distribution.html#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(p)) {</span>
<span id="cb88-11"><a href="chap-distribution.html#cb88-11" aria-hidden="true" tabindex="-1"></a>    bottomA <span class="ot">&lt;-</span> <span class="fu">sum</span>(a <span class="sc">*</span> C[i, ]<span class="sc">^</span>(<span class="sc">-</span>b)) <span class="co"># denominator</span></span>
<span id="cb88-12"><a href="chap-distribution.html#cb88-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-13"><a href="chap-distribution.html#cb88-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop over all columns (attraction)</span></span>
<span id="cb88-14"><a href="chap-distribution.html#cb88-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(a)) {</span>
<span id="cb88-15"><a href="chap-distribution.html#cb88-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate gravity model for trips from i to j</span></span>
<span id="cb88-16"><a href="chap-distribution.html#cb88-16" aria-hidden="true" tabindex="-1"></a>      topA <span class="ot">&lt;-</span> a[j] <span class="sc">*</span> C[i,j]<span class="sc">^</span>(<span class="sc">-</span>b)</span>
<span id="cb88-17"><a href="chap-distribution.html#cb88-17" aria-hidden="true" tabindex="-1"></a>      trips[i, j] <span class="ot">&lt;-</span>  p[i] <span class="sc">*</span> topA <span class="sc">/</span> bottomA</span>
<span id="cb88-18"><a href="chap-distribution.html#cb88-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-19"><a href="chap-distribution.html#cb88-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-20"><a href="chap-distribution.html#cb88-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-21"><a href="chap-distribution.html#cb88-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(trips)</span>
<span id="cb88-22"><a href="chap-distribution.html#cb88-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-23"><a href="chap-distribution.html#cb88-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-24"><a href="chap-distribution.html#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate one round of gravity model with </span></span>
<span id="cb88-25"><a href="chap-distribution.html#cb88-25" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">100</span>)</span>
<span id="cb88-26"><a href="chap-distribution.html#cb88-26" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">50</span>, <span class="dv">150</span>)</span>
<span id="cb88-27"><a href="chap-distribution.html#cb88-27" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-28"><a href="chap-distribution.html#cb88-28" aria-hidden="true" tabindex="-1"></a><span class="fu">gravity</span>(p, a, C, <span class="at">b =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>##          [,1]      [,2]     [,3]
## [1,] 59.22613  9.364473 31.40940
## [2,] 84.61917 33.448665 81.93216
## [3,] 42.56523 12.287524 45.14725</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="chap-distribution.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gravity</span>(p, a, C, <span class="at">b =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<pre><code>##          [,1]      [,2]     [,3]
## [1,] 75.27793  4.760994 19.96108
## [2,] 55.52540 54.870858 89.60374
## [3,] 28.52074 10.977638 60.50162</code></pre>
<p>Note that were we not going to doubly-constrain this model, we would be done. But
we now need to implement the algorithm presented in <a href="chap-distribution.html#fig:tripbalancing">3.2</a>.
We now have a model that at least generates a trip matrix that is constrained
to the attractions.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="chap-distribution.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Function to balance gravity model</span></span>
<span id="cb92-2"><a href="chap-distribution.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p vector of productions, length n</span></span>
<span id="cb92-3"><a href="chap-distribution.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param A vector of attractions, lenth n</span></span>
<span id="cb92-4"><a href="chap-distribution.html#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param C matrix of impedances, dim n x n</span></span>
<span id="cb92-5"><a href="chap-distribution.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param b impedance parameter</span></span>
<span id="cb92-6"><a href="chap-distribution.html#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param tolerance Acceptable change in trips matrix</span></span>
<span id="cb92-7"><a href="chap-distribution.html#cb92-7" aria-hidden="true" tabindex="-1"></a>balance_gravity <span class="ot">&lt;-</span> <span class="cf">function</span>(p, a, C, b, tolerance) {</span>
<span id="cb92-8"><a href="chap-distribution.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-9"><a href="chap-distribution.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define starting values</span></span>
<span id="cb92-10"><a href="chap-distribution.html#cb92-10" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#iteration counter</span></span>
<span id="cb92-11"><a href="chap-distribution.html#cb92-11" aria-hidden="true" tabindex="-1"></a>  astar <span class="ot">&lt;-</span> a <span class="co"># starting unadjusted attractions</span></span>
<span id="cb92-12"><a href="chap-distribution.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  trips0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(p), <span class="at">ncol =</span> <span class="fu">length</span>(a)) <span class="co">#initial T is 0&#39;s</span></span>
<span id="cb92-13"><a href="chap-distribution.html#cb92-13" aria-hidden="true" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="cn">Inf</span> <span class="co"># first time through, error is Infinite</span></span>
<span id="cb92-14"><a href="chap-distribution.html#cb92-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb92-15"><a href="chap-distribution.html#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through algorithm</span></span>
<span id="cb92-16"><a href="chap-distribution.html#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(error <span class="sc">&gt;</span> tolerance){</span>
<span id="cb92-17"><a href="chap-distribution.html#cb92-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute gravity model with adjusted attractions, using your function</span></span>
<span id="cb92-18"><a href="chap-distribution.html#cb92-18" aria-hidden="true" tabindex="-1"></a>    trips <span class="ot">&lt;-</span> <span class="fu">gravity</span>(p, astar, C, b) </span>
<span id="cb92-19"><a href="chap-distribution.html#cb92-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-20"><a href="chap-distribution.html#cb92-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the error as the change in trips in successive iterations</span></span>
<span id="cb92-21"><a href="chap-distribution.html#cb92-21" aria-hidden="true" tabindex="-1"></a>    error <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(trips <span class="sc">-</span> trips0))</span>
<span id="cb92-22"><a href="chap-distribution.html#cb92-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-23"><a href="chap-distribution.html#cb92-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># protect against infinite loops, increment values</span></span>
<span id="cb92-24"><a href="chap-distribution.html#cb92-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="cf">break</span> <span class="co"># maximum of 100 iterations</span></span>
<span id="cb92-25"><a href="chap-distribution.html#cb92-25" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb92-26"><a href="chap-distribution.html#cb92-26" aria-hidden="true" tabindex="-1"></a>    trips0 <span class="ot">&lt;-</span> trips</span>
<span id="cb92-27"><a href="chap-distribution.html#cb92-27" aria-hidden="true" tabindex="-1"></a>    astar <span class="ot">&lt;-</span> astar <span class="sc">*</span> a <span class="sc">/</span> <span class="fu">colSums</span>(trips) <span class="co"># next iteration astar</span></span>
<span id="cb92-28"><a href="chap-distribution.html#cb92-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-29"><a href="chap-distribution.html#cb92-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-30"><a href="chap-distribution.html#cb92-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(trips)</span>
<span id="cb92-31"><a href="chap-distribution.html#cb92-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-32"><a href="chap-distribution.html#cb92-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-33"><a href="chap-distribution.html#cb92-33" aria-hidden="true" tabindex="-1"></a>double_constrained_trips <span class="ot">&lt;-</span> <span class="fu">balance_gravity</span>(p, a, C, <span class="fl">0.5</span>, <span class="fl">0.01</span>)</span>
<span id="cb92-34"><a href="chap-distribution.html#cb92-34" aria-hidden="true" tabindex="-1"></a>double_constrained_trips</span></code></pre></div>
<pre><code>##          [,1]      [,2]     [,3]
## [1,] 62.50975  8.329009 29.16124
## [2,] 91.54031 30.492846 77.96684
## [3,] 45.94993 11.178146 42.87193</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="chap-distribution.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(double_constrained_trips)</span></code></pre></div>
<pre><code>## [1] 200  50 150</code></pre>
</div>
<div id="second-problem-model-calibration" class="section level3 unnumbered">
<h3>Second Problem: Model Calibration</h3>
<p>The three-zone system defined in Figure <a href="chap-distribution.html#fig:networkgraph">3.1</a> has the observed
trip matrix listed below. What we need to do now is find the value of <span class="math inline">\(b\)</span> that
minimizes the difference between the observed and predicted trip matrix.
You could solve this manually by trying different values of beta, or by using a
goal seek / optimization program. The choice is yours, but you should document
what you do in your homework response. You also need to determine how you are
calculating the “difference”: sum of absolute error? Root mean squared error, etc.</p>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(i\)</span></th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="center">80</td>
<td align="center">5</td>
<td align="center">15</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">80</td>
<td align="center">40</td>
<td align="center">80</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="center">40</td>
<td align="center">5</td>
<td align="center">55</td>
</tr>
</tbody>
</table>
</div>
<div id="third-problem-model-application" class="section level3 unnumbered">
<h3>Third Problem: Model Application</h3>
<p>The region represented in Problem 1 has begun improvements to the
link between zones 1 and 2 that will reduce the travel cost from 5 to 3. Using
your algorithm and the value of <span class="math inline">\(b\)</span> that you calibrated above, determine the
effect of this improvement on the predicted trip distribution matrix. That is,
change the cost matrix to represent the forecasted travel costs and re-run your
doubly-constrained gravity model algorithm. Is the response reasonable?</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>This problem is adapted with permission from
<em>Urban Transportation Planning: Second Edition</em> by Michael D. Meyer and
Eric J. Miller.<a href="chap-distribution.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chap-tripgen.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-modechoice.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ceen565.pdf", "ceen565.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
